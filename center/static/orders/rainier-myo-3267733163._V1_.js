if(!this.JSON){JSON=function(){function f(n){return n<10?"0"+n:n;
}Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z";
};
var escapeable=/["\\\x00-\x1f\x7f-\x9f]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;
function quote(string){return escapeable.test(string)?'"'+string.replace(escapeable,function(a){var c=meta[a];
if(typeof c==="string"){return c;
}c=a.charCodeAt();
return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16);
})+'"':'"'+string+'"';
}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];
if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key);
}if(typeof rep==="function"){value=rep.call(holder,key,value);
}switch(typeof value){case"string":return quote(value);
case"number":return isFinite(value)?String(value):"null";
case"boolean":case"null":return String(value);
case"object":if(!value){return"null";
}gap+=indent;
partial=[];
if(typeof value.length==="number"&&!(value.propertyIsEnumerable("length"))){length=value.length;
for(i=0;
i<length;
i+=1){partial[i]=str(i,value)||"null";
}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";
gap=mind;
return v;
}if(typeof rep==="object"){length=rep.length;
for(i=0;
i<length;
i+=1){k=rep[i];
if(typeof k==="string"){v=str(k,value,rep);
if(v){partial.push(quote(k)+(gap?": ":":")+v);
}}}}else{for(k in value){v=str(k,value,rep);
if(v){partial.push(quote(k)+(gap?": ":":")+v);
}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";
gap=mind;
return v;
}}return{stringify:function(value,replacer,space){var i;
gap="";
indent="";
if(space){if(typeof space==="number"){for(i=0;
i<space;
i+=1){indent+=" ";
}}else{if(typeof space==="string"){indent=space;
}}}if(!replacer){rep=function(key,value){if(!Object.hasOwnProperty.call(this,key)){return undefined;
}return value;
};
}else{if(typeof replacer==="function"||(typeof replacer==="object"&&typeof replacer.length==="number")){rep=replacer;
}else{throw new Error("JSON.stringify");
}}return str("",{"":value});
},parse:function(text,reviver){var j;
function walk(holder,key){var k,v,value=holder[key];
if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);
if(v!==undefined){value[k]=v;
}else{delete value[k];
}}}}return reviver.call(holder,key,value);
}if(/^[\],:{}\s]*$/.test(text.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");
return typeof reviver==="function"?walk({"":j},""):j;
}throw new SyntaxError("JSON.parse");
},quote:quote};
}();
}window.MYO=(function($){var module={};
var ajaxActionUrl,ajaxTimeout,applicationPath,genericErrorMessage,messagesAtTop,messageDisplayPlaceholderId,hooks,isArray,getXMLObject,getAjaxErrorMessageXMLObject,openJSPopupWindow,getXMLHTTPRequestObject,ajaxRequestSuccess,ajaxResponseSanityCheck,sendAjaxRequest,getFormValues,errorFieldHighlights,errorRowHighlights,errorField_classNames,errorRow_classNames,errorDivDisplayToggles,errorMessagesDisplayed,highlightErrorFields,highlightErrorField,hiddenErrorDiv,showErrorForFormField,clearErrorHighlightFromFormFields,showPageMessage,showMessageBoxWithMessage,hideMessageBox,setHtmlContent,getXMLContent,getXMLContentArray,getJSObject,saveJSObject,saveDivContent,loadPageState,fixLiElementsForErrorMessages,delayAjaxCall,handle_action,check_all,delayAjaxCallsOnListOrders,createLink,addDatepicker,hzAjaxActionRootUrl,hzAjaxActionPaths,gpListOrderRecon;
errorFieldHighlights={};
errorRowHighlights={};
errorField_classNames={};
errorRow_classNames={};
errorDivDisplayToggles={};
errorMessagesDisplayed={};
hiddenErrorDiv="_myoRO_errorMessages";
hooks={};
hooks.catchXMLError=function(){};
hooks.messageText=function(){return"";
};
hooks.sanityDetails=function(){};
hooks.augmentAjaxArgs=function(){return"";
};
isArray=function(o){return Object.prototype.toString.call(o)==="[object Array]";
};
getXMLObject=function(xml){var xmlDoc,parser;
try{xmlDoc=new ActiveXObject("Microsoft.XMLDOM");
xmlDoc.async="false";
xmlDoc.loadXML(xml);
return xmlDoc;
}catch(e){try{parser=new DOMParser();
xmlDoc=parser.parseFromString(xml,"text/xml");
return xmlDoc;
}catch(e){hooks.catchXMLError(e,message);
return null;
}}};
getAjaxErrorMessageXMLObject=function(message){var text="<xml_reply>";
text=text+"<status>error</status>";
text=text+"<message>";
text=text+genericErrorMessage;
text=text+hooks.messageText(message);
text=text+"</message>";
text=text+"</xml_reply>";
return getXMLObject(text);
};
getXMLHTTPRequestObject=function(){var requestObject=null;
if(MYO.JS.browser.msie){try{requestObject=new ActiveXObject("Msxml2.XMLHTTP");
}catch(e){try{requestObject=new ActiveXObject("Microsoft.XMLHTTP");
}catch(e){try{requestObject=new XMLHttpRequest();
}catch(e){}}}}else{requestObject=new XMLHttpRequest();
}if(!requestObject){return null;
}return requestObject;
};
ajaxRequestSuccess=function(xml){var status=getXMLContent("status",xml);
var message=getXMLContent("message",xml);
if(status=="success"||status=="error"){if(message!=undefined){var msgplaceholder=document.getElementById(messageDisplayPlaceholderId);
setHtmlContent(msgplaceholder,message);
}}};
ajaxResponseSanityCheck=function(xml){var st=getXMLContent("status",xml);
hooks.sanityDetails(xml);
if(st=="login"){window.location.reload(true);
return 0;
}else{if(st!="success"&&st!="error"){return 1;
}}return 0;
};
getAjaxRemoteURL=function(action){if(action in hzAjaxActionPaths){return hzAjaxActionRootUrl+hzAjaxActionPaths[action];
}else{return ajaxActionUrl;
}};
extractActionFromAjaxReqArgs=function(reqArgs){if(typeof reqArgs!="string"){return reqArgs["action"];
}else{var splitReqArgs=reqArgs.split("&");
for(var index=0;
index<splitReqArgs.length;
++index){var pair=splitReqArgs[index];
var pairArray=pair.split("=");
if(pairArray[0]==="action"){return pairArray[1];
}}}return null;
};
sendAjaxRequest=function(reqArgs,successFn){var successFunction=successFn||ajaxRequestSuccess;
var value,i;
var action=extractActionFromAjaxReqArgs(reqArgs);
var args=reqArgs;
if(typeof reqArgs!="string"){var argsArray=[];
for(var key in reqArgs){value=reqArgs[key];
if(isArray(value)){for(i=0;
i<value.length;
i+=1){argsArray.push(encodeURIComponent(key)+"="+encodeURIComponent(value[i]));
}}else{argsArray.push(encodeURIComponent(key)+"="+encodeURIComponent(value));
}}argsArray.push(encodeURIComponent("applicationPath")+"="+encodeURIComponent(applicationPath));
args=argsArray.join("&");
}args+=hooks.augmentAjaxArgs();
var isRequestCompleted=false;
var xmlHTTP=getXMLHTTPRequestObject();
if(!xmlHTTP){var xmlData=getAjaxErrorMessageXMLObject("couldn't create xml http object");
successFunction(xmlData);
return;
}xmlHTTP.open("POST",getAjaxRemoteURL(action),true);
xmlHTTP.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
xmlHTTP.setRequestHeader("If-Modified-Since","Thu, 01 Jan 1970 00:00:00 GMT");
xmlHTTP.setRequestHeader("X-Requested-With","XMLHttpRequest");
xmlHTTP.setRequestHeader("Connection","close");
var onreadystatechange=function(errorReason){if(xmlHTTP.readyState==4||errorReason=="timeout"){isRequestCompleted=true;
if(ajaxResultPollInterval){clearInterval(ajaxResultPollInterval);
ajaxResultPollInterval=null;
}var isSuccess;
var xmlData;
try{isSuccess=(xmlHTTP.status>=200&&xmlHTTP.status<300)||(xmlHTTP.status==304)||(MYO.JS.browser.safari&&xmlHTTP.status==undefined);
isSuccess=isSuccess&&errorReason!="timeout";
}catch(e){isSuccess=0;
}if(isSuccess){xmlData=xmlHTTP.responseXML;
if(xmlData){if(ajaxResponseSanityCheck(xmlData)!=0){xmlData=getAjaxErrorMessageXMLObject("XML response failed validation check. Stack trace in action.m?");
}}else{xmlData=getAjaxErrorMessageXMLObject("Didnt receive XML response. Stack trace in action.m?");
}}else{if(errorReason=="timeout"){xmlData=getAjaxErrorMessageXMLObject("HTTP timeout");
}else{if(xmlHTTP.status!=0){xmlData=getAjaxErrorMessageXMLObject("HTTP response code [ code = "+xmlHTTP.status+" ] failure");
}else{xmlData=getXMLObject("<xml_reply><status>cancel</status><message/></xml_reply>");
}}}successFunction(xmlData);
xmlHTTP=null;
xmlData=null;
}};
var ajaxResultPollInterval=setInterval(onreadystatechange,13);
var timeoutVal=ajaxTimeout;
if(timeoutVal>0){setTimeout(function(){if(xmlHTTP){xmlHTTP.abort();
if(!isRequestCompleted){onreadystatechange("timeout");
}}},timeoutVal);
}try{xmlHTTP.send(args);
}catch(e){var xmlData=getAjaxErrorMessageXMLObject("couldn't send ajax request: "+e.message);
successFunction(xmlData);
}};
getFormValues=function(frm){var param={};
var value,oldValue;
for(var i=0;
i<frm.elements.length;
i++){value=undefined;
switch(frm.elements[i].type){case"text":case"textarea":case"hidden":value=frm.elements[i].value;
if($(frm.elements[i]).hasClass("trim")){value=$.trim(value);
}break;
case"checkbox":if(frm.elements[i].checked){value=frm.elements[i].value;
}break;
case"select-one":if(frm.elements[i].name!==""&&frm.elements[i].selectedIndex>=0){value=frm.elements[i].options[frm.elements[i].selectedIndex].value;
}break;
}if(value!==undefined){oldValue=param[frm.elements[i].name];
if(oldValue===undefined){param[frm.elements[i].name]=value;
}else{if(isArray(oldValue)){oldValue[oldValue.length]=value;
}else{param[frm.elements[i].name]=[oldValue,value];
}}}}return param;
};
highlightErrorFields=function(data,xml){if(data!=undefined&&data.length>1){var bad_args_array=data.split(" ");
var index=0;
while(index<bad_args_array.length){var fieldID=bad_args_array[index++];
highlightErrorField(fieldID,xml);
}}};
highlightErrorField=function(fieldID,xml){var node=document.getElementById(fieldID);
if(node!=null){var parentdiv=node.parentNode;
if(parentdiv!=undefined&&parentdiv.nodeName=="DIV"){errorFieldHighlights[fieldID]=parentdiv;
if(errorField_classNames[fieldID]==undefined){errorField_classNames[fieldID]=parentdiv.className;
}parentdiv.className="myo-form-error-highlight";
var errordiv=document.getElementById(parentdiv.id+"_refErrorDiv");
if(errordiv!=null){if(xml!=undefined){var inlineMsg=getXMLContent(fieldID+"_inlineMessage",xml);
if(inlineMsg!=""){setHtmlContent(errordiv,inlineMsg);
}}errordiv.style.display="";
errorDivDisplayToggles[fieldID]=errordiv;
}}}while(node!=undefined){if(node.nodeName=="TR"||node.nodeName=="tr"){if(node.id=="_myo_ERROR_ROW"){errorRowHighlights[fieldID]=node;
if(errorRow_classNames[fieldID]==undefined){errorRow_classNames[fieldID]=node.className;
}node.className="myo-form-error-highlight";
break;
}}node=node.parentNode;
}};
showErrorForFormField=function(errorId,fieldID){document.getElementById(hiddenErrorDiv).style.display="";
var errorDivId=errorId+"_ERR";
var errorDiv=document.getElementById(errorDivId);
if(errorDiv!=null){errorDiv.style.display="";
errorDiv.parentNode.style.display="";
errorMessagesDisplayed[errorDivId]=errorDiv;
}highlightErrorField(fieldID);
};
clearErrorHighlightFromFormFields=function(){var fieldID;
for(fieldID in errorFieldHighlights){var node=errorFieldHighlights[fieldID];
var oldClass=errorField_classNames[fieldID];
if(node!=undefined){node.className=oldClass;
}}for(fieldID in errorDivDisplayToggles){var errordiv=errorDivDisplayToggles[fieldID];
if(errordiv!=undefined){errordiv.style.display="none";
}}for(fieldID in errorRowHighlights){var row=errorRowHighlights[fieldID];
var oldClass=errorRow_classNames[fieldID];
if(row!=undefined){row.className=oldClass;
}}var ourHiddenErrorDiv=document.getElementById(hiddenErrorDiv);
if(ourHiddenErrorDiv){ourHiddenErrorDiv.style.display="none";
}for(fieldID in errorMessagesDisplayed){var field=errorMessagesDisplayed[fieldID];
field.style.display="none";
field.parentNode.style.display="none";
}};
showPageMessage=function(message){if(message.length>0){var msgbox=document.getElementById(messageDisplayPlaceholderId);
setHtmlContent(msgbox,message);
msgbox.style.display="";
}};
showMessageBoxWithMessage=function(msgBoxId,message){if(message.length>0){var msgbox;
if(messagesAtTop==1){msgbox=document.getElementById(messageDisplayPlaceholderId);
}else{msgbox=document.getElementById(msgBoxId);
}setHtmlContent(msgbox,message);
msgbox.style.display="";
}};
hideMessageBox=function(msgBoxId){var msgbox;
if(messagesAtTop==1){msgbox=document.getElementById(messageDisplayPlaceholderId);
}else{msgbox=document.getElementById(msgBoxId);
}msgbox.style.display="none";
};
setHtmlContent=function(element,data){if(element!=undefined){element.innerHTML=data;
}};
getXMLContent=function(fieldname,xml){var nodes=xml.getElementsByTagName(fieldname);
if(nodes!=undefined&&nodes.length>0){var nChildren=nodes[0].childNodes.length;
var retVal="";
for(var i=0;
i<nChildren;
++i){var child=nodes[0].childNodes[i];
if(child.nodeType!=8&&child.nodeType!=1){retVal+=child.nodeValue;
}}return retVal;
}return"";
};
getXMLContentMap=function(fieldname,xml){var nodes=xml.getElementsByTagName(fieldname);
var resultMap={};
if(nodes!=undefined){var nEntries=nodes[0].childNodes.length;
for(var i=0;
i<nEntries;
++i){var entry=nodes[0].childNodes[i];
var key=entry.getElementsByTagName("key")[0].textContent;
var value=entry.getElementsByTagName("value")[0].textContent;
resultMap[key]=value;
}}return resultMap;
};
getXMLContentArray=function(fieldname,xml){var nodes=xml.getElementsByTagName(fieldname);
var resultArray=new Array();
if(nodes!=undefined){for(var n=0;
n<nodes.length;
++n){var nChildren=nodes[n].childNodes.length;
var thisNodeValue="";
for(var i=0;
i<nChildren;
++i){var child=nodes[n].childNodes[i];
if(child.nodeType!=8&&child.nodeType!=1){thisNodeValue+=child.nodeValue;
}}resultArray[n]=thisNodeValue;
}return resultArray;
}else{return"";
}};
getJSObject=function(key){var savedString=document.getElementById("_myoJS_saveArea1").value;
if(savedString==""){return undefined;
}var savedObject=JSON.parse(savedString);
if(savedObject!=undefined){return savedObject[key];
}else{return undefined;
}};
saveJSObject=function(key,value){var savedString=document.getElementById("_myoJS_saveArea1").value;
var savedObject;
if(savedString!=""){savedObject=JSON.parse(savedString);
}else{savedObject=new Object();
}savedObject[key]=value;
document.getElementById("_myoJS_saveArea1").value=JSON.stringify(savedObject);
};
saveDivContent=function(divID,divContent){if(divContent==undefined){var divElement=document.getElementById(divID);
if(divElement==null){return;
}divContent=divElement.innerHTML;
}var savedString=document.getElementById("_myoJS_saveArea1").value;
var savedObject;
if(savedString!=""){savedObject=JSON.parse(savedString);
}else{savedObject=new Object();
}savedObject[divID]=divContent;
document.getElementById("_myoJS_saveArea1").value=JSON.stringify(savedObject);
};
loadPageState=function(){var savedString=document.getElementById("_myoJS_saveArea1").value;
if(savedString==""){return false;
}var successfullyRestored=false;
var savedObject=JSON.parse(savedString);
for(var key in savedObject){var div=document.getElementById(key);
if(div!=null&&div.nodeName=="DIV"){div.innerHTML=savedObject[key];
successfullyRestored=true;
}}try{fixButtonWidths();
}catch(e){}return successfullyRestored;
};
openJSPopupWindow=function(URL,size){window.open(URL,"popupWindow","toolbar=0,scrollbars=1,location=0,statusbar=0,menubar=0,resizable=1,width="+size+",height="+size+";");
return false;
};
handle_action=function(action,url){var link=createLink(url);
if(link===""){return;
}if(action==="bulk_print"||action==="bulk_pick_list"){openJSPopupWindow(link,750);
}else{if(action==="bulk_confirm"){window.location.href=link;
}}return;
};
check_all=function(state){if(state==false){$(".checkbox").attr("checked",false);
}else{$(".checkbox").attr("checked",true);
}return;
};
fixLiElementsForErrorMessages=function(){var ourHiddenErrorDiv=document.getElementById(hiddenErrorDiv);
var listItems=ourHiddenErrorDiv.getElementsByTagName("li");
for(var i=0;
i<listItems.length;
i++){listItems[i].style.display="none";
}};
delayAjaxCall=function(functionToCall){if(delayAjaxCallsOnListOrders){if(window.attachEvent){window.attachEvent("onload",function(){setTimeout(functionToCall,20);
});
}else{window.addEventListener("load",function(){setTimeout(functionToCall,20);
},false);
}}else{functionToCall();
}};
createLink=function(url){var link="";
$(".checkbox:checked").each(function(){link=link+this.id+";";
});
if(link===""){return link;
}link=url+"?ie=UTF8&orderID="+link;
return link;
};
addDatepicker=function(fieldName,dateFormat,minDate,maxDate){var minDateMap={};
var maxDateMap={};
if(minDate>0){minDateMap={minDate:new Date(minDate*1000)};
}if(maxDate>0){maxDateMap={maxDate:new Date(maxDate*1000)};
}$("#"+fieldName).datepicker($.extend(minDateMap,maxDateMap,{dateFormat:dateFormat}));
};
window.addDatepicker=addDatepicker;
createDatePickers=function(){$("input.datePicker").each(function(index){addDatepicker($(this).attr("name"),$(this).attr("jQDateFormat"),$(this).attr("pastCutoffDate"),$(this).attr("futureCutoffDate"));
});
};
setupHzAjaxLinks=function(spec){hzAjaxActionRootUrl=spec.hzAjaxActionRootUrl;
hzAjaxActionPaths={};
hzAjaxActionPaths["get-unshipped-link"]="get-unshipped-link";
hzAjaxActionPaths["get-pending-link"]="get-pending-link";
if(spec.hzAjaxRefundSummaries){hzAjaxActionPaths["get-refund-summaries-via-smrfs"]="get-refund-summaries";
}if(spec.hzAjaxShowFeedback){hzAjaxActionPaths["show-feedback"]="get-feedback";
}hzAjaxActionPaths["get-buyer-history"]="get-buyer-history";
if(spec.hzAjaxSetSellerMemo){hzAjaxActionPaths["update-private-note"]="set-seller-memo";
}if(spec.hzAjaxCancelOrder){hzAjaxActionPaths["cancel-order"]="cancel-order";
}hzAjaxActionPaths["get-shipping-regions"]="get-shipping-regions";
hzAjaxActionPaths["get-prime-unshipped-link"]="get-prime-unshipped-link";
};
module.JS=function(spec){var browserAgent;
ajaxActionUrl=spec.ajaxActionUrl;
ajaxTimeout=spec.ajaxTimeout;
applicationPath=spec.applicationPath;
genericErrorMessage=spec.genericErrorMessage;
messageDisplayPlaceholderId=spec.messageDisplayPlaceholderId;
messagesAtTop=spec.messagesAtTop;
delayAjaxCallsOnListOrders=spec.delayAjaxCallsOnListOrders;
gpListOrderRecon=spec.gpListOrderRecon;
setupHzAjaxLinks(spec);
if(spec.hooks!==undefined){hooks=spec.hooks;
}window.MYO.JS.openJSPopupWindow=openJSPopupWindow;
window.MYO.JS.handle_action=handle_action;
window.MYO.JS.check_all=check_all;
window.MYO.JS.fixLiElementsForErrorMessages=fixLiElementsForErrorMessages;
window.MYO.JS.getXMLContent=getXMLContent;
browserAgent=navigator.userAgent.toLowerCase();
window.MYO.JS.browser={safari:/webkit/.test(browserAgent),opera:/opera/.test(browserAgent),msie:/msie/.test(browserAgent)&&!/opera/.test(browserAgent),mozilla:/mozilla/.test(browserAgent)&&!/(compatible|webkit)/.test(browserAgent)};
};
module.InitializeSimpleDateField=function(spec){var monthNames,currentDateField,dateFormat,cal;
monthNames=spec.monthNames;
dateFormat=spec.dateFormat;
currentDateField="";
cal=new CalendarPopup("calPopDiv");
cal.setDateFormat(dateFormat);
cal.setMonthNames.apply(cal,monthNames);
cal.setDayHeaders("S","M","T","W","T","F","S");
cal.showTodayLink=false;
cal.showYearNavigation();
document.write(getCalendarStyles());
window.gMonthNamesArray=monthNames;
window.gCurrentDateField=currentDateField;
window.cal=cal;
};
module.ModalDiv=function(spec){var successFn,modalHeader,modalHTML,updateFn,modalAcceptText,modalRejectText,MoveModal,HideModal,AcceptModal,RejectModal;
var RevealModal;
modalHeader=spec.modalHeader;
modalHTML=spec.modalHTML;
modalAcceptText=spec.modalAccept;
modalRejectText=spec.modalReject;
updateFn=spec.updateFn;
RevealModal=function(success,modalSpec){successFn=success;
if(typeof(modalSpec)!=="undefined"){$("#modalPage_header").text(modalSpec.modalHeader);
$("#modalPage_text").html(modalSpec.modalHTML);
$("#modalDivReject").click(RejectModal).children().text(modalSpec.modalReject);
$("#modalDivAccept").click(AcceptModal).children().text(modalSpec.modalAccept);
updateFn=modalSpec.updateFn;
}var divID="modalPage";
var modalObj=document.getElementById(divID);
var msgObj=document.getElementById("modalMessageBox");
var contObj=document.getElementById("modalContainer");
modalObj.style.display="";
modalObj.style.height="100%";
modalObj.style.width="100%";
msgObj.style.visibility="visible";
msgObj.style.width="530px";
contObj.style.width="300px";
window.onscroll=function(){document.getElementById(divID).style.top=document.body.scrollTop;
};
document.getElementById(divID).style.top=document.body.scrollTop;
if(updateFn){updateFn();
}};
window.MYO.ModalDiv.RevealModal=RevealModal;
MoveModal=function(){var modalObj=document.getElementById("modalPage");
if(modalObj.parentNode!=document.body){document.body.insertBefore(modalObj,document.body.firstChild);
}};
AcceptModal=function(){HideModal();
successFn();
successFn=null;
};
RejectModal=function(){HideModal();
successFn=null;
};
HideModal=function(){document.getElementById("modalPage").style.display="none";
};
$(document).ready(function(){$("#modalPage_header").text(modalHeader);
$("#modalPage_text").html(modalHTML);
$("#modalDivReject").click(RejectModal).children().text(modalRejectText);
$("#modalDivAccept").click(AcceptModal).children().text(modalAcceptText);
MoveModal();
if(jQuery.browser.msie){$("#modalDivAccept, #modalDivAccept > span, #modalDivReject, #modalDivReject > span").css("width","");
var fixer=new SCUI.Tools.ButtonFix();
fixer.fix("#modalDivAccept");
fixer.fix("#modalDivReject");
}});
};
module.InitializeTextAreaValidation=function(spec){var charsLeftStr,charLeftStr,charOverLimitStr,charsOverLimitStr;
var validateTextArea;
charsLeftStr=spec.charsLeftStr;
charLeftStr=spec.charLeftStr;
charsOverLimitStr=spec.charsOverLimitStr;
charOverLimitStr=spec.charOverLimitStr;
window.MYO.ValidateTextArea=function(textArea,charsLeft,maxLength){var s=textArea.value;
var nChar=maxLength-textArea.value.length;
if(nChar>1){charsLeft.innerHTML="("+nChar+" "+charsLeftStr+")";
}else{if(nChar>=0){charsLeft.innerHTML="("+nChar+" "+charLeftStr+")";
}else{if(nChar>-2){charsLeft.innerHTML="("+-nChar+" "+charOverLimitStr+")";
}else{charsLeft.innerHTML="("+-nChar+" "+charsOverLimitStr+")";
}}}};
};
module.InitializeCheckboxes=function(inputPrefix,inputFields){var OnAllSelected,OnOtherSelected;
OnAllSelected=function(){for(var j=0;
j<inputFields.length;
j++){$(inputPrefix+inputFields[j]).attr("checked",false);
}};
OnOtherSelected=function(){var noneSelected=true;
for(var k=0;
k<inputFields.length;
k++){if($(inputPrefix+inputFields[k]).attr("checked")){noneSelected=false;
break;
}}$(inputPrefix+"all").attr("checked",noneSelected);
};
$(inputPrefix+"all").change(OnAllSelected);
for(var i=0;
i<inputFields.length;
i++){var elementId=inputPrefix+inputFields[i];
if(elementId){$(elementId).change(OnOtherSelected);
}}};
module.LimitOrExpandStatuses=function(prefix,action,allStatuses){var limitedStatuses=["Default","Shipped","Canceled"];
var $statusSelect=$(prefix+"_statusFilterSelect");
var $hiddenStatusSelect=$(prefix+"_hiddenOrderStatus");
if(action==="hide"){var currentStatus=$statusSelect.val();
if($.inArray(currentStatus,limitedStatuses)>-1){$statusSelect.val("ItemsToShip");
}for(var i=0;
i<limitedStatuses.length;
i++){var $elementToMove=$(prefix+"_orderStatus_"+limitedStatuses[i]);
$statusSelect.detach($elementToMove);
$hiddenStatusSelect.append($elementToMove);
}}else{if(action==="show"){for(var i=allStatuses.length-1;
i>=0;
i--){var $currentElement=$(prefix+"_orderStatus_"+allStatuses[i]);
var $nextElement=$(prefix+"_orderStatus_"+allStatuses[i+1]);
if(!$currentElement.parent(prefix+"_statusFilterSelect").length){$hiddenStatusSelect.detach($currentElement);
if(!$nextElement.length){$statusSelect.append($currentElement);
}else{$nextElement.before($currentElement);
}}}}}};
module.MerchantOrderID=function(spec){var currentMOID,orderID,moidDefined,EditButtonClicked,CancelButtonClicked,SaveButtonClicked,OnAjaxSaveSuccess,TextBoxClicked;
currentMOID=spec.merchantOrderID;
orderID=spec.orderID;
moidDefined=spec.moidDefined;
EditButtonClicked=function(){document.getElementById("_myoMOID_SaveButtonPlaceholder").style.display="";
document.getElementById("_myoMOID_CancelButtonPlaceholder").style.display="";
document.getElementById("_myoMOID_EditButtonPlaceholder").style.display="none";
document.getElementById("_myoMOID_MOIDReadOnlyPlaceholder").style.display="none";
document.getElementById("_myoMOID_MOIDEditablePlaceholder").style.display="";
document.getElementById("_myoMOID_SuccessImagePlaceholder").style.display="none";
try{fixButtonWidths();
}catch(e){}return false;
};
CancelButtonClicked=function(){document.getElementById("_myoMOID_SaveButtonPlaceholder").style.display="none";
document.getElementById("_myoMOID_CancelButtonPlaceholder").style.display="none";
document.getElementById("_myoMOID_EditButtonPlaceholder").style.display="";
document.getElementById("_myoMOID_MOIDReadOnlyPlaceholder").style.display="";
document.getElementById("_myoMOID_MOIDEditablePlaceholder").style.display="none";
try{fixButtonWidths();
}catch(e){}};
SaveButtonClicked=function(){clearErrorHighlightFromFormFields();
var new_moid=document.getElementById("_myoMOID_inputID").value;
if(new_moid==currentMOID){CancelButtonClicked();
return false;
}document.getElementById("_myoMOID_LoadingImagePlaceholder").style.display="";
document.getElementById("_myoMOID_inputID").disabled=true;
disableAmznButton("_myoMOID_SaveButton");
disableAmznButton("_myoMOID_CancelButton");
var params={"action":"update-merchant-order-id","orderID":orderID,"merchantOrderID":new_moid};
sendAjaxRequest(params,OnAjaxSaveSuccess);
return false;
};
OnAjaxSaveSuccess=function(xml){var res=getXMLContent("status",xml);
var msg=getXMLContent("message",xml);
var data=getXMLContent("data",xml);
if(res=="success"){document.getElementById("_myoMOID_MOIDReadOnlyPlaceholder").innerHTML=data;
document.getElementById("_myoMOID_SuccessImagePlaceholder").style.display="";
currentMOID=data;
CancelButtonClicked();
}else{highlightErrorFields(data);
}document.getElementById("_myoMOID_inputID").disabled=false;
enableAmznButton("_myoMOID_SaveButton");
enableAmznButton("_myoMOID_CancelButton");
document.getElementById("_myoMOID_LoadingImagePlaceholder").style.display="none";
showPageMessage(msg);
try{fixButtonWidths();
}catch(e){}};
TextBoxClicked=function(){if(!moidDefined){this.value="";
}moidDefined=true;
};
$(document).ready(function(){$("#_myoMOID_CancelButton").click(CancelButtonClicked);
$("#_myoMOID_EditButton").click(EditButtonClicked);
$("#_myoMOID_SaveButton").click(SaveButtonClicked);
$("#_myoMOID_moidForm").submit(SaveButtonClicked);
$("#_myoMOID_inputID").click(TextBoxClicked);
});
};
module.CR=function(spec){var CancelReversals,OnSuccessFunction;
var cancelInProgress=false;
var cancelLoadingClass=".myoCR_loading";
var cancelBtnID=spec.btnID;
var orderID=spec.orderID;
CancelReversals=function(action){if(action!="cancel-refund"&&action!="cancel-refund-via-smrfs"){action="cancel-refund";
}if(!cancelInProgress){cancelInProgress=true;
$(cancelLoadingClass).attr("style","display:;");
disableAmznButton(cancelBtnID);
var params={"action":action,"orderID":orderID};
sendAjaxRequest(params,OnSuccessFunction);
}return true;
};
window.MYO.CR.CancelReversals=CancelReversals;
OnSuccessFunction=function(xml){var status=getXMLContent("status",xml);
cancelInProgress=false;
if(status=="success"){var redirectURL=getXMLContent("redirect",xml);
window.location=redirectURL;
}else{var msg=getXMLContent("message",xml);
showPageMessage(msg);
$(cancelLoadingClass).attr("style","display:none;");
enableAmznButton(cancelBtnID);
}};
};
module.AjaxLink=function(spec){var RequestAjaxLink,OnAjaxRequestAjaxLinkSuccess;
var remote_action=spec.remoteAction;
var target_id=spec.targetID;
var progress_id=spec.progressID;
var buyer_email=spec.buyerEmail;
RequestAjaxLink=function(){var params={"action":remote_action,"targetID":target_id,"progressID":progress_id,"buyerEmail":buyer_email};
OnAjaxRequestAjaxLink=getSuccessFunction(target_id,progress_id);
sendAjaxRequest(params,OnAjaxRequestAjaxLink);
return true;
};
getSuccessFunction=function(target_id,progress_id){return function(xml){var status=getXMLContent("status",xml);
if(progress_id){document.getElementById(progress_id).style.display="none";
}if(status=="success"){var label=getXMLContent("label",xml);
var link=getXMLContent("link",xml);
document.getElementById(target_id).innerHTML=label+link;
}else{document.getElementById(target_id).innerHTML="&nbsp;";
}};
};
$(document).ready(function(){delayAjaxCall(RequestAjaxLink);
});
};
module.Feedback=function(spec){var ajaxRequestInProgress,orderID,RequestFeedback,OnAjaxFeedbackActionSuccess;
orderID=spec.orderID;
ajaxRequestInProgress=false;
RequestFeedback=function(){if(ajaxRequestInProgress){return false;
}else{ajaxRequestInProgress=true;
}var params={"action":"show-feedback","orderID":orderID};
sendAjaxRequest(params,OnAjaxFeedbackActionSuccess);
return true;
};
OnAjaxFeedbackActionSuccess=function(xml){var newform,formplaceholder,st=getXMLContent("status",xml),log=getXMLContent("log",xml);
if(st=="success"){newform=getXMLContent("newform",xml);
formplaceholder=document.getElementById("_myoSF_feedback_form_placeholder");
if(newform!==""){setHtmlContent(formplaceholder,newform);
}}else{if(st=="error"){}}};
$(document).ready(function(){RequestFeedback();
});
};
module.CI=function(spec){var ajaxOperationInProgress,orderID,SetUpPageStateForAjaxCall,TearDownPageStateForAjaxCall,NewConfirmInvoiceButtonOnClick,AjaxNewConfirmInvoiceSuccess;
orderID=spec.orderID;
ajaxOperationInProgress=false;
SetUpPageStateForAjaxCall=function(){if(ajaxOperationInProgress){return false;
}else{ajaxOperationInProgress=true;
return true;
}};
TearDownPageStateForAjaxCall=function(){ajaxOperationInProgress=false;
};
NewConfirmInvoiceButtonOnClick=function(){if(!SetUpPageStateForAjaxCall()){return false;
}document.getElementById("_myoCI_ConfirmInvoiceButtonLoadingImage").style.display="";
disableAmznButton("_myoCI_ConfirmInvoiceButton");
var confirmInvoiceForm=document.getElementById("_myoCI_ConfirmInvoiceForm");
var params=getFormValues(confirmInvoiceForm);
params["action"]="confirm-invoice";
params["orderID"]=orderID;
sendAjaxRequest(params,AjaxNewConfirmInvoiceSuccess);
return false;
};
AjaxNewConfirmInvoiceSuccess=function(xml){var result=getXMLContent("status",xml);
var message=getXMLContent("message",xml);
var data=getXMLContent("data",xml);
if(result=="success"){var redirectURL=getXMLContent("redirect",xml);
window.location=redirectURL;
return;
}else{if(result=="error"){highlightErrorFields(data,xml);
showPageMessage(message);
}}document.getElementById("_myoCI_ConfirmInvoiceButtonLoadingImage").style.display="none";
enableAmznButton("_myoCI_ConfirmInvoiceButton");
TearDownPageStateForAjaxCall();
};
$(document).ready(function(){$("#_myoCI_ConfirmInvoiceButton").click(NewConfirmInvoiceButtonOnClick);
});
};
module.CO=function(spec){var confirmMessage,modalHeader,modalText,modalAccept,modalReject,CancelOrderButtonClicked,OnAjaxCancelOrderActionSuccess;
confirmMessage=spec.confirmationMessage;
modalHeader=spec.modalHeader;
modalText=spec.modalText;
modalAccept=spec.modalAccept;
modalReject=spec.modalReject;
window.MYO.ModalDiv({modalHeader:modalHeader,modalHTML:"<p>"+modalText+"</p>",modalAccept:modalAccept,modalReject:modalReject});
CancelOrderButtonClicked=function(){var that=this;
MYO.ModalDiv.RevealModal(function(){var params;
$("#_myoCO_CancelOrderLoadingImage").css("display","");
disableAmznButton("_myoCO_CancelOrderButton");
clearErrorHighlightFromFormFields();
params=getFormValues(that);
sendAjaxRequest(params,OnAjaxCancelOrderActionSuccess);
});
return false;
};
OnAjaxCancelOrderActionSuccess=function(xml){var status=getXMLContent("status",xml);
if(status==="success"){var redirectURL=getXMLContent("redirect",xml);
window.location=redirectURL;
}else{if(status==="error"){$("#_myoCO_CancelOrderLoadingImage").css("display","none");
enableAmznButton("_myoCO_CancelOrderButton");
var data=getXMLContent("data",xml);
var msg=getXMLContent("message",xml);
showPageMessage(msg);
highlightErrorFields(data);
}}};
$(document).ready(function(){$("#_myoCO_CancelOrderForm").submit(CancelOrderButtonClicked);
});
};
module.UR=function(spec){var modalHeader,modalText,modalAccept,modalReject;
var UpdateReleaseDateButtonClicked,OnAjaxUpdateReleaseDateActionSuccess;
var updateReleaseDateRadioOnclick;
var totalGroups,groupsSucceeded,groupsFailed;
var totalOrders;
var ordersString,dateError;
var groupingToCountMap,nothingSelectedErrorMessage;
modalHeader=spec.modalHeader;
modalText=spec.modalText;
modalAccept=spec.modalAccept;
modalReject=spec.modalReject;
window.MYO.ModalDiv({modalHeader:modalHeader,modalHTML:"<p>"+modalText+"</p>",modalAccept:modalAccept,modalReject:modalReject});
groupingToCountMap=spec.groupingToCountMap;
nothingSelectedErrorMessage=spec.nothingSelectedErrorMessage;
dateError=false;
UpdateReleaseDateButtonClicked=function(){var checkedCheckboxes,checkboxValue,isBoxChecked;
var asinSkuReleaseDateArray;
var params;
checkedCheckboxes=$('input[type="checkbox"][name="_myo_updateReleaseDate_checkbox"]:checked');
totalGroups=checkedCheckboxes.size();
if(totalGroups===0){var errorDivStart='<div class="scui-alert scui-alert-error" > <div class="scui-alert-inner"> <i class="scui-alert-icon scui-alert-error"></i> <h4></h4> <ul class="multiple"> <li>';
var errorDivEnd="</li></ul></div></div>";
showPageMessage(errorDivStart+nothingSelectedErrorMessage+errorDivEnd);
window.location="#";
return false;
}groupsSucceeded=0;
groupsFailed=0;
totalOrders=0;
MYO.ModalDiv.RevealModal(function(){disableAmznButton("_myoUR_updateReleaseDateButton");
$("#_myoUR_UpdateReleaseDateLoadingImage").css("display","");
checkedCheckboxes.each(function(){asinSkuReleaseDateString=$(this).val();
if(!(asinSkuReleaseDateString in groupingToCountMap)){return;
}asinSkuReleaseDateArray=groupingToCountMap[asinSkuReleaseDateString];
totalOrders+=Number(asinSkuReleaseDateArray[3]);
if($("#_myoUR_today_radio_button").is(":checked")){updatedReleaseDate=$("#_myoUR_today_radio_button").val();
}else{updatedReleaseDate=$("#updatedReleaseDate").val();
}params="asin="+encodeURIComponent(asinSkuReleaseDateArray[0])+"&sku="+encodeURIComponent(asinSkuReleaseDateArray[1])+"&updatedReleaseDate="+encodeURIComponent(updatedReleaseDate)+"&currentReleaseDate="+encodeURIComponent(asinSkuReleaseDateArray[2])+"&action=update-release-date";
$.ajax({type:"POST",url:ajaxActionUrl,data:params,success:OnAjaxUpdateReleaseDateActionSuccess,dataType:"xml"});
});
});
return false;
};
OnAjaxUpdateReleaseDateActionSuccess=function(xml){var status=getXMLContent("status",xml);
if(status==="success"){groupsSucceeded++;
}else{if(status==="error"){groupsFailed++;
var data=getXMLContent("data",xml);
var msg=getXMLContent("message",xml);
showPageMessage(msg);
highlightErrorFields(data);
if(data==="updatedReleaseDate"){dateError=true;
}}}if(groupsSucceeded+groupsFailed===totalGroups){var params;
if(groupsFailed>0){if(dateError){$("#_myoUR_updateReleaseDateLoadingImage").hide();
enableAmznButton("_myoUR_updateReleaseDateButton");
dateError=false;
}else{window.location.href=document.URL+"&dmCode=updateReleaseDateFailed&dmType=error";
}}else{if(groupsFailed===0){var redirectURL=getXMLContent("redirect",xml)+"&dmOpt="+totalOrders+"&useSavedSearch=last";
window.location=redirectURL;
}}}};
updateReleaseDateRadioOnclick=function(){if($("#_myoUR_future_radio_button").is(":checked")){$("#_myoUR_calendarDiv").show();
}else{if($("#_myoUR_today_radio_button").is(":checked")){$("#_myoUR_calendarDiv").hide();
}}};
$(document).ready(function(){updateReleaseDateRadioOnclick();
$("#_myo_UR_select_all").click(function(){check_all($(this).is(":checked"));
});
$("#_myoUR_today_radio_button").click(updateReleaseDateRadioOnclick);
$("#_myoUR_future_radio_button").click(updateReleaseDateRadioOnclick);
$("#_myoUR_updateReleaseDateButton").click(UpdateReleaseDateButtonClicked);
});
};
module.ES=function(spec){var ajaxOperationInProgress,currentAjaxActivePackageID,packagesInUse;
var totalNumOfItemsToShip,orderID,displayIDForNextPackage;
var LoadPageState,UpdateDropDowns;
var GetPlaceholderForNewPackage,TearDownPageStateForAjaxCall;
var SetUpPageStateForAjaxCall;
var NewPackageButtonOnClick;
var NewConfirmShipmentButtonOnClick,SubmitConfirmShipmentRequest;
var BuyPostageButtonOnClick,AjaxPrepareBuyPostageSuccess;
var AjaxNewConfirmShipmentSuccess,AjaxReConfirmShipmentSuccess;
var AjaxAddNewPackageSuccess,AjaxRemovePackageSuccess;
var AjaxGetEditablePackageSuccess;
var modalHeader,modalText,modalReject,modalAccept;
var trackingIdRegExpRuleMap;
var checkTrackingID;
var SavePageState,OnChangeIncludeItemCheckBox;
var UpdateItemQtyDropDownForItem,EditPackageButtonOnClick;
var RemovePackageButtonOnClick,ReConfirmShipmentButtonOnClick,SubmitReConfirmShipmentRequest;
var OtherCarrierToggle;
var saveDefaultShippingCheckboxOnClick;
var shippingInputOnChange;
var clearShippingService;
var isCODOrder;
var isSDOrder;
ajaxOperationInProgress=false;
currentAjaxActivePackageID=-1;
packagesInUse=spec.packagesInUse;
totalNumOfItemsToShip=spec.totalItemsToShip;
orderID=spec.orderID;
displayIDForNextPackage=spec.nextDisplayID;
trackingIdRegExpRuleMap=spec.trackingIdRegExpRuleMap;
modalHeader=spec.modalHeader;
modalText=spec.modalText;
modalAccept=spec.modalAccept;
modalReject=spec.modalReject;
isCODOrder=spec.isCODOrder;
isSDOrder=spec.isSDOrder;
clearShippingService=!isCODOrder&&!isSDOrder;
window.MYO.ModalDiv({modalHeader:modalHeader,modalHTML:"<p>"+modalText+"</p>",modalAccept:modalAccept,modalReject:modalReject});
checkTrackingID=function(packageID){var trackingID,carrier;
var noSpaceTrackingID;
var patternStrings;
var pattern;
carrier=document.getElementById("carrierNameDropDown_"+packageID);
trackingID=document.getElementById("trackingID_"+packageID);
if(trackingIdRegExpRuleMap==undefined){return true;
}patternStrings=trackingIdRegExpRuleMap[carrier.value];
if(trackingID.value===""||patternStrings==undefined){return true;
}noSpaceTrackingID=trackingID.value.replace(/ /g,"");
for(var i=0;
i<patternStrings.length;
i++){pattern=new RegExp(patternStrings[i]);
if(pattern.test(noSpaceTrackingID)){return true;
}}return false;
};
LoadPageState=function(){if(loadPageState()){packagesInUse=getJSObject("packagesInUse");
}};
SavePageState=function(){saveJSObject("packagesInUse",packagesInUse);
};
window.MYO.ES.SavePageState=SavePageState;
UpdateDropDowns=function(){var itemCode,packageID;
for(itemCode in totalNumOfItemsToShip){for(packageID in packagesInUse){if(packagesInUse[packageID]!==true&&packageID!=="UNSHIPPEDITEMS"){continue;
}OnChangeIncludeItemCheckBox(itemCode,packageID);
}OnChangeIncludeItemCheckBox(itemCode,"UNSHIPPEDITEMS");
}};
OnChangeIncludeItemCheckBox=function(itemCode,packageID,changeQtiesToMax){var checkBox,formElement,qtyInOtherPackages,cb,qy,ucbx,uqty,pid,el;
if(packageID!==undefined&&packageID!=="UNSHIPPEDITEMS"){packagesInUse[packageID]=true;
}if(changeQtiesToMax===undefined){changeQtiesToMax=0;
}checkBox=document.getElementById("includeItem_"+itemCode+"_"+packageID);
formElement=document.getElementById("item_"+itemCode+"_"+packageID);
if(checkBox!==null&&checkBox.disabled){return;
}if(formElement!==null&&checkBox!==null){if(formElement.type==="select-one"){if(!checkBox.checked){formElement.options[0].selected=true;
formElement.disabled=true;
}else{formElement.disabled=false;
if(changeQtiesToMax===1){qtyInOtherPackages=0;
for(pid in packagesInUse){if(packagesInUse[pid]!==true||pid===packageID){continue;
}cb=document.getElementById("includeItem_"+itemCode+"_"+pid);
qy=document.getElementById("item_"+itemCode+"_"+pid);
if((cb===null||cb.checked)&&(qy!==null)){qtyInOtherPackages+=parseInt(qy.value);
}}if(packageID!=="UNSHIPPEDITEMS"){ucbx=document.getElementById("includeItem_"+itemCode+"_UNSHIPPEDITEMS");
uqty=document.getElementById("item_"+itemCode+"_UNSHIPPEDITEMS");
if((ucbx===null||ucbx.checked)&&(uqty!==null)){qtyInOtherPackages+=parseInt(uqty.value);
}}formElement.value=totalNumOfItemsToShip[itemCode]-qtyInOtherPackages;
}}}else{if(formElement.type==="hidden"){if(checkBox.checked){formElement.value=totalNumOfItemsToShip[itemCode];
}else{formElement.value=0;
}}}}if(totalNumOfItemsToShip[itemCode]<=1&&checkBox!==null&&checkBox.checked){for(pid in packagesInUse){if(packagesInUse[pid]===true&&packageID!==pid){el=document.getElementById("item_"+itemCode+"_"+pid);
cb=document.getElementById("includeItem_"+itemCode+"_"+pid);
if(cb===null&&el!==null&&el.type==="hidden"&&el.value>0){checkBox.checked=false;
break;
}else{if(el!==null&&el.type==="hidden"&&cb!==null){el.value=0;
cb.checked=false;
}}}}if(packageID!="UNSHIPPEDITEMS"){el=document.getElementById("item_"+itemCode+"_UNSHIPPEDITEMS");
cb=document.getElementById("includeItem_"+itemCode+"_UNSHIPPEDITEMS");
if(cb===null&&el!==null&&el.type==="hidden"&&el.value>0){checkBox.checked=false;
}else{if(el!==null&&el.type==="hidden"&&cb!==null){el.value=0;
cb.checked=false;
}}}}UpdateItemQtyDropDownForItem(itemCode);
};
window.MYO.ES.OnChangeIncludeItemCheckBox=OnChangeIncludeItemCheckBox;
UpdateItemQtyDropDownForItem=function(itemCode,packageID){var totalQtyOrderd,unpackagedItemQty,dropDownsToBeChanged;
var arrayIndex,formElement,qtyInThisPackage,checkbox;
var index,selectBox,numItemsInThisPackage,maxAllowedItemInThisPackage;
var newVal,option,unshippedItemQtyDropdown,unshippedItemCheckBox;
if(packageID!==undefined&&packageID!=="UNSHIPPEDITEMS"){packagesInUse[packageID]=true;
}totalQtyOrderd=totalNumOfItemsToShip[itemCode];
unpackagedItemQty=totalQtyOrderd;
dropDownsToBeChanged=[];
arrayIndex=0;
for(packageID in packagesInUse){if(packagesInUse[packageID]!==true){continue;
}formElement=document.getElementById("item_"+itemCode+"_"+packageID);
qtyInThisPackage=0;
if(formElement!==null){if(formElement.type==="select-one"){qtyInThisPackage=parseInt(formElement.options[formElement.selectedIndex].value);
dropDownsToBeChanged[arrayIndex++]=formElement;
}else{if(formElement.type==="hidden"){qtyInThisPackage=parseInt(formElement.value);
}}}checkbox=document.getElementById("includeItem_"+itemCode+"_"+packageID);
if(checkbox!==null){if(qtyInThisPackage>0){checkbox.checked=true;
}}unpackagedItemQty-=qtyInThisPackage;
}if(unpackagedItemQty<0){return;
}for(index=0;
index<arrayIndex;
index+=1){selectBox=dropDownsToBeChanged[index];
numItemsInThisPackage=parseInt(selectBox.options[selectBox.selectedIndex].value);
maxAllowedItemInThisPackage=unpackagedItemQty+numItemsInThisPackage;
if(selectBox.options.length>maxAllowedItemInThisPackage+1){while(selectBox.options.length>maxAllowedItemInThisPackage+1){selectBox.options[maxAllowedItemInThisPackage+1]=null;
}}else{if(selectBox.options.length<maxAllowedItemInThisPackage+1){for(newVal=selectBox.length;
newVal<=maxAllowedItemInThisPackage;
newVal+=1){option=new Option(newVal,newVal);
selectBox.options[selectBox.length]=option;
}}}}unshippedItemQtyDropdown=document.getElementById("item_"+itemCode+"_UNSHIPPEDITEMS");
if(unshippedItemQtyDropdown!==null&&unshippedItemQtyDropdown.type==="select-one"){if(unshippedItemQtyDropdown.options.length>unpackagedItemQty+1){if(unshippedItemQtyDropdown.options[unshippedItemQtyDropdown.selectedIndex].value>unpackagedItemQty){unshippedItemQtyDropdown.options[unpackagedItemQty].selected=true;
}while(unshippedItemQtyDropdown.length>unpackagedItemQty+1){unshippedItemQtyDropdown.options[unpackagedItemQty+1]=null;
}}else{if(unshippedItemQtyDropdown.length<unpackagedItemQty+1){for(newVal=unshippedItemQtyDropdown.length;
newVal<=unpackagedItemQty;
newVal+=1){option=new Option(newVal,newVal);
unshippedItemQtyDropdown.options[unshippedItemQtyDropdown.length]=option;
}}}unshippedItemCheckBox=document.getElementById("includeItem_"+itemCode+"_UNSHIPPEDITEMS");
if(unshippedItemCheckBox!==null){if(unshippedItemQtyDropdown.options[unshippedItemQtyDropdown.selectedIndex].value>0){unshippedItemCheckBox.checked=true;
}}}RefreshConfirmButtonStatusForCOD();
};
window.MYO.ES.UpdateItemQtyDropDownForItem=UpdateItemQtyDropDownForItem;
GetPlaceholderForNewPackage=function(packageID){var cell;
$("#_myoES_AllPackagesPlaceholder").each(function(){var row;
row=this.insertRow(-1);
cell=row.insertCell(0);
});
return cell;
};
TearDownPageStateForAjaxCall=function(){if(currentAjaxActivePackageID!==-1){$("#_myoES_PackageTitleBarSmallLoadingImagePlaceholder_"+currentAjaxActivePackageID).css("display","none");
$("#_myoES_PackagePlaceholder_"+currentAjaxActivePackageID).css("display","");
}ajaxOperationInProgress=false;
currentAjaxActivePackageID=-1;
UpdateDropDowns();
};
SetUpPageStateForAjaxCall=function(packageID){if(ajaxOperationInProgress){return false;
}else{ajaxOperationInProgress=true;
if(packageID!==undefined){currentAjaxActivePackageID=packageID;
}clearErrorHighlightFromFormFields();
return true;
}};
EditPackageButtonOnClick=function(packageID){var dispID,params;
if(!SetUpPageStateForAjaxCall(packageID)){return false;
}$("#_myoES_PackageTitleBarSmallLoadingImagePlaceholder_"+packageID).css("display","");
$("#_myoES_PackageTitleBarButtonsPlaceholder_"+packageID).css("display","none");
dispID=$("#packageIDToDisplay_"+packageID).val();
params={action:"get-editable-package",orderID:orderID,packageID:packageID,dispPkgID:dispID};
sendAjaxRequest(params,AjaxGetEditablePackageSuccess);
return false;
};
window.MYO.ES.EditPackageButtonOnClick=EditPackageButtonOnClick;
RemovePackageButtonOnClick=function(packageID){var params;
if(!SetUpPageStateForAjaxCall(packageID)){return false;
}$("#_myoES_PackageTitleBarSmallLoadingImagePlaceholder_"+packageID).css("display","");
$("#_myoES_PackageTitleBarButtonsPlaceholder_"+packageID).css("display","none");
params={action:"remove-package",orderID:orderID,packageID:packageID};
sendAjaxRequest(params,AjaxRemovePackageSuccess);
return false;
};
window.MYO.ES.RemovePackageButtonOnClick=RemovePackageButtonOnClick;
NewPackageButtonOnClick=function(){var loading,params;
if(!SetUpPageStateForAjaxCall()){return false;
}loading=$("#_myoES_ConfirmShipmentOrNewPackageButtonLoadingImage").css("display","");
disableAmznButton("_myoES_NewPackageButton");
disableAmznButton("_myoES_ConfirmShipmentButton");
disableAmznButton("_myoES_ConfirmShipmentInvoiceButton");
params={action:"get-new-package",orderID:orderID,newDispPkgID:displayIDForNextPackage};
sendAjaxRequest(params,AjaxAddNewPackageSuccess);
return false;
};
NewConfirmShipmentButtonOnClick=function(confirmInvoice){var packageID,packageIDs;
var isTrackingIdValid=checkTrackingID("UNSHIPPEDITEMS");
packageIDs="UNSHIPPEDITEMS";
for(packageID in packagesInUse){if(packagesInUse[packageID]===true){packageIDs=packageIDs+"#"+packageID;
if(isTrackingIdValid===true){isTrackingIdValid=checkTrackingID(packageID);
}}}if(isTrackingIdValid===true){SubmitConfirmShipmentRequest(packageIDs,confirmInvoice);
}else{MYO.ModalDiv.RevealModal(function(){SubmitConfirmShipmentRequest(packageIDs,confirmInvoice);
});
}return false;
};
SubmitConfirmShipmentRequest=function(packageIDs,confirmInvoice){var allPackagesForm,params;
if(!SetUpPageStateForAjaxCall()){return false;
}$("#_myoES_ConfirmShipmentOrNewPackageButtonLoadingImage").css("display","");
disableAmznButton("_myoES_NewPackageButton");
disableAmznButton("_myoES_ConfirmShipmentButton");
disableAmznButton("_myoES_ConfirmShipmentInvoiceButton");
allPackagesForm=document.getElementById("_myoES_AllPackagesForm");
params=getFormValues(allPackagesForm);
params["action"]="confirm-shipment";
params["orderID"]=orderID;
params["packageIDs"]=packageIDs;
confirmInvoiceCheckbox=document.getElementById("confirmInvoice");
if(confirmInvoiceCheckbox){params["confirmInvoice"]=confirmInvoiceCheckbox.checked;
}else{params["confirmInvoice"]=confirmInvoice;
}var confirmCODCheckBox=document.getElementById("_myoES_confirmCODCheckBox");
if(confirmCODCheckBox){params["confirmCODChecked"]=confirmCODCheckBox.checked;
}sendAjaxRequest(params,AjaxNewConfirmShipmentSuccess);
return false;
};
ReConfirmShipmentButtonOnClick=function(packageID){if(checkTrackingID(packageID)){SubmitReConfirmShipmentRequest(packageID);
}else{MYO.ModalDiv.RevealModal(function(){SubmitReConfirmShipmentRequest(packageID);
});
}return false;
};
SubmitReConfirmShipmentRequest=function(packageID){var params;
if(!SetUpPageStateForAjaxCall(packageID)){return false;
}$("#_myoES_PackageTitleBarSmallLoadingImagePlaceholder_"+packageID).css("display","");
$("#_myoES_PackageTitleBarButtonsPlaceholder_"+packageID).css("display","none");
$("#_myoES_AllPackagesForm").each(function(){params=getFormValues(this);
});
params["action"]="reconfirm-shipment";
params["orderID"]=orderID;
params["packageID"]=packageID;
var confirmCODCheckBox=document.getElementById("_myoES_reConfirmCODCheckBox_"+packageID);
if(confirmCODCheckBox){params["confirmCODChecked"]=confirmCODCheckBox.checked;
}sendAjaxRequest(params,AjaxReConfirmShipmentSuccess);
return false;
};
window.MYO.ES.ReConfirmShipmentButtonOnClick=ReConfirmShipmentButtonOnClick;
BuyPostageButtonOnClick=function(packageID){var params;
if(!SetUpPageStateForAjaxCall(packageID)){return false;
}$("#_myoES_PackageTitleBarSmallLoadingImagePlaceholder_"+packageID).css("display","");
$("#_myoES_PackageTitleBarButtonsPlaceholder_"+packageID).css("display","none");
$("#_myoES_AllPackagesForm").each(function(){params=getFormValues(this);
});
params["action"]="prepare-buy-postage";
params["orderID"]=orderID;
params["packageID"]=packageID;
params["carrierName_"+packageID]="USPS";
sendAjaxRequest(params,AjaxPrepareBuyPostageSuccess);
return false;
};
AjaxPrepareBuyPostageSuccess=function(xml){var result,message,data,redirectURL;
result=getXMLContent("status",xml);
message=getXMLContent("message",xml);
data=getXMLContent("data",xml);
if(result==="success"){redirectURL=getXMLContent("redirect",xml);
window.location=redirectURL;
}else{if(result==="error"){showMessageBoxWithMessage("_myoES_PackageMessagePlaceholder_"+currentAjaxActivePackageID,message);
highlightErrorFields(data);
$("#_myoES_PackageTitleBarSmallLoadingImagePlaceholder_"+currentAjaxActivePackageID).css("display","none");
$("#_myoES_PackageTitleBarButtonsPlaceholder_"+currentAjaxActivePackageID).css("display","");
}}TearDownPageStateForAjaxCall();
};
AjaxNewConfirmShipmentSuccess=function(xml){var result,message,data,redirectURL;
result=getXMLContent("status",xml);
message=getXMLContent("message",xml);
data=getXMLContent("data",xml);
if(result==="success"){redirectURL=getXMLContent("redirect",xml);
window.location=redirectURL;
return;
}else{if(result==="error"){highlightErrorFields(data,xml);
showPageMessage(message);
}}$("#_myoES_ConfirmShipmentOrNewPackageButtonLoadingImage").css("display","none");
enableAmznButton("_myoES_NewPackageButton");
enableAmznButton("_myoES_ConfirmShipmentButton");
enableAmznButton("_myoES_ConfirmShipmentInvoiceButton");
TearDownPageStateForAjaxCall();
};
AjaxReConfirmShipmentSuccess=function(xml){var result,message,data,shipConfirmedPkg;
result=getXMLContent("status",xml);
message=getXMLContent("message",xml);
data=getXMLContent("data",xml);
if(result==="success"){shipConfirmedPkg=getXMLContent("shippedpackage",xml);
$("#_myoES_PackagePlaceholder_"+currentAjaxActivePackageID).each(function(){setHtmlContent(this,shipConfirmedPkg);
});
}else{if(result==="error"){highlightErrorFields(data,xml);
}}if(message!==undefined){showMessageBoxWithMessage("_myoES_PackageMessagePlaceholder_"+currentAjaxActivePackageID,message);
}$("#_myoES_PackageTitleBarSmallLoadingImagePlaceholder_"+currentAjaxActivePackageID).css("display","none");
$("#_myoES_PackageTitleBarButtonsPlaceholder_"+currentAjaxActivePackageID).css("display","");
TearDownPageStateForAjaxCall();
};
AjaxAddNewPackageSuccess=function(xml){var result,packageID,newPackage,cell,message,loading;
result=getXMLContent("status",xml);
if(result==="success"){packageID=getXMLContent("pid",xml);
newPackage=getXMLContent("package",xml);
cell=GetPlaceholderForNewPackage(packageID);
cell.style.display="none";
setHtmlContent(cell,newPackage);
$(cell).fadeIn("medium",SavePageState);
packagesInUse[packageID]=false;
displayIDForNextPackage+=1;
}else{message=getXMLContent("message",xml);
showMessageBoxWithMessage("_myoES_PackageMessagePlaceholder_"+currentAjaxActivePackageID,message);
}loading=$("#_myoES_ConfirmShipmentOrNewPackageButtonLoadingImage").css("display","none");
enableAmznButton("_myoES_NewPackageButton");
enableAmznButton("_myoES_ConfirmShipmentButton");
enableAmznButton("_myoES_ConfirmShipmentInvoiceButton");
TearDownPageStateForAjaxCall();
SavePageState();
};
AjaxRemovePackageSuccess=function(xml){var result,packageID,message;
result=getXMLContent("status",xml);
if(result==="success"){packageID=getXMLContent("pid",xml);
packagesInUse[packageID]=false;
$("#_myoES_PackagePlaceholder_"+packageID).parent().parent().fadeOut("medium",function(){var that=this;
$("#_myoES_AllPackagesPlaceholder").each(function(){this.deleteRow(that.rowIndex);
});
SavePageState();
});
}else{message=getXMLContent("message",xml);
showMessageBoxWithMessage("_myoES_PackageMessagePlaceholder_"+currentAjaxActivePackageID,message);
}TearDownPageStateForAjaxCall();
SavePageState();
};
AjaxGetEditablePackageSuccess=function(xml){var result,packageID,pkgData,message;
result=getXMLContent("status",xml);
if(result==="success"){packageID=getXMLContent("pid",xml);
pkgData=getXMLContent("package",xml);
$("#_myoES_PackagePlaceholder_"+packageID).each(function(){setHtmlContent(this,pkgData);
}).css("display","");
try{fixButtonWidths("#_myoES_PackagePlaceholder_"+packageID);
}catch(e){}}else{if(result==="error"){message=getXMLContent("message",xml);
showMessageBoxWithMessage("_myoES_PackageMessagePlaceholder_"+currentAjaxActivePackageID,message);
}}TearDownPageStateForAjaxCall();
SavePageState();
};
shippingInputOnChange=function(input,id){var shippingServiceInput;
if(isCODOrder||isSDOrder){return;
}$("#_myoES_DefaultShippingInputDiv_"+id).show();
shippingServiceInput=$("#shippingMethod_"+id);
if(shippingServiceInput[0]===input){clearShippingService=false;
}if(clearShippingService){shippingServiceInput.val("");
}};
window.MYO.ES.shippingInputOnChange=shippingInputOnChange;
OtherCarrierToggle=function(carrierSelectBox,id){var curVal,otherCarrierInput;
curVal=carrierSelectBox.options[carrierSelectBox.selectedIndex].value;
otherCarrierInput=$("#carrierName_"+id);
if(curVal!=="Other"){otherCarrierInput.val(curVal).css("display","none");
}else{otherCarrierInput.val("").css("display","");
}shippingInputOnChange(null,id);
SavePageState();
};
window.MYO.ES.OtherCarrierToggle=OtherCarrierToggle;
saveDefaultShippingCheckboxOnClick=function(checkbox){var allInputs,checkboxName;
allInputs=document.getElementsByTagName("input");
for(var i=0;
i<allInputs.length;
i++){inputName=allInputs[i].name.substring(0,20);
if(inputName==="saveDefaultShipping_"&&allInputs[i]!==checkbox){allInputs[i].checked=false;
}}SavePageState();
};
window.MYO.ES.saveDefaultShippingCheckboxOnClick=saveDefaultShippingCheckboxOnClick;
RefreshConfirmButtonStatusForCOD=function(){if(!isCODOrder){return;
}if(!document.getElementById("_myoES_confirmCODCheckBox")){return;
}if(!document.getElementById("_myoES_confirmCODCheckBox").checked){disableAmznButton("_myoES_ConfirmShipmentButton");
disableAmznButton("_myoES_ConfirmShipmentInvoiceButton");
return;
}var trackingId=document.getElementById("trackingID_UNSHIPPEDITEMS");
if(trackingId&&trackingId.value.length==0){disableAmznButton("_myoES_ConfirmShipmentButton");
disableAmznButton("_myoES_ConfirmShipmentInvoiceButton");
return;
}for(packageID in packagesInUse){if(packagesInUse[packageID]==true){trackingId=document.getElementById("trackingID_"+packageID);
if(trackingId&&trackingId.value.length==0){disableAmznButton("_myoES_ConfirmShipmentButton");
disableAmznButton("_myoES_ConfirmShipmentInvoiceButton");
return;
}}}var itemCode,packageID,totalItems,checkBox,formElement;
disableAmznButton("_myoES_ConfirmShipmentButton");
disableAmznButton("_myoES_ConfirmShipmentInvoiceButton");
for(itemCode in totalNumOfItemsToShip){totalItems=0;
checkBox=document.getElementById("includeItem_"+itemCode+"_UNSHIPPEDITEMS");
formElement=document.getElementById("item_"+itemCode+"_UNSHIPPEDITEMS");
if(formElement!=null&&(!checkBox||checkBox.checked)){totalItems=parseInt(formElement.value);
}for(packageID in packagesInUse){if(packagesInUse[packageID]==true){checkBox=document.getElementById("includeItem_"+itemCode+"_"+packageID);
formElement=document.getElementById("item_"+itemCode+"_"+packageID);
if(formElement!=null&&(!checkBox||checkBox.checked)){totalItems=totalItems+parseInt(formElement.value);
}}}if(totalItems!=totalNumOfItemsToShip[itemCode]){disableAmznButton("_myoES_ConfirmShipmentButton");
disableAmznButton("_myoES_ConfirmShipmentInvoiceButton");
return;
}}enableAmznButton("_myoES_ConfirmShipmentButton");
enableAmznButton("_myoES_ConfirmShipmentInvoiceButton");
};
window.MYO.ES.RefreshConfirmButtonStatusForCOD=RefreshConfirmButtonStatusForCOD;
RefreshReConfirmButtonStatusForCOD=function(packageID){if(!isCODOrder){return;
}if(!document.getElementById("_myoES_reConfirmCODCheckBox_"+packageID).checked){disableAmznButton("_myoES_ReConfirmShipmentButton_"+packageID);
return;
}var trackingId=document.getElementById("trackingID_"+packageID);
if(trackingId&&trackingId.value.length==0){disableAmznButton("_myoES_ReConfirmShipmentButton_"+packageID);
return;
}enableAmznButton("_myoES_ReConfirmShipmentButton_"+packageID);
};
window.MYO.ES.RefreshReConfirmButtonStatusForCOD=RefreshReConfirmButtonStatusForCOD;
$(document).ready(function(){var itemQuantities,key;
itemQuantities=spec.itemQuantities||{};
for(key in itemQuantities){if(itemQuantities.hasOwnProperty(key)){$(key).attr("selectedIndex",itemQuantities[key]);
}}LoadPageState();
UpdateDropDowns();
$("#_myoES_NewPackageButton").click(NewPackageButtonOnClick);
$("#_myoES_ConfirmShipmentButton").click(function(){return NewConfirmShipmentButtonOnClick(false);
});
$("#_myoES_ConfirmShipmentInvoiceButton").click(function(){return NewConfirmShipmentButtonOnClick(true);
});
});
};
module.LO=function(spec){var maxLengths,searchQueryRenderedSerial,searchQueryCounter,numConcurrentSearchQueries,extendedWaitTimeEvent,marketplaces,showExtraItems,showSKU,refundHTML,refundFor,refundStatusMap,extendedWaitMessageTimeout,ajaxBelowTheFoldUrl,ajaxBelowTheFoldRows,isAjaxBelowTheFoldComplete,batchRefundAction,allStatuses,buyerNameMap,noNameStr,doGetBuyerName,shippingRegionMap,doShowShippingRegion,enableGiftReturnPopup,modalHeader,modalText,modalRefundText,modalAccept,modalClickHere,modalGoToMyr,modalMyrUrl;
var SearchFormOnSubmit,OnChangeSearchType,OnChangeDateRange,SaveDefaultSearchSuccess,ResetRefundSummaries,GetRefundSummaries,GetRefundSummariesSuccess,ShowRefundMessage,AjaxSearchOrdersSuccess,InitSearchOnPageLoad,AjaxBelowTheFoldSuccess,GetBuyerNameSuccess,ResetBuyerName,GetShippingRegion,GetShippingRegionSuccess,ResetShippingRegion,ShowShippingRegion,ShowGiftReturnPopup,OnAjaxCheckGiftReturnSuccess,GetShipmentAtRisk,GetShipmentAtRiskSuccess;
var SaveDefaultSearch,DoAjaxSearchCall,DoAjaxBelowTheFold,GetBuyerName;
maxLengths=spec.maxLengths;
marketplaces=spec.marketplaces;
showExtraItems=spec.showExtraItems;
showSKU=spec.showSKU;
refundHTML=spec.refundHTML;
refundFor=spec.refundFor;
extendedWaitMessageTimeout=spec.extendedWaitMessageTimeout;
ajaxBelowTheFoldUrl=spec.ajaxBelowTheFoldUrl;
ajaxBelowTheFoldRows=spec.ajaxBelowTheFoldRows;
if(spec.batchRefundAction=="get-refund-summaries"||spec.batchRefundAction=="get-refund-summaries-via-smrfs"){batchRefundAction=spec.batchRefundAction;
}else{batchRefundAction="get-refund-summaries";
}allStatuses=spec.allStatuses;
noNameStr=spec.noNameStr;
doGetBuyerName=spec.doGetBuyerName;
doShowShippingRegion=spec.showShippingRegion;
buyerNameMap={};
shippingRegionMap={};
refundStatusMap={};
searchQueryRenderedSerial=-1;
searchQueryCounter=0;
numConcurrentSearchQueries=0;
isAjaxBelowTheFoldComplete=false;
modalHeader=spec.modalHeader;
modalText=spec.modalText;
modalAccept=spec.modalAccept;
modalReject=spec.modalReject;
modalAcceptUrl=spec.modalAcceptUrl;
modalClickHere=spec.modalClickHere;
modalGoToMyr=spec.modalGoToMyr;
modalMyrUrl=spec.modalMyrUrl;
enableGiftReturnPopup=spec.enableGiftReturnPopup;
window.MYO.ModalDiv({modalHeader:modalHeader,modalHTML:"<p>"+modalText+"</p><p><a id='_myo_go_to_myr_link' href='"+modalMyrUrl+"'>"+modalClickHere+"</a>"+modalGoToMyr+"</p>",modalAccept:modalAccept,modalReject:modalReject});
SearchFormOnSubmit=function(){var searchType=document.getElementById("_myoLO_SearchTypeSelect").value;
if(searchType==="ShipRange"){var shipSearchDateRange=$("#_myoLO_shipSelectedRangeSelect").val();
if(shipSearchDateRange==="noTimeLimit"||shipSearchDateRange==="shipExactDates"){$("#_myoLO_shipSearchDateOption").val(shipSearchDateRange);
}else{$("#_myoLO_shipSearchDateOption").val("shipPreSelected");
}}else{if(searchType!=="OrderID"){var searchDateRange=$("#_myoLO_preSelectedRangeSelect").val();
if(searchDateRange==="noTimeLimit"||searchDateRange==="exactDates"){$("#_myoLO_searchDateOption").val(searchDateRange);
}else{$("#_myoLO_searchDateOption").val("preSelected");
}}}var div;
if(searchType!=="OrderStatus"&&searchType!=="ShipRange"){div=document.getElementById("_myoLO_statusFilterSelect");
if(div){(div).value="Default";
}}if(searchType!=="FulfilledBy"){div=document.getElementById("_myoLO_fulfilledByFilterSelect");
if(div){(div).value="all";
}}if(searchType!=="OrderType"){div=document.getElementById("_myoLO_orderTypeFilterSelect");
if(div){(div).value="All";
}}if(searchType!=="ShippingService"){div=document.getElementById("_myoLO_shippingServiceSelect");
if(div){(div).value="All";
}}if(searchType!=="Marketplace"){div=document.getElementById("_myoLO_marketplaceFilterSelect");
if(div){(div).value="sitesall";
}}if(DoAjaxSearchCall(this)){this.submit();
}return false;
};
OnChangeSearchType=function(){var allSearchDivs,divsToShowBySearchType,index,div,byDateDiv;
allSearchDivs=["_myoLO_keywordDiv","_myoLO_orderStatusDiv","_myoLO_fulfilledByDiv","_myoLO_marketplaceDiv","_myoLO_paymentMethodDiv","_myoLO_shipmentStatusDiv","_myoLO_orderTypeDiv","_myoLO_shippingServiceDiv"];
divsToShowBySearchType={"DateRange":[],"ShipRange":["_myoLO_orderStatusDiv"],"OrderID":["_myoLO_keywordDiv"],"FulfilledBy":["_myoLO_fulfilledByDiv"],"OrderStatus":["_myoLO_orderStatusDiv"],"Marketplace":["_myoLO_marketplaceDiv"],"PaymentMethod":["_myoLO_paymentMethodDiv"],"ShipmentStatus":["_myoLO_shipmentStatusDiv"],"OrderType":["_myoLO_orderTypeDiv"],"ShippingService":["_myoLO_shippingServiceDiv"],"Default":["_myoLO_keywordDiv"]};
for(index=0;
index<allSearchDivs.length;
++index){div=document.getElementById(allSearchDivs[index]);
divsToShow=divsToShowBySearchType[this.value]?divsToShowBySearchType[this.value]:divsToShowBySearchType["Default"];
if(div){if($.inArray(allSearchDivs[index],divsToShow)>-1){div.style.display="";
}else{div.style.display="none";
}}}if(this.value==="OrderID"){DisplayOrderOrShipDateDivs("none");
}else{if(this.value==="ShipRange"){DisplayOrderOrShipDateDivs("shipDate");
$("#_myoLO_byDateDivSelect").val("shipDate");
MYO.LimitOrExpandStatuses("#_myoLO","hide",allStatuses);
}else{DisplayOrderOrShipDateDivs("orderDate");
$("#_myoLO_byDateDivSelect").val("orderDate");
MYO.LimitOrExpandStatuses("#_myoLO","show",allStatuses);
}}var keyword=document.getElementById("searchKeyword");
if(maxLengths[this.value]!==undefined){keyword.maxLength=maxLengths[this.value];
}};
OnChangeDateRange=function(){var searchType=$("#_myoLO_SearchTypeSelect").val();
var byDate=$("#_myoLO_byDateDivSelect").val();
if(byDate==="orderDate"&&this.value==="exactDates"&&searchType!=="OrderID"&&searchType!=="ShipRange"){$("#_myoLO_exactDateDiv").show();
}else{$("#_myoLO_exactDateDiv").hide();
}};
OnChangeShipRange=function(){var searchType=$("#_myoLO_SearchTypeSelect").val();
var byDate=$("#_myoLO_byDateDivSelect").val();
if(byDate==="shipDate"&&this.value==="shipExactDates"&&searchType==="ShipRange"){$("#_myoLO_shipExactDateDiv").show();
}else{$("#_myoLO_shipExactDateDiv").hide();
}};
DisplayOrderOrShipDateDivs=function(dateType){if(dateType==="orderDate"){$("#_myoLO_dateRangeOptionDiv").show();
if($("#_myoLO_preSelectedRangeSelect").val()==="exactDates"){$("#_myoLO_exactDateDiv").show();
}else{$("#_myoLO_exactDateDiv").hide();
}$("#_myoLO_shipRangeOptionDiv").hide();
$("#_myoLO_shipExactDateDiv").hide();
}else{if(dateType==="shipDate"){$("#_myoLO_dateRangeOptionDiv").hide();
$("#_myoLO_exactDateDiv").hide();
$("#_myoLO_shipRangeOptionDiv").show();
if($("#_myoLO_shipSelectedRangeSelect").val()==="shipExactDates"){$("#_myoLO_shipExactDateDiv").show();
}else{$("#_myoLO_shipExactDateDiv").hide();
}}else{$("#_myoLO_dateRangeOptionDiv").hide();
$("#_myoLO_shipRangeOptionDiv").hide();
$("#_myoLO_exactDateDiv").hide();
$("#_myoLO_shipExactDateDiv").hide();
}}};
SaveDefaultSearch=function(checkBox,queryString){if(!checkBox.checked){return;
}checkBox.disabled=true;
var params={"action":"save-default-search","query":queryString};
sendAjaxRequest(params,SaveDefaultSearchSuccess);
document.getElementById("_myoLO_SaveSearchFailureImagePlaceholder").style.display="none";
document.getElementById("_myoLO_SaveSearchSuccessImagePlaceholder").style.display="none";
document.getElementById("_myoLO_SaveSearchLoadingImagePlaceholder").style.display="";
};
window.MYO.LO.SaveDefaultSearch=SaveDefaultSearch;
SaveDefaultSearchSuccess=function(xml){var result=getXMLContent("status",xml);
document.getElementById("_myoLO_SaveSearchLoadingImagePlaceholder").style.display="none";
if(result=="error"){document.getElementById("_myoLO_SaveSearchFailureImagePlaceholder").style.display="";
document.getElementById("_myoLO_saveDefaultSearchCheckBox").disabled=false;
document.getElementById("_myoLO_saveDefaultSearchCheckBox").checked=false;
}else{if(result=="success"){document.getElementById("_myoLO_SaveSearchSuccessImagePlaceholder").style.display="";
}}};
ResetShippingRegion=function(){shippingRegionMap={};
};
GetShippingRegion=function(){if(!doShowShippingRegion){return false;
}var addressCodes={};
$("tr.order-row").each(function(i,elem){var orderId=$(".order-id",elem).val();
var addressId=$("[id^=_myoLO_"+orderId+"_shippingRegionInfoDiv]",elem).text();
if(!shippingRegionMap[orderId]){shippingRegionMap[orderId]=1;
addressCodes[orderId]=addressId;
}});
if(!$.isEmptyObject(addressCodes)){var params={"action":"get-shipping-regions","addressCodes":JSON.stringify(addressCodes)};
sendAjaxRequest(params,GetShippingRegionSuccess);
}};
GetShippingRegionSuccess=function(xml){var result=getXMLContent("status",xml);
if(result!="success"){return false;
}var regions=getXMLContentMap("regions",xml);
ShowShippingRegion(regions);
};
ShowShippingRegion=function(regionMap){for(var orderId in regionMap){regionElement=document.getElementById("_myoLO_"+orderId+"_shippingRegionInfoDiv");
if(regionElement!=null){regionElement.innerHTML=regionMap[orderId];
}styleDiv=document.getElementById("_myoLO_"+orderId+"_shippingRegionDiv");
if(styleDiv!=null){styleDiv.style="";
}}};
ResetRefundSummaries=function(){refundStatusMap={};
};
GetRefundSummaries=function(){var orderRefs=[];
$("tr.order-row").each(function(i,elem){var orderId=$(".order-id",elem).val();
if(!refundStatusMap[orderId]){refundStatusMap[orderId]=1;
var esLevel=$(".es-level",elem).val();
var numShipped=$(".num-shipped",elem).val();
orderRefs.push(orderId+"|"+esLevel+"|"+numShipped);
}});
if(orderRefs.length>0){var params={"action":batchRefundAction,"orderRefs":orderRefs.join("#")};
sendAjaxRequest(params,GetRefundSummariesSuccess);
}};
GetShipmentAtRisk=function(){if(!gpListOrderRecon){return;
}var orders=[];
$("tr.order-row").each(function(i,elem){if($(".isPrime",elem).val()==="1"&&$(".numberOfItemsRemainingToShip",elem).val()>0){var orderId=$(".order-id",elem).val();
var marketplaceId=$(".marketplace-id",elem).val();
var fulfillmentServiceLevel=$(".fulfillmentServiceLevel",elem).val();
var latestShipDate=$(".latestShipDate",elem).val();
orders.push(orderId+":"+marketplaceId+":"+fulfillmentServiceLevel+":"+latestShipDate);
}});
if(orders.length>0){var params={"action":"getOrdersWithShipmentAtRisk","orderShipmentInfoList":orders.join("|")};
$.ajax({url:hzAjaxActionRootUrl+"action",type:"post",contentType:"application/x-www-form-urlencoded",data:params,success:GetShipmentAtRiskSuccess,error:function(err){console.error(err);
}});
}};
GetShipmentAtRiskSuccess=function(json){if(json.remoteResponseData&&json.remoteResponseData.ordersWithShipmentAtRisk){for(var i=0;
i<json.remoteResponseData.ordersWithShipmentAtRisk.length;
i++){var orderId=json.remoteResponseData.ordersWithShipmentAtRisk[i];
$("#row-"+orderId+" .ship-risk").show();
}}};
GetRefundSummariesSuccess=function(xml){var result=getXMLContent("status",xml);
if(result=="success"){var orderids=getXMLContentArray("orderid",xml);
var orderitems=getXMLContentArray("item",xml);
var refquants=getXMLContentArray("qty",xml);
var orderrefundstatuses=getXMLContentArray("orderrefundstatus",xml);
if(orderids!=undefined&&orderitems!=undefined){ShowRefundMessage(orderids,orderitems,refquants,orderrefundstatuses);
saveJSObject("refundedOrdersList",orderids);
saveJSObject("refundedItemsList",orderitems);
saveJSObject("refundedQuantities",refquants);
saveJSObject("refundedOrderStatuses",orderrefundstatuses);
}}};
ShowRefundMessage=function(orderids,orderitems,refquants,orderrefundstatuses){var i,payment,refund,refundPending,item,oidiv,quantity,productName,asin,sku,refundHTMLLocal;
if(orderids==undefined){return;
}for(i=0;
i<orderids.length;
++i){payment=document.getElementById("_myoLO_"+orderids[i]+"_paymentInfoDiv");
refund=document.getElementById("_myoLO_"+orderids[i]+"_refundInfoDiv");
refundPending=document.getElementById("_myoLO_"+orderids[i]+"_refundPendingInfoDiv");
if(payment!=null){payment.style.display="none";
}if(orderrefundstatuses!=undefined&&orderrefundstatuses.length>0){if(orderrefundstatuses[i]=="applied"&&refund!=null){refund.style.display="";
}else{if(orderrefundstatuses[i]=="pending"&&refundPending!=null){refundPending.style.display="";
}}}else{if(refund!=null){refund.style.display="";
}}}if(showExtraItems){if(orderitems==undefined){return;
}for(i=0;
i<orderitems.length;
++i){item=orderitems[i];
oidiv=document.getElementById("_myoLO_"+item+"_orderItem");
if(oidiv==null){continue;
}productName=refundFor+document.getElementById("_myoLO_"+item+"_product").innerHTML;
quantity=refquants[i];
asin=document.getElementById("_myoLO_"+item+"_asin").innerHTML;
if(showSKU){sku=document.getElementById("_myoLO_"+item+"_sku").innerHTML;
}refundHTMLLocal=refundHTML;
refundHTMLLocal=refundHTMLLocal.replace(/PRODUCT_SUBST/,productName);
refundHTMLLocal=refundHTMLLocal.replace(/QUANTITY_SUBST/,quantity);
refundHTMLLocal=refundHTMLLocal.replace(/ASIN_SUBST/,asin);
if(showSKU){refundHTMLLocal=refundHTMLLocal.replace(/SKU_SUBST/,sku);
}oidiv.innerHTML=oidiv.innerHTML+refundHTMLLocal;
}}};
DoAjaxSearchCall=function(clicked_obj,query){if(numConcurrentSearchQueries>=4){return false;
}var params;
if(clicked_obj!=undefined&&clicked_obj.className=="myo_list_orders_search_form"){clearErrorHighlightFromFormFields();
params=getFormValues(clicked_obj);
params["query"]="";
}else{if(clicked_obj!=undefined&&clicked_obj.className=="myo_list_orders_link"){params={"query":clicked_obj.href};
}else{if(query!=undefined){params={"query":query};
}}}var loadingImage=document.getElementById("_myoLO_searchOrdersInProgressLoadingImage");
if(loadingImage.style.display=="none"){var width=document.body.offsetWidth;
var left=(width/2)-150;
loadingImage.style.left=left+"px";
loadingImage.style.display="";
extendedWaitTimeEvent=setTimeout("document.getElementById('_myoLO_pleaseWaitExtendedMessage' ).style.display = ''",extendedWaitMessageTimeout);
}searchQueryCounter++;
numConcurrentSearchQueries++;
params["action"]="search-orders";
params["serial"]=searchQueryCounter;
params["startTime"]=new Date().getTime();
ResetRefundSummaries();
ResetBuyerName();
ResetShippingRegion();
sendAjaxRequest(params,AjaxSearchOrdersSuccess);
return false;
};
window.MYO.LO.DoAjaxSearchCall=DoAjaxSearchCall;
AjaxSearchOrdersSuccess=function(xml){numConcurrentSearchQueries--;
hideMessageBox();
var result=getXMLContent("status",xml);
var serial=parseInt(getXMLContent("serial",xml));
if(numConcurrentSearchQueries<=0||serial==searchQueryCounter){document.getElementById("_myoLO_searchOrdersInProgressLoadingImage").style.display="none";
document.getElementById("_myoLO_pleaseWaitExtendedMessage").style.display="none";
try{clearTimeout(extendedWaitTimeEvent);
}catch(e){}}if(serial<searchQueryRenderedSerial){return;
}else{searchQueryRenderedSerial=serial;
}if(result=="success"){var redirectURL=getXMLContent("redirect",xml);
if(redirectURL!=undefined&&redirectURL!=""){window.location=redirectURL;
return;
}var orderlist=getXMLContent("list",xml);
var refundref=getXMLContent("refundref",xml);
var descheader=getXMLContent("descheader",xml);
setHtmlContent(document.getElementById("_myoLO_OrderListingOuterPlaceholderDiv"),orderlist);
saveDivContent("_myoLO_OrderListingOuterPlaceholderDiv",orderlist);
if(descheader!=undefined&&descheader!=""){setHtmlContent(document.getElementById("_myoLO_SearchOrdersDescriptionHeaderPlaceholderDiv"),descheader);
saveDivContent("_myoLO_SearchOrdersDescriptionHeaderPlaceholderDiv",descheader);
}var requestId=getXMLContent("requestId",xml);
var startTime=getXMLContent("startTime",xml);
if(typeof ues=="function"){ues("id",requestId,requestId);
ues("t0",requestId,new Date(parseInt(startTime)));
ues("ctb",requestId,"1");
}if(typeof uet=="function"){uet("cf",requestId);
}if(typeof uex=="function"){uex("ld",requestId);
}saveJSObject("isAjaxContext",true);
GetRefundSummaries();
GetBuyerName();
GetShippingRegion();
GetShipmentAtRisk();
}else{if(result=="error"){var data=getXMLContent("data",xml);
var message=getXMLContent("message",xml);
highlightErrorFields(data,xml);
showPageMessage(message);
window.scrollTo(0,0);
}}};
DoAjaxBelowTheFold=function(params){params["action"]="search-orders";
params["serial"]=searchQueryCounter;
params["startTime"]=new Date().getTime();
sendAjaxRequest(params,AjaxBelowTheFoldSuccess);
return false;
};
window.MYO.LO.DoAjaxBelowTheFold=DoAjaxBelowTheFold;
AjaxBelowTheFoldSuccess=function(xml){if(isAjaxBelowTheFoldComplete){return;
}isAjaxBelowTheFoldComplete=true;
var result=getXMLContent("status",xml);
if(result=="success"){if(xml){var list=getXMLContent("list",xml),$btmActionBar=$("tr.action-bar:last"),$orderList=$(list),$orderRows=StripListContainer($orderList);
$("#_myoLO_AjaxBelowTheFoldLoadingIndicator").hide();
$btmActionBar.before($orderRows);
GetRefundSummaries();
GetBuyerName();
GetShippingRegion();
GetShipmentAtRisk();
}}else{if(result=="error"){var data=getXMLContent("data",xml);
var message=getXMLContent("message",xml);
highlightErrorFields(data,xml);
showPageMessage(message);
window.scrollTo(0,0);
}else{showPageMessage(genericErrorMessage);
window.scrollTo(0,0);
}}};
ResetBuyerName=function(){buyerNameMap={};
};
GetBuyerName=function(){if(!doGetBuyerName){return false;
}var orderRefs={};
var nameRefs={};
var merchFulfilledRefs={};
var orderMarketplaceID={};
$("tr.order-row").each(function(i,elem){var orderId=$(".order-id",elem).val();
var custId=$(".cust-id",elem).val();
var custName=$("[id^=_myoLO_"+orderId+"_buyerName]",elem).text();
var merchFulfilled=$(".merch-fulfilled",elem).val();
var marketplaceID=$(".marketplace-id",elem).val();
if(!buyerNameMap[orderId]){orderRefs[orderId]=custId;
buyerNameMap[orderId]=1;
merchFulfilledRefs[orderId]=merchFulfilled;
orderMarketplaceID[orderId]=marketplaceID;
}if(typeof custName!=="undefined"){nameRefs[custId]=custName;
}});
if(!$.isEmptyObject(orderRefs)){var params={"action":"get-buyer-name","orderRefs":JSON.stringify(orderRefs),"nameRefs":JSON.stringify(nameRefs),"merchFulfilledRefs":JSON.stringify(merchFulfilledRefs),"orderMarketplaceID":JSON.stringify(orderMarketplaceID)};
sendAjaxRequest(params,GetBuyerNameSuccess);
}return false;
};
window.MYO.LO.GetBuyerName=GetBuyerName;
ShowGiftReturnPopup=function(orderId){var params={"action":"check-gift-return","orderID":orderId};
sendAjaxRequest(params,OnAjaxCheckGiftReturnSuccess);
};
OnAjaxCheckGiftReturnSuccess=function(xml){var hasGiftReturn=getXMLContent("hasGiftReturn",xml);
var orderId=getXMLContent("orderId",xml);
if(hasGiftReturn==="1"){var goToMyrUrl="/gp/returns/list/ref=myo_lo_contact_buyer_popup?searchType=orderId&keywordSearch="+orderId;
$("#_myo_go_to_myr_link").attr("href",goToMyrUrl);
MYO.ModalDiv.RevealModal(function(){window.location.href=modalAcceptUrl+"?orderID="+orderId+"&custType=giftBuyer";
});
}else{window.location.href=modalAcceptUrl+"?orderID="+orderId+"&custType=buyer";
}};
GetBuyerNameSuccess=function(xml){var status=getXMLContent("status",xml);
if(status=="success"){var data=xml.getElementsByTagName("data");
if(data!=undefined&&data.length>0){var orders=data[0].getElementsByTagName("order");
if(orders!=undefined&&orders.length>0){for(var i=0;
i<orders.length;
i++){var orderId=getXMLContent("orderId",orders[i]);
var name=getXMLContent("name",orders[i]);
$("tr.order-row #_myoLO_"+orderId+"_buyerName").html(name);
if(enableGiftReturnPopup==="1"){$("tr.order-row #_myoLO_"+orderId+"_buyerName").click((function(clickOrderId){return function(event){ShowGiftReturnPopup(clickOrderId);
if(event.preventDefault){event.preventDefault();
}else{event.returnValue=false;
}};
})(orderId));
}}return false;
}}}$("tr.order-row [id$=_buyerName]").html(noNameStr);
};
StripListContainer=function($orderList){var rowThreshold=3,bottomRowThreshold=-4;
if($("#myo-table").length===0){rowThreshold=4;
}return $orderList.find("tbody:first").children().slice(rowThreshold,bottomRowThreshold);
};
ToggleHelpDialog=function(button){var isOpen=$(button).dialog("isOpen");
if(!isOpen){$(".ui-dialog-content").dialog("close");
$(button).dialog("open");
}else{$(button).dialog("close");
}};
$(document).ready(function(){$("#_myoLO_SearchTypeSelect").change(OnChangeSearchType).change();
$("#_myoLO_preSelectedRangeSelect").change(OnChangeDateRange).change();
$("#_myoLO_shipSelectedRangeSelect").change(OnChangeShipRange).change();
$("#_myoLO_SearchForm").submit(SearchFormOnSubmit);
var isAjaxContext=false;
if(loadPageState()){isAjaxContext=getJSObject("isAjaxContext");
}if(!isAjaxContext&&ajaxBelowTheFoldRows&&ajaxBelowTheFoldUrl){DoAjaxBelowTheFold({"query":ajaxBelowTheFoldUrl});
}createDatePickers();
$("#_myoQL_pendingHelpDialog").dialog({position:{my:"right top",at:"right bottom",offset:"10 8",of:$("#_myoQL_helpImg")},autoOpen:false,show:{effect:"blind",duration:200}});
$("#_myoQL_advancedHelpDialog").dialog({position:{my:"right top",at:"right bottom",offset:"10 8",of:$("#_myoQL_advancedHelpImg")},autoOpen:false,show:{effect:"blind",duration:200}});
$("#_myoQL_helpImg").mouseenter(function(){ToggleHelpDialog("#_myoQL_pendingHelpDialog");
});
$("#_myoQL_advancedHelpImg").mouseenter(function(){ToggleHelpDialog("#_myoQL_advancedHelpDialog");
});
delayAjaxCall(GetRefundSummaries);
delayAjaxCall(GetBuyerName);
delayAjaxCall(GetShippingRegion);
delayAjaxCall(GetShipmentAtRisk);
});
};
module.PN=function(spec){var savedMemoText,memoID,isEditing,memoLimit,orderID,SaveButtonClicked,UndoButtonClicked,CharTyped,OnAjaxSaveSuccess,ValidateTextLength;
memoLimit=spec.memoLimit;
orderID=spec.orderID;
savedMemoText=spec.savedMemoText;
window.MYO.InitializeTextAreaValidation(spec.limitsText);
memoID="_myoPN_note";
isEditing=false;
SaveButtonClicked=function(){var newNote=document.getElementById(memoID).value;
document.getElementById(memoID).disabled=true;
disableAmznButton("_myoPN_SaveButton");
disableAmznButton("_myoPN_UndoButton");
var params={"action":"update-private-note","orderID":orderID,"privateNote":newNote};
sendAjaxRequest(params,OnAjaxSaveSuccess);
return false;
};
UndoButtonClicked=function(){var textareaobj=document.getElementById(memoID);
if(textareaobj){textareaobj.value=savedMemoText;
disableAmznButton("_myoPN_SaveButton");
disableAmznButton("_myoPN_UndoButton");
textareaobj.style.backgroundColor="#ffffff";
}ValidateTextLength(memoID,"_myoPN_sellerMemoTextLengthNotification");
isEditing=false;
};
OnAjaxSaveSuccess=function(xml){var res=getXMLContent("status",xml);
var msg=getXMLContent("message",xml);
var data=getXMLContent("data",xml);
if(res!="success"){highlightErrorFields(data);
}var textareaobj=document.getElementById(memoID);
if(textareaobj){savedMemoText=textareaobj.value;
textareaobj.disabled=false;
textareaobj.style.backgroundColor="#ffffff";
}isEditing=false;
showPageMessage(msg);
};
CharTyped=function(){var textareaid,notificationdivid;
textareaid="_myoPN_note";
notificationdivid="_myoPN_sellerMemoTextLengthNotification";
ValidateTextLength(textareaid,notificationdivid);
var textareaobj=document.getElementById(memoID);
if(textareaobj){if(!isEditing){isEditing=true;
textareaobj.style.backgroundColor="#ffffcc";
enableAmznButton("_myoPN_UndoButton");
}if(textareaobj.value.length>memoLimit){disableAmznButton("_myoPN_SaveButton");
}else{enableAmznButton("_myoPN_SaveButton");
}}};
ValidateTextLength=function(textareaid,notificationdivid){var textareaobj=document.getElementById(textareaid);
var notificationArea=document.getElementById(notificationdivid);
if(textareaobj!=null&&notificationArea!=null){window.MYO.ValidateTextArea(textareaobj,notificationArea,memoLimit);
if(textareaobj.value.length>0){notificationArea.style.display="block";
}else{notificationArea.style.display="none";
}if(textareaobj.value.length>memoLimit){notificationArea.style.fontWeight="bold";
notificationArea.style.color="#992211";
}else{notificationArea.style.fontWeight="normal";
notificationArea.style.color="";
}}};
$(document).ready(function(){disableAmznButton("_myoPN_UndoButton");
disableAmznButton("_myoPN_SaveButton");
var textareaobj=document.getElementById(memoID);
textareaobj.value=savedMemoText;
$("#_myoPN_UndoButton").click(UndoButtonClicked);
$("#_myoPN_PrivateNoteForm").submit(SaveButtonClicked);
$("#_myoPN_note").keyup(CharTyped);
});
};
module.RO=function(spec){var TOTAL_ID="totalRefund";
var REST_ID="restRefundAmount";
var BASE_ID="baseRefundAmount";
var REFUND_TOGGLE_PREFIX="doRefund_";
var BUYERMEMOLIMIT;
var CURR_SEP;
var CURR_SYM;
var CURR_BEFORE;
var CURR_DEC;
var POINTS_SYM;
var ajaxRequestInProgress,orderID,oldVals,badFields,modalHeader,modalText,modalRefundText,modalAccept,modalReject,SubmitRefundRequest,VerifyFields,GetOldVal,OnAjaxRefundActionSuccess,OnAjaxLoadFormSuccess,CheckFloat,UpdateField,ShowingRefund,ResetRefundTotals,VerifyFloat,FormatCurrency,redirectUrlOnSuccess,processFullReversalAction,processPartialReversalAction,UpdatePointsTotals,isGiftReturn,returnRequestId,refundRecipient,accidentalRefundModalSpec,accidentalOverRefundModalSpec,overRefundModalSpec,accidentalModalText,accidentalOverModalText,accidentalModalAccept,accidentalModalReject,OnAjaxCheckGiftSuccess,myrUrl,goToMyrText,goToMyrHighlighted,hasGiftReturn;
var RefundTypeSelected,FullRefundButtonOnClick,PartialRefundButtonOnClick,UpdateFullTotal,ValidateMemoToBuyerTextLength,ToggleRefund,UpdateSubtotal;
var isCODOrder;
orderID=spec.orderID;
processFullReversalAction=spec.processFullReversalAction||"process-refund";
processPartialReversalAction=spec.processPartialReversalAction||"process-refund";
BUYERMEMOLIMIT=spec.buyerMemoLimit;
CURR_SEP=spec.currencySeparator;
CURR_SYM=spec.currencySymbol;
CURR_BEFORE=spec.currencyBefore;
CURR_DEC=spec.currencyDecimals;
POINTS_SYM=spec.pointsSymbol;
modalHeader=spec.modalHeader;
modalText=spec.modalText;
modalRefundText=spec.modalRefundText;
modalAccept=spec.modalAccept;
modalReject=spec.modalReject;
redirectUrlOnSuccess=spec.redirectUrlOnSuccess;
ajaxRequestInProgress=false;
oldVals={};
badFields={};
isGiftReturn=spec.isGiftReturn;
returnRequestId=spec.returnRequestId||"";
refundRecipient=spec.refundRecipient||"";
accidentalModalText=spec.accidentalModalText;
accidentalOverModalText=spec.accidentalOverModalText;
accidentalModalAccept=spec.accidentalModalAccept;
accidentalModalReject=spec.accidentalModalReject;
goToMyrHighlighted=spec.goToMyrHighlighted;
goToMyrText=spec.goToMyrText;
myrUrl=spec.myrUrl;
hasGiftReturn=undefined;
isCODOrder=spec.isCODOrder;
overRefundModalSpec={modalHeader:modalHeader,modalHTML:"<p>"+modalText+"</p><p>"+modalRefundText+"<span id='refundOveragePopup'></span></p>",modalAccept:modalAccept,modalReject:modalReject,updateFn:function(){var total=$("#"+TOTAL_ID).text();
$("#refundOveragePopup").text(total);
}};
if(typeof(isGiftReturn)!=="undefined"){accidentalRefundModalSpec={modalHeader:modalHeader,modalHTML:"<p>"+accidentalModalText+"</p><p><a href='"+myrUrl+"'>"+goToMyrHighlighted+"</a>"+goToMyrText+"</p>",modalAccept:accidentalModalAccept,modalReject:accidentalModalReject};
accidentalOverRefundModalSpec={modalHeader:modalHeader,modalHTML:"<p>"+accidentalOverModalText+"</p><p><a href='"+myrUrl+"'>"+goToMyrHighlighted+"</a>"+goToMyrText+"</p><p>"+modalRefundText+"<span id='refundOveragePopup'></span></p>",modalAccept:accidentalModalAccept,modalReject:accidentalModalReject,updateFn:function(){var total=$("#"+TOTAL_ID).text();
$("#refundOveragePopup").text(total);
}};
}window.MYO.InitializeTextAreaValidation(spec.limitsText);
window.MYO.ModalDiv(overRefundModalSpec);
SubmitRefundRequest=function(frm,action,checkPopup){if(ajaxRequestInProgress){return false;
}else{ajaxRequestInProgress=true;
}clearErrorHighlightFromFormFields();
if(!VerifyFields(frm)){ajaxRequestInProgress=false;
return false;
}if(typeof(hasGiftReturn)==="undefined"&&typeof(isGiftReturn)!=="undefined"&&isGiftReturn===false){disableAmznButton("_myoRO_full_refund_button");
disableAmznButton("_myoRO_partial_refund_button");
disableAmznButton("_myoRO_cancel_refund_button");
document.getElementById("_myoRO_refund_form_submit_loading_image").style.display="";
sendAjaxRequest({action:"check-gift-return",orderID:orderID},function(xml){hasGiftReturn=OnAjaxCheckGiftActionSuccess(xml);
if(typeof(hasGiftReturn)!=="undefined"){SubmitRefundRequest(frm,action);
}return false;
});
return false;
}if(typeof(checkPopup)=="undefined"){checkPopup=true;
}if(checkPopup){var totalRefund=GetOldVal(TOTAL_ID);
var modalSpec=undefined;
if(totalRefund>document.getElementById(BASE_ID).value){modalSpec=hasGiftReturn?accidentalOverRefundModalSpec:overRefundModalSpec;
}else{if(hasGiftReturn){modalSpec=accidentalRefundModalSpec;
}}if(modalSpec){MYO.ModalDiv.RevealModal(function(){SubmitRefundRequest(frm,action,false);
},modalSpec);
ajaxRequestInProgress=false;
return false;
}}disableAmznButton("_myoRO_full_refund_button");
disableAmznButton("_myoRO_partial_refund_button");
disableAmznButton("_myoRO_cancel_refund_button");
var params=getFormValues(frm);
params["action"]=action;
params["orderID"]=orderID;
if(isGiftReturn&&isGiftReturn===true){params["returnRequestId"]=returnRequestId;
params["isGiftReturn"]="true";
}else{if(hasGiftReturn){params["hasGiftReturn"]="true";
}}if(redirectUrlOnSuccess){params["redirectUrlOnSuccess"]=redirectUrlOnSuccess;
}var refundCODCheckBox=document.getElementById("_myoRO_refundCODCheckBox");
if(refundCODCheckBox){params["refundCODChecked"]=refundCODCheckBox.checked;
}document.getElementById("_myoRO_refund_form_submit_loading_image").style.display="";
sendAjaxRequest(params,OnAjaxRefundActionSuccess);
return false;
};
VerifyFields=function(frm){var allowSubmit=true;
var refundType=document.getElementById("refundType").value;
var numItems=0;
if(refundType=="partial"){numItems=document.getElementById("numItems").value;
}if(refundType=="full"){if(document.getElementById("refundReason").value==0){allowSubmit=false;
showErrorForFormField("refundOrderInvalidReasonForFullRefund","refundReason");
}}else{for(var i=1;
i<=numItems;
i++){var selectId="refundReason_"+i;
if(ShowingRefund(i)&&document.getElementById(selectId).value==0){allowSubmit=false;
showErrorForFormField("refundOrderInvalidReason",selectId);
}}}for(var badFieldId in badFields){allowSubmit=false;
showErrorForFormField(badFields[badFieldId],badFieldId);
}if(GetOldVal(TOTAL_ID)==0){if(refundType!="full"||document.getElementById(REST_ID).value==0){allowSubmit=false;
showErrorForFormField("refundOrderNoRefundSelected");
}}if(document.getElementById("refundMessageToBuyer").value.length>BUYERMEMOLIMIT){allowSubmit=false;
showErrorForFormField("refundOrderInvalidMemoTooLong","refundMessageToBuyer");
}return allowSubmit;
};
OnAjaxRefundActionSuccess=function(xml){var data=getXMLContent("data",xml);
var st=getXMLContent("status",xml);
var msg=getXMLContent("message",xml);
if(st=="success"){var redirectURL=getXMLContent("redirect",xml);
window.location=redirectURL;
return;
}else{if(st=="error"){document.getElementById("_myoRO_refund_form_submit_loading_image").style.display="none";
highlightErrorFields(data);
}}var divheight=document.getElementById("_myoRO_refund_form_placeholder").offsetHeight;
document.getElementById("_myoRO_form_container_row_").style.height=divheight;
showPageMessage(msg);
ajaxRequestInProgress=false;
enableAmznButton("_myoRO_full_refund_button");
enableAmznButton("_myoRO_partial_refund_button");
enableAmznButton("_myoRO_cancel_refund_button");
};
OnAjaxCheckGiftActionSuccess=function(xml){var st=getXMLContent("status",xml);
ajaxRequestInProgress=false;
document.getElementById("_myoRO_refund_form_submit_loading_image").style.display="none";
enableAmznButton("_myoRO_full_refund_button");
enableAmznButton("_myoRO_partial_refund_button");
enableAmznButton("_myoRO_cancel_refund_button");
if(st=="success"){var hasGiftReturn=getXMLContent("hasGiftReturn",xml);
if(hasGiftReturn==="1"){return true;
}else{if(hasGiftReturn==="0"){return false;
}}}var msg=getXMLContent("message",xml);
showPageMessage(msg);
return undefined;
};
FullRefundButtonOnClick=function(frm){return SubmitRefundRequest(frm,processFullReversalAction);
};
window.MYO.RO.FullRefundButtonOnClick=FullRefundButtonOnClick;
PartialRefundButtonOnClick=function(frm){return SubmitRefundRequest(frm,processPartialReversalAction);
};
window.MYO.RO.PartialRefundButtonOnClick=PartialRefundButtonOnClick;
OnAjaxLoadFormSuccess=function(xml){var data=getXMLContent("data",xml);
var st=getXMLContent("status",xml);
document.getElementById("_myoRO_form_loading_image_").style.display="none";
if(st=="success"){var formplaceholder=document.getElementById("_myoRO_refund_form_placeholder");
setHtmlContent(formplaceholder,data);
var divheight=document.getElementById("_myoRO_refund_form_placeholder").offsetHeight;
document.getElementById("_myoRO_form_container_row_").style.height=divheight;
document.getElementById("_myoRO_refund_form_placeholder").style.display="";
ValidateMemoToBuyerTextLength(document.getElementById("refundMessageToBuyer"));
var refundRecipientColumn=document.getElementById("refund-recipient-column");
if(refundRecipientColumn&&refundRecipient){refundRecipientColumn.innerHTML=refundRecipient;
}}else{var msg=getXMLContent("message",xml);
showPageMessage(msg);
}ajaxRequestInProgress=false;
};
RefundTypeSelected=function(type){if(ajaxRequestInProgress){return false;
}else{ajaxRequestInProgress=true;
}if(type=="full"){document.getElementById("_myoRO_link_select_partial_").className="titletab-inactive";
document.getElementById("_myoRO_link_select_full_").className="titletab-active";
document.getElementById("_myoRO_FullRefundTitleDesc").style.display="";
document.getElementById("_myoRO_PartialRefundTitleDesc").style.display="none";
}else{if(type=="partial"){document.getElementById("_myoRO_link_select_partial_").className="titletab-active";
document.getElementById("_myoRO_link_select_full_").className="titletab-inactive";
document.getElementById("_myoRO_FullRefundTitleDesc").style.display="none";
document.getElementById("_myoRO_PartialRefundTitleDesc").style.display="";
}}hideMessageBox();
var divheight=document.getElementById("_myoRO_form_container_row_").offsetHeight;
document.getElementById("_myoRO_form_container_row_").style.height=divheight;
document.getElementById("_myoRO_refund_form_placeholder").style.display="none";
document.getElementById("_myoRO_form_loading_image_").style.display="";
var params={"action":"get-refund-table","refundType":type,"orderID":orderID};
if(isGiftReturn&&isGiftReturn===true){params["isGiftReturn"]="true";
}sendAjaxRequest(params,OnAjaxLoadFormSuccess);
ResetRefundTotals();
return false;
};
window.MYO.RO.RefundTypeSelected=RefundTypeSelected;
ValidateMemoToBuyerTextLength=function(textareaobj){var notificationArea=document.getElementById("_myoRO_memoToBuyerTextLengthNotification");
if(textareaobj!=undefined&&notificationArea!=null){MYO.ValidateTextArea(textareaobj,notificationArea,BUYERMEMOLIMIT);
if(textareaobj.value.length>0){notificationArea.style.display="block";
}else{notificationArea.style.display="none";
}}};
window.MYO.RO.ValidateMemoToBuyerTextLength=ValidateMemoToBuyerTextLength;
ToggleRefund=function(idx){var doShow=ShowingRefund(idx);
var refElements=document.getElementById("refundDetails_"+idx);
var subtotalId="refundAmount_subtotal_"+idx;
if(doShow){refElements.style.display="block";
UpdateField(TOTAL_ID,GetOldVal(subtotalId));
}else{refElements.style.display="none";
UpdateField(TOTAL_ID,-GetOldVal(subtotalId));
}};
window.MYO.RO.ToggleRefund=ToggleRefund;
UpdatePointsTotals=function(refundVal,index){var pointsGranted=parseInt($("#pointsGrantedAmount_"+index).val());
var principalValue=parseFloat($("#orderPrincipalAmount_"+index).val());
var refundRatio=refundVal/principalValue;
var newPointsReclaimed=Math.floor(pointsGranted*refundRatio);
var oldPointsReclaimed=parseInt($("#pointsReclaimed_"+index).text());
$("#pointsReclaimed_"+index).text(newPointsReclaimed+" "+POINTS_SYM);
var oldPointsReclaimedTotal=parseInt($("#totalPointsRefund").text());
var newPointsReclaimedTotal=oldPointsReclaimedTotal+(newPointsReclaimed-oldPointsReclaimed);
$("#totalPointsRefund").text(newPointsReclaimedTotal+" "+POINTS_SYM);
};
window.MYO.RO.UpdatePointsTotals=UpdatePointsTotals;
UpdateSubtotal=function(id){var index=id.substring(id.lastIndexOf("_")+1);
var newVal=document.getElementById(id).value;
newVal=CheckFloat(id,newVal);
if(newVal===false){return false;
}var oldVal=GetOldVal(id);
oldVals[id]=newVal;
var subtotalId="refundAmount_subtotal_"+index;
var subtotalChange=UpdateField(subtotalId,newVal-oldVal);
var updatePoints=id.indexOf("refundAmount_Principal");
if(updatePoints>=0){UpdatePointsTotals(newVal,index);
}if(ShowingRefund(index)){UpdateField(TOTAL_ID,subtotalChange);
}return true;
};
window.MYO.RO.UpdateSubtotal=UpdateSubtotal;
UpdateFullTotal=function(id){var newVal=document.getElementById(id).value;
newVal=CheckFloat(id,newVal);
if(newVal===false){return;
}var oldVal=GetOldVal(id);
oldVals[id]=newVal;
var baseTotal=$.trim(document.getElementById(REST_ID).value);
baseTotal=parseFloat(baseTotal);
UpdateField(TOTAL_ID,newVal-oldVal,baseTotal);
};
window.MYO.RO.UpdateFullTotal=UpdateFullTotal;
RefreshRefundButtonStatusForCOD=function(){if(!isCODOrder){return;
}if(!document.getElementById("_myoRO_refundCODCheckBox").checked){disableAmznButton("_myoRO_full_refund_button");
disableAmznButton("_myoRO_partial_refund_button");
return;
}enableAmznButton("_myoRO_full_refund_button");
enableAmznButton("_myoRO_partial_refund_button");
};
window.MYO.RO.RefreshRefundButtonStatusForCOD=RefreshRefundButtonStatusForCOD;
CheckFloat=function(fieldId,val){val=VerifyFloat(val);
if(val!==false){val=parseFloat(val);
if(val>document.getElementById(fieldId+"_max").value){badFields[fieldId]="refundOrderInvalidCurrencyMaxAmount";
}else{if(badFields[fieldId]){delete badFields[fieldId];
}}}else{val=false;
badFields[fieldId]="refundOrderInvalidCurrencyFormat";
}return val;
};
UpdateField=function(id,change,defaultValue){if(!defaultValue){defaultValue=0;
}var oldVal=GetOldVal(id,defaultValue);
var newVal=oldVal+change;
oldVals[id]=newVal;
$("#"+id).text(FormatCurrency(newVal));
return newVal-oldVal;
};
ShowingRefund=function(idx){var obj=document.getElementById(REFUND_TOGGLE_PREFIX+idx);
if(obj.type==="checkbox"){return obj.checked;
}else{return obj.value==="on";
}};
GetOldVal=function(id,defaultValue){if(!defaultValue){defaultValue=0;
}var old=oldVals[id];
if(old==undefined){return defaultValue;
}else{return old;
}};
ResetRefundTotals=function(){oldVals={};
badFields={};
};
VerifyFloat=function(text){var state="b";
var result="";
var deccount=CURR_DEC;
for(var i=0;
i<text.length;
i++){var ch=text.charAt(i);
if(state=="b"){if($.trim(ch)==""){state="b";
}else{if(ch>="0"&&ch<="9"){state=">";
}else{if(ch==CURR_SEP){if(CURR_DEC>0){state="/";
}else{return false;
}}else{return false;
}}}}else{if(state==">"){if(ch==CURR_SEP){if(CURR_DEC>0){state=".";
}else{return false;
}}else{if($.trim(ch)==""){state="e";
}else{if(!(ch>="0"&&ch<="9")){return false;
}}}}else{if(state=="."){if(ch>="0"&&ch<="9"){state="<";
}else{if($.trim(ch)==""){state="e";
}else{return false;
}}}else{if(state=="/"){if(ch>="0"&&ch<="9"){state="<";
}else{return false;
}}else{if(state=="<"){if($.trim(ch)==""){state="e";
}else{if(!(ch>="0"&&ch<="9")){return false;
}}}else{if(state=="e"){if($.trim(ch)!==""){return false;
}}}}}}}if(state==">"||state=="<"){result+=ch;
}if(state=="<"){if(deccount==0){return false;
}else{deccount-=1;
}}if(state=="."||state=="/"){result+=".";
}}if(state=="/"){return false;
}if(state=="b"){return"0";
}return result;
};
FormatCurrency=function(val){var result=val.toFixed(CURR_DEC);
var point=result.indexOf(".");
if(point!=-1){result=result.substr(0,point)+CURR_SEP+result.substr(point+1);
}if(CURR_BEFORE){return CURR_SYM+result;
}else{return result+CURR_SYM;
}};
$(document).ready(function(){ValidateMemoToBuyerTextLength(document.getElementById("refundMessageToBuyer"));
$("#_myoRO_link_select_full_").click(function(){return MYO.RO.RefundTypeSelected("full");
});
$("#_myoRO_link_select_partial_").click(function(){return MYO.RO.RefundTypeSelected("partial");
});
});
};
module.OD=function(spec){var enableGiftReturnPopup,modalHeader,modalText,modalRefundText,modalAccept,modalClickHere,modalGoToMyr,modalMyrUrl;
var ShowGiftReturnPopup,OnAjaxCheckGiftReturnSuccess;
modalHeader=spec.modalHeader;
modalText=spec.modalText;
modalAccept=spec.modalAccept;
modalReject=spec.modalReject;
modalAcceptUrl=spec.modalAcceptUrl;
modalClickHere=spec.modalClickHere;
modalGoToMyr=spec.modalGoToMyr;
modalMyrUrl=spec.modalMyrUrl;
enableGiftReturnPopup=spec.enableGiftReturnPopup;
window.MYO.ModalDiv({modalHeader:modalHeader,modalHTML:"<p>"+modalText+"</p><p><a href='"+modalMyrUrl+"'>"+modalClickHere+"</a>"+modalGoToMyr+"</p>",modalAccept:modalAccept,modalReject:modalReject});
ShowGiftReturnPopup=function(orderId){var params={"action":"check-gift-return","orderID":orderId};
sendAjaxRequest(params,OnAjaxCheckGiftReturnSuccess);
};
OnAjaxCheckGiftReturnSuccess=function(xml){var hasGiftReturn=getXMLContent("hasGiftReturn",xml);
var orderId=getXMLContent("orderId",xml);
if(hasGiftReturn==="1"){MYO.ModalDiv.RevealModal(function(){window.location.href=modalAcceptUrl+"?orderID="+orderId+"&custType=giftBuyer";
});
}else{window.location.href=modalAcceptUrl+"?orderID="+orderId+"&custType=buyer";
}};
$(document).ready(function(){var orderID=$("#_myo_contact_buyer_link").attr("orderID");
if(enableGiftReturnPopup==="1"){$("#_myo_contact_buyer_link a").click(function(event){ShowGiftReturnPopup(orderID);
if(event.preventDefault){event.preventDefault();
}else{event.returnValue=false;
}});
}});
};
module.SO=function(spec){var maxLengths,marketplaces,OnChangeSearchKeywordOrType,SearchButtonOnClick,allStatuses;
maxLengths=spec.maxLengths;
marketplaces=spec.marketplaces;
allStatuses=spec.allStatuses;
OnChangeSearchKeywordOrType=function(){var keyword,type,elems;
keyword=$("#_myoSO_searchKeyword").val();
type=$("#_myoSO_searchTypeSelect").val();
if(keyword!==""&&type==="OrderID"){$("#_myoSO_AdvancedSearchForm").find(":input").each(function(){var elid=this.id;
if(elid!=="_myoSO_searchTypeSelect"&&elid!=="_myoSO_searchKeyword"&&elid!=="_myoSO_ShowPendingCheckBox"&&this.type!=="hidden"&&this.type!=="button"){this.disabled=true;
}});
}else{$("#_myoSO_AdvancedSearchForm").find(":input").each(function(){this.disabled=false;
});
}var divToShowBySearchType={"PaymentMethod":"_myoSO_paymentMethodDiv","ShipmentStatus":"_myoSO_shipmentStatusDiv","ShippingService":"_myoSO_shippingServiceDiv","Default":"_myoSO_searchKeyword"};
if(divToShowBySearchType[type]){divToShow=divToShowBySearchType[type];
}else{divToShow=divToShowBySearchType["Default"];
}$("#"+divToShow).css("display","");
for(var searchType in divToShowBySearchType){if(divToShowBySearchType[searchType]!==divToShow){$("#"+divToShowBySearchType[searchType]).css("display","none");
}}$("#_myoSO_searchKeyword").attr("maxlength",maxLengths[type]);
};
OnChangeDateType=function(){var byDate=$('input[name="byDate"]:checked').val();
if(!byDate||byDate==="orderDate"){$("#_myoSO_DateOptionDiv_orderDate").show();
$("#_myoSO_DateOptionDiv_shipDate").hide();
MYO.LimitOrExpandStatuses("#_myoSO","show",allStatuses);
}else{$("#_myoSO_DateOptionDiv_orderDate").hide();
$("#_myoSO_DateOptionDiv_shipDate").show();
MYO.LimitOrExpandStatuses("#_myoSO","hide",allStatuses);
}};
SearchButtonOnClick=function(){var keyword,type;
keyword=$("#_myoSO_searchKeyword").val();
type=$("#_myoSO_searchTypeSelect").val();
if(keyword!==""||type==="PaymentMethod"||type==="ShipmentStatus"||type==="ShippingService"){$("#_myoSO_ignoreSearchType").val(0);
}$("#_myoSO_AdvancedSearchForm").submit();
return false;
};
$(document).ready(function(){$("#_myoSO_searchTypeSelect").change(OnChangeSearchKeywordOrType);
$("#_myoSO_searchKeyword").click(OnChangeSearchKeywordOrType);
$("#_myoSO_searchKeyword").keyup(OnChangeSearchKeywordOrType);
$("#_myoSO_SearchButton").click(SearchButtonOnClick);
$('input[name="byDate"]').change(OnChangeDateType);
MYO.InitializeCheckboxes("#marketplace_",marketplaces);
MYO.InitializeCheckboxes("#type_",["pre","back","llt","std"]);
createDatePickers();
OnChangeSearchKeywordOrType();
OnChangeDateType();
});
};
return module;
})(jQuery);
amznJQ.declareAvailable("rainier-myo");
