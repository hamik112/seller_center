(function(l){var k=window.AmazonUIPageJS||window.P,r=k._namespace||k.attributeErrors,e=r?r("TaktAsset"):k;e.guardFatal?e.guardFatal(l)(e,window):e.execute(function(){l(e,window)})})(function(l,k,r){(function(){var e=function(d,b){return function(){return d.apply(b,arguments)}};l.register("takt",function(){var d;d={selectorDepth:4,sessionLength:6,pushInterval:15E3,hoverDuration:2E3,clickRegex:/a|button|select|input|textarea|span|li/i,hoverRegex:/html|body/i,hover:{lastTarget:void 0,lastTimestamp:void 0,
logged:!1},event_filters:{click:function(b){return d.clickRegex.test(b.target.tagName)},mousemove:function(b){b=b.target;if(d.hoverRegex.test(b.tagName))return!1;if(d.hover.lastTarget===b){if(!d.hover.logged&&((new Date).getTime(),b=(new Date).getTime()-d.hover.lastTimestamp,b>=d.hoverDuration))return d.hover.logged=!0}else d.hover.logged=!1,d.hover.lastTarget=b,d.hover.lastTimestamp=(new Date).getTime();return!1}}};d.util=function(){function b(){}b.addEventListener=function(b,a,d){return null!=b.addEventListener?
b.addEventListener(a,d,!0):b.attachEvent("on"+a,d)};b.uuid=function(){return Math.random().toString(16).slice(2)};b.debounce=function(b,a){return function(){var d;d=arguments;if(null==b.debounceTimeoutId)return b.debounceTimeoutId=setTimeout(function(){delete b.debounceTimeoutId;return b.apply(null,d)},a)}};b.post=function(b,a,d,q){var e;e=new XMLHttpRequest;e.open("POST",b,!q);e.setRequestHeader("Content-Type","application/json");e.onload=function(){return d(e.status)};e.onerror=d;return e.send(JSON.stringify(a))};
b.getEventMetadata=function(b){var a,h,e;a={};"error"===b.type?(a.message=(null!=(h=b.error)?h.message:void 0)||b.message,a.stack=(null!=(e=b.error)?e.stack:void 0)||b.stack):a=d.util.getElementInfo(b.target);return a};b.getElementInfo=function(b){var a,h,e;a=b.innerText;h=b.title;a&&20<a.length&&(a="");null!=a&&""!==a||null==b.parentNode||(a=(null!=(e=b.parentNode.innerText)?e.trim():void 0)||"");return{selector:d.util.getSelector(b),content:h||a||""}};b.getSelector=function(b,a){var h,e,k,m;m=b.nodeName;
k=b.id;e=b.dataset;h=b.className;(e=null!=e?e["takt-id"]:void 0)&&(m+="@"+e);k&&(m+="#"+k.replace(/\./g,"\\\\."));h&&(m+="."+h.split(/\s+/g).join("."));e||k||null==b.parentNode||(a=null==a?d.selectorDepth:a,h=d.util.getSelector(b.parentNode,a-1),m=0>a?h:h+" "+m);return m};return b}();d.analytics=function(){function b(a){this.log=function(){};this.log("Initializing for app "+a.app_id);this.event_cache={};this.app_id=a.app_id;this.forester=a.forester;this.forester_endpoint="https://"+this.forester.endpoint+
"/1/"+this.forester.channelId+"/1/OE";this.identify(a.user_id,a.user_metadata);this.debouncedLogEvents=d.util.debounce(e(function(){return this.logEvents()},this),d.pushInterval)}var f;f=["load","click","submit","change","error"];b.prototype.log=function(){var a,b;a=arguments[0];"string"===typeof a&&(arguments[0]="[takt:analytics] "+a);return"undefined"!=typeof console&&null!==console?null!=(b=console.log)?b.apply(console,arguments):void 0:void 0};b.prototype.persist=function(a,b,e){return d.util.post(this.forester_endpoint,
a,function(a,d){return 204===d?b(!0):b(Error("Invalid status code "+d+" returned"))},e)};b.prototype.userId=function(a){this.new_user=!1;null==a?null!=("undefined"!=typeof localStorage&&null!==localStorage?localStorage.takt_user_id:void 0)?a=localStorage.takt_user_id:(a=d.util.uuid(),this.new_user=!0):("undefined"!=typeof localStorage&&null!==localStorage?localStorage.takt_user_id:void 0)!==a&&(this.new_user=!0);"undefined"!=typeof localStorage&&null!==localStorage&&(localStorage.takt_user_id=a);
return this.user_id=a};b.prototype.sessionId=function(){var a,b,e;this.new_session=!0;e=(new Date).getTime()+"_"+d.util.uuid();a="undefined"!=typeof localStorage&&null!==localStorage?localStorage.takt_session_timestamp:void 0;null!=a&&(b=new Date(a),b.setHours(b.getHours()+d.sessionLength),a=new Date,a<b&&!this.new_user&&(this.new_session=!1,e="undefined"!=typeof localStorage&&null!==localStorage?localStorage.takt_session_id:void 0));"undefined"!=typeof localStorage&&null!==localStorage&&(localStorage.takt_session_id=
e);"undefined"!=typeof localStorage&&null!==localStorage&&(localStorage.takt_session_timestamp=new Date);return this.session_id=e};b.prototype.createEventLogger=function(a){var b;this.log("Instrumenting event-type "+a);b=d.event_filters[a];return e(function(d){var e;this.log("Logging event-type "+a);if(!1===("function"==typeof b?b(d):void 0))return!0;d.timestamp=(new Date).getTime();(e=this.event_cache)[a]||(e[a]=[]);this.event_cache[a].push(d);this.debouncedLogEvents();return!0},this)};b.prototype.logVisit=
function(){var a,b,f;b=d.util.uuid();a=(new Date).getTime();this.visit_id=a+"_"+b;this.visit_url=location.href;this.visit_time=a;this.visit_page_title=(null!=(f=document.getElementsByTagName("title")[0])?f.innerText:void 0)||"";this.persist({type:"visit",app_id:this.app_id,user_id:this.user_id,visit_id:this.visit_id,session_id:this.session_id,visit_url:this.visit_url,visit_page_title:this.visit_page_title,visit_time:this.visit_time},e(function(){return this.log("Visit logged for "+this.visit_id)},
this));return!0};b.prototype.logEvents=function(a){var b,f,k,m,l,g,c,n,p;if(!(this.loggingEvents||0>=Object.keys(this.event_cache).length)){this.log("Trying to log events in cache",Object.keys(this.event_cache));this.loggingEvents=!0;l={type:"event",visit_id:this.visit_id,events:{}};p=this.event_cache;for(f in p){m=p[f];this.log("Logging "+m.length+" events for "+f);g=0;for(c=m.length;g<c;g++)k=m[g],this.log("["+k.timestamp+"] "+f+" Event on "+k.selector);k=[];c=0;for(n=m.length;c<n;c++)b=m[c],g=
b.timestamp,b=d.util.getEventMetadata(b),k.push({timestamp:g,metadata:b});l.events[f]=k}return this.persist(l,e(function(a,b){this.log("Logged events");this.loggingEvents=!1;return this.event_cache={}},this),a)}};b.prototype.identify=function(a,b){var d;this.userId(a);this.sessionId();this.user_metadata=b||{};d={type:"session",app_id:this.app_id,user_id:this.user_id,session_id:this.session_id,metadata:b};if(this.new_user||this.new_session)return this.persist(d,e(function(){return this.log("User identity logged for "+
a)},this))};b.prototype.start=function(){var a,b,l;this.logVisit();b=0;for(l=f.length;b<l;b++)a=f[b],d.util.addEventListener(k,a,this.createEventLogger(a));d.util.addEventListener(k,"hashchange",e(function(){this.logEvents();return this.logVisit()},this));return d.util.addEventListener(k,"beforeunload",e(function(){return this.logEvents(!0)},this))};return b}();return d})}).call(this)});