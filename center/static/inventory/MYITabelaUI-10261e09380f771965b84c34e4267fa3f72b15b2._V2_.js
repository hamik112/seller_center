/*
 Copyright 2013, Amazon.com, Inc. or its affiliates
 Copyright 2013, Amazon.com, Inc. or its affiliates
*/
(function(m){var n=window.AmazonUIPageJS||window.P,l=n._namespace||n.attributeErrors,b=l?l("SellerCentralJsonJavascript"):n;b.guardFatal?b.guardFatal(m)(b,window):b.execute(function(){m(b,window)})})(function(m,n,l){m.register("JSON",function(){function b(a){return 10>a?"0"+a:a}function h(e){a.lastIndex=0;return a.test(e)?'"'+e.replace(a,function(a){var e=g[a];return"string"===typeof e?e:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function d(a,c){var b,g,C,l,m=e,n,u=c[a];
u&&"object"===typeof u&&"function"===typeof u.toJSON&&(u=u.toJSON(a));"function"===typeof k&&(u=k.call(c,a,u));switch(typeof u){case "string":return h(u);case "number":return isFinite(u)?String(u):"null";case "boolean":case "null":return String(u);case "object":if(!u)return"null";e+=f;n=[];if("[object Array]"===Object.prototype.toString.apply(u)){l=u.length;for(b=0;b<l;b+=1)n[b]=d(b,u)||"null";C=0===n.length?"[]":e?"[\n"+e+n.join(",\n"+e)+"\n"+m+"]":"["+n.join(",")+"]";e=m;return C}if(k&&"object"===
typeof k)for(l=k.length,b=0;b<l;b+=1)"string"===typeof k[b]&&(g=k[b],(C=d(g,u))&&n.push(h(g)+(e?": ":":")+C));else for(g in u)Object.prototype.hasOwnProperty.call(u,g)&&(C=d(g,u))&&n.push(h(g)+(e?": ":":")+C);C=0===n.length?"{}":e?"{\n"+e+n.join(",\n"+e)+"\n"+m+"}":"{"+n.join(",")+"}";e=m;return C}}"object"!==typeof JSON&&(JSON={});"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+b(this.getUTCMonth()+
1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var c=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,f,g={"\b":"\\b","\t":"\\t","\n":"\\n",
"\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},k;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,c,b){var g;f=e="";if("number"===typeof b)for(g=0;g<b;g+=1)f+=" ";else"string"===typeof b&&(f=b);if((k=c)&&"function"!==typeof c&&("object"!==typeof c||"number"!==typeof c.length))throw Error("JSON.stringify");return d("",{"":a})});"function"!==typeof JSON.parse&&(JSON.parse=function(a,e){function b(a,c){var f,g,d=a[c];if(d&&"object"===typeof d)for(f in d)Object.prototype.hasOwnProperty.call(d,
f)&&(g=b(d,f),g!==l?d[f]=g:delete d[f]);return e.call(a,c,d)}var f;a=String(a);c.lastIndex=0;c.test(a)&&(a=a.replace(c,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return f=eval("("+a+")"),"function"===typeof e?b({"":f},""):f;throw new SyntaxError("JSON.parse");});return JSON})});
(function(m){var n=window.AmazonUIPageJS||window.P,l=n._namespace||n.attributeErrors,b=l?l("SellerCentralClassJavascript"):n;b.guardFatal?b.guardFatal(m)(b,window):b.execute(function(){m(b,window)})})(function(m,n,l){m.register("Class",function(){var b=!1,h=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(d){function c(){!b&&this.init&&this.init.apply(this,arguments)}var a=this.prototype;b=!0;var e=new this;b=!1;for(var f in d)e[f]="function"===typeof d[f]&&
"function"===typeof a[f]&&h.test(d[f])?function(e,c){return function(){var b=this._super;this._super=a[e];var f=c.apply(this,arguments);this._super=b;return f}}(f,d[f]):d[f];c.prototype=e;c.prototype.constructor=c;c.extend=arguments.callee;return c};return Class})});
(function(m){var n=window.AmazonUIPageJS||window.P,l=n._namespace||n.attributeErrors,b=l?l("MYITabelaUI"):n;b.guardFatal?b.guardFatal(m)(b,window):b.execute(function(){m(b,window)})})(function(m,n,l){m.when("A").execute("tabela-remove-touch",function(b){b.$("html").removeClass("a-touch","a-tablet")});m.when("A","Class").register("browser-storage-base",function(b,h){return h.extend({browserStorage:l,init:function(b){this.browserStorage=b},isSupported:function(){return n&&this.browserStorage},setItem:function(b,
c){if(b&&c&&this.isSupported())try{this.browserStorage.setItem(b,c)}catch(a){}},getItem:function(b){if(this.isSupported()&&b)try{return this.browserStorage.getItem(b)}catch(c){}},removeItem:function(b){if(this.isSupported()&&b)try{this.browserStorage.removeItem(b)}catch(c){}}})});m.when("browser-storage-base").register("sessionstorage-util",function(b){return b.extend({init:function(){this._super(n.sessionStorage)}})});m.when("browser-storage-base").register("localstorage-util",function(b){return b.extend({init:function(){this._super(n.localStorage)}})});
m.when("A","Class").register("tabela-base-model",function(b,h){return h.extend({init:function(){}})});m.when("A","tabela-base-model").register("tabela-container-state",function(b,h){var d=b.$;return h.extend({init:function(c){this.myState={action:l,pageNumber:0,recordsPerPage:l,pageToken:l,sortedColumnId:l,sortOrder:l,searchText:l,tableId:c,filters:l,clientState:{}}},getState:function(){return this.myState},get:function(c){return this.myState[c]},set:function(c,a){if(d.isPlainObject(c))for(var e in c)e in
this.myState&&(this.myState[e]=c[e]);else c in this.myState&&(this.myState[c]=a);return this},setClientState:function(c,a){if(d.isPlainObject(c))for(var e in c)this.validateClientState(e,c[e])&&(this.myState.clientState[e]=c[e]);else this.validateClientState(c,a)&&(this.myState.clientState[c]=a)},validateClientState:function(c,a){if("string"===typeof c&&"string"===typeof a)return!0;throw Error("Tabela: attempted to set client state using invalid name or value.");},removeClientState:function(c){if(c in
this.myState.clientState)try{delete this.myState.clientState[c]}catch(a){this.myState.clientState[c]=l}}})});m.when("A","Class").register("tabela-base-view-model",function(b,h){var d=b.$;return h.extend({$element:l,init:function(c){this.validate(c);this.$element=c},validate:function(c){},replaceHtml:function(c){c=d(c);this.validate(c);this.$element.replaceWith(c);this.$element=c},replaceInnerHtml:function(c){c=d(c);this.$element.html(c)},getDomObject:function(){return this.$element.get(0)}})});m.when("A",
"tabela-base-view-model","tabela-field-view-model","tabela-public-row-view-model").register("tabela-row-view-model",function(b,h,d,c){var a=b.$;return h.extend({fields:{},init:function(a){this._super(a);this.parseRowContent()},validate:function(a){if(!a.is("tr"))throw Error("Trying to parse non-tr element into a row.");if(!a.attr("id"))throw Error('Trying to create a row with no attribute "id".');if(!a.hasClass("mt-row"))throw Error('Trying to create a row without the "mt-row" class');},parseRowContent:function(){var e=
this;e.fields={};this.$element.children().each(function(c,b){var k=a(b),k=new d(k);if(k.hasSubFields()){var r=k.getSubFields(),K;for(K in r)r.hasOwnProperty(K)&&(e.fields[K]=r[K])}e.fields[k.getFieldId()]=k})},getRowId:function(){return this.$element.attr("id")},removeSelf:function(){this.$element.detach()},replaceHtml:function(a){this._super(a);this.parseRowContent()},getFieldByColumnId:function(a){return this.fields[a]},getPublicViewModel:function(){return new c(this)}})});m.when("A","Class").register("tabela-public-row-view-model",
function(b,h){var d;return h.extend({init:function(c){d=c},getRowData:function(){return d.$element.data("row-data")},getField:function(c){c=d.getFieldByColumnId(c);if(c!==l)return c.getPublicViewModel()}})});m.when("A","tabela-base-view-model","tabela-row-view-model").register("tabela-table-view-model",function(b,h,d){var c=b.$;return h.extend({rows:[],init:function(a){this._super(c("#"+a).find(".mt-table"));this.parseCurrentTable()},parseCurrentTable:function(){var a=this;a.rows=[];a.$element.find(".mt-row").each(function(e,
b){a.rows.push(new d(c(b)))})},replaceHtml:function(a){""!==b.trim(a)&&this.validate(c(a));this.$element.find(".mt-row").detach();this.$element.find("tbody").append(a);this.parseCurrentTable()},findRowIndexByRowId:function(a){for(var e=0;e<this.rows.length;e++)if(this.rows[e].getRowId()===a)return e;return-1},getRowByIndex:function(a){return 0>a||a>=this.rows.length?l:this.rows[a]},getRowByRowId:function(a){return this.getRowByIndex(this.findRowIndexByRowId(a))},insertRow:function(a,e){if(0>a)return l;
var b=new d(c(e)),g;a<this.rows.length?(g=c(this.rows[a].getDomObject()),c(b.getDomObject()).insertBefore(g)):(g=c(this.rows[this.rows.length-1].getDomObject()),c(b.getDomObject()).insertAfter(g));this.rows.splice(a,0,b);return b},removeRow:function(a){if(0>a||a>=this.rows.length)return!1;this.rows[a].removeSelf();this.rows.splice(a,1);return!0}})});m.when("A","tabela-base-view-model","tabela-public-field-factory").register("tabela-field-view-model",function(b,h,d){var c=b.$,a=h.extend({subFields:{},
isSubField:!1,init:function(a,c){this._super(a);"undefined"!==typeof c&&(this.isSubField=c);this.parseFieldContent()},validate:function(a){if(0<a.parent("tr").length&&!a.is("td"))throw Error("Trying to parse non-<td> element into a field.");if(!a.attr("id"))throw Error('Trying to create a field with no attribute "id".');if(!a.attr("data-row"))throw Error('Trying to create a field with no attribute "data-row".');if(!a.attr("data-column"))throw Error('Trying to create a field with no attribute "data-column".');
},getFieldId:function(){return this.$element.attr("data-column")},getSubFields:function(){return this.subFields},parseFieldContent:function(){var e=this;e.subFields={};0!==this.$element.children(".mt-combination").length&&this.$element.children(".mt-combination").children().each(function(b,g){var d=new a(c(g),!0);e.subFields[d.getFieldId()]=d})},hasSubFields:function(){return!c.isEmptyObject(this.subFields)},replaceHtml:function(a){this.isSubField?this.replaceInnerHtml(c(a).html()):(this._super(a),
this.parseFieldContent())},getPublicViewModel:function(){return(new d).getField(this)}});return a});m.when("A","Class").register("tabela-public-base-field",function(b,h){return h.extend({$element:l,replaceHtml:l,getFieldId:l,hasSubFields:l,init:function(b){this.$element=b.$element;this.replaceHtml=b.replaceHtml;this.getFieldId=b.getFieldId;this.hasSubFields=b.hasSubFields},getFieldType:function(){return"BASE_FIELD"}})});m.when("A","tabela-public-base-field").register("tabela-public-declarative-base-field",
function(b,h){return h.extend({init:function(b){this._super(b);this.$declarative=this.$element.children(".a-declarative")},hasDeclarativeAction:function(){return 0<this.$declarative.length?!0:!1},getDeclarativeActionNames:function(){return this.hasDeclarativeAction()?this.$declarative.attr("data-action").split(" "):""},getDeclarativeActionData:function(b){return this.hasDeclarativeAction()?this.$declarative.data(b):l}})});m.when("A","tabela-public-base-field").register("tabela-public-combination-field",
function(b,h){var d=b.$;return h.extend({subFields:{},init:function(b){var a=this;a._super(b);d.each(b.subFields,function(b,c){a.subFields[b]=c.getPublicViewModel()})},getFieldType:function(){return"COMBO_FIELD"}})});m.when("A","tabela-public-base-field").register("tabela-public-editable-field",function(b,h){return h.extend({getFieldType:function(){return"EDITABLE_FIELD"},setVal:function(b){this.$element.find(".mt-input-text").val(b).trigger("change")}})});m.when("A","tabela-public-base-field").register("tabela-public-text-field",
function(b,h){return h.extend({getFieldType:function(){return"TEXT_FIELD"},replaceText:function(b){this.$element.find(".mt-text-content").text(b)}})});m.when("A","tabela-public-declarative-base-field").register("tabela-public-link-field",function(b,h){return h.extend({getFieldType:function(){return"LINK_FIELD"},replaceText:function(b){this.$element.find(".mt-link-content").text(b)},getText:function(){return this.$element.find(".mt-link-content").text()},replaceUri:function(b){this.$element.find(".mt-link-content").attr("href",
b)},getUri:function(){return this.$element.find(".mt-link-content").attr("href")}})});m.when("A","Class","tabela-public-base-field","tabela-public-combination-field","tabela-public-editable-field","tabela-public-text-field","tabela-public-link-field").register("tabela-public-field-factory",function(b,h,d,c,a,e,f){return h.extend({getField:function(b){return b.hasSubFields()?new c(b):0<b.$element.find(".mt-editable-text").length?new a(b):0<b.$element.children(".mt-text").length?new e(b):0<b.$element.find(".mt-link").length?
new f(b):new d(b)}})});m.when("A","Class","tabela-base-handler").register("tabela-action-link-handler",function(b,h,d){return d.extend({init:function(c,a,e){this._super(c,a,{});this.utils=e;var f=this;b.declarative("action-link","click",function(a){f.handleAction.call(f,a)})},handleAction:function(b){this.utils.actionHelper.doAction(b.data.type,b.data.target,b.data.url,b.data.record,this.container)}})});m.when("A","Class").register("tabela-base-handler",function(b,h){var d=b.$;return h.extend({container:l,
containerState:l,actions:{},enabled:!1,init:function(b,a,e){this.container=b;this.containerState=a;this.$container=d("#"+b);this.actions=e;this.createListener();this.enabled=!0},createListener:function(){var c=this,a;for(a in this.actions)this.actions.hasOwnProperty(a)&&"function"!==typeof this.actions[a]&&b.declarative(this.container+"-"+a,this.actions[a],function(a){return c.baseHandleEvent.call(c,a)})},baseHandleEvent:function(b){this.handleEvent(b);this.shouldTriggerRefresh(b)&&this.doRefresh(b);
return this.postHandleEvent(b)},doRefresh:function(c){var a=this;c={container:a.container,originalEvent:c,changeType:a.getHandlerType(),refreshCallback:function(b){a.serverRefreshCallback.call(a,b)}};b.trigger("tabela:state-change",c);b.trigger("tabela:state-change:"+a.container,c)},handleEvent:function(b){},shouldTriggerRefresh:function(b){return!1},serverRefreshCallback:function(b){},postHandleEvent:function(b){return!1},getHandlerType:function(){return"UNKNOWN_HANDLER"},getState:function(b){return{}},
allowRefresh:function(b){return!0},isEnabled:function(){return this.enabled}})});m.when("A","Class","tabela-base-handler").register("tabela-split-dropdown-handler",function(b,h,d){var c=b.$;return d.extend({init:function(a,e,c){this._super(a,e,{});var g=this;this.utils=c;b.on("a:splitdropdown:select",function(a){g.handleDropdownEvent.call(g,a)})},handleDropdownEvent:function(a){0!==a.$select.parents("#"+this.container).length&&(a=c("option#"+a.value),"SAVE"!==a.attr("data-action-type")&&this.utils.actionHelper.doAction(a.attr("data-action-type"),
a.attr("data-action-target"),a.attr("data-action-string"),a.attr("data-record"),this.container))}})});m.when("A","Class","tabela-base-handler","tabela-split-dropdown-handler").register("tabela-save-dropdown-handler",function(b,h,d,c){var a=b.$;return c.extend({handleDropdownEvent:function(e){var c=a("option#"+e.value);"SAVE"===c.attr("data-action-type")&&(e=a.extend(!0,{},e,{action:"save-dropdown",container:this.container,isSingleRow:!0,saveType:"save-row",$selected:c}),b.trigger("tabela:save-row",
e),b.trigger("tabela:save-row:"+this.container,e))}})});m.when("A","Class","tabela-base-handler","date-util").register("tabela-edit-handler",function(b,h,d,c){function a(a){return a.val()?""===a.val().trim():!0}function e(a){var b=null;if(a=a.closest("span[data-myitable-inline-changed]").attr("data-myitable-inline-changed"))try{b=JSON.parse(a)}catch(e){}return b}function f(a){var e=null;return e=a.hasClass("date-picker")?K.getDateinISOFormat(a,b.state("datePickerConfig").timeZone):a.val()?a.val().trim():
e}function g(b,c){var g={},d=f(b),k;k=c!==l?c:e(b);g.value=d;g.data=k;g.hasChanged=null!==k&&null!==d&&null!==k.original&&k.original!==d;g.isEmpty=a(b);g.$target=b;return g}function k(a){var b=e(a);a=f(a);return null!==b&&null!==a&&null!==b.original&&b.original!==a}var r=b.$,K=new c;return d.extend({pendingChanges:[],watchedActions:{"inline-changed":["keyup","change"]},getDateUtil:function(){return K},setDateUtil:function(a){K=a},init:function(a,e){var c=this;this._super(a,e,this.watchedActions);
this.$container=r("#"+a);b.on("tabela:table-refresh-done:"+c.container,function(a){c.removePendingChanges()})},handleEvent:function(a){var b=g(a.$target,a.data);b.hasChanged?(this.addPendingChange(a.data.row,a.data.col,b.value,a.data.original,a.data.metadata),a.$target.addClass("mt-input-changed")):(this.removePendingChange(a.data.row,a.data.col),a.$target.removeClass("mt-input-changed"));this.hasPendingChanges()?this.triggerCellsEdited():this.triggerEditedCleared();this.handleChangeEvent();this.toggleIndividualSaveButtons(a)},
toggleIndividualSaveButtons:function(b){var e=this;if(b.data&&b.data.col&&b.data.row){var c,f;c=b.$target.closest("#"+b.data.row+' div[data-column="defect-group"]');if(0<c.size()){var d=c.find("select,input");b=c.closest('[data-column="defect-group-combo"]').find('input[data-field-to-save="defect-group"]');d=d.toArray().map(function(a){return g(r(a))});c=d.some(function(a){return a.isEmpty});f=d.some(function(a){return a.hasChanged});d.forEach(function(a){var b=a.data,c=a.value;b&&c&&(f?(e.addPendingChange(b.row,
b.col,c,b.original,b.metadata),a.$target.addClass("mt-input-changed")):(e.removePendingChange(b.row,b.col,c,b.original,b.metadata),a.$target.removeClass("mt-input-changed")))})}else f=k(b.$target),c=a(b.$target),b=r("#"+b.data.row+' [data-field-to-save="'+b.data.col+'"]');b.prop("disabled",c);b=b.closest(".a-button");c||!f?b.addClass("a-button-disabled"):b.removeClass("a-button-disabled")}},handleChangeEvent:function(){r(".mt-row").removeClass("mt-has-change");for(var a=0;a<this.pendingChanges.length;a++){var b=
this.pendingChanges[a],c=b.recordId,e=!0,f=r("#"+c+'.mt-row [data-column="defects"] .a-button:not(.hidden) input[type="submit"]').length;0<f&&(e=b.updatedFields.length===f);e&&r("#"+c+".mt-row").addClass("mt-has-change")}},findPendingChange:function(a,b){for(var c=0;c<this.pendingChanges.length;c++)if(this.pendingChanges[c].recordId===a){for(var e=0;e<this.pendingChanges[c].updatedFields.length;e++)if(this.pendingChanges[c].updatedFields[e].fieldId===b)return{row:c,col:e};return{row:c,col:-1}}return{row:-1,
col:-1}},addPendingChange:function(a,b,c,e,f){var g=this.findPendingChange(a,b);-1!==g.row?-1!==g.col?this.pendingChanges[g.row].updatedFields[g.col].changedValue=c:(a={fieldId:b,changedValue:c,beforeValue:e},null!==f&&(a.metadata=f),this.pendingChanges[g.row].updatedFields.push(a)):(g={recordId:a,updatedFields:[{fieldId:b,changedValue:c,beforeValue:e}]},null!==f&&(g.updatedFields[0].metadata=f),this.pendingChanges.push(g))},removePendingChange:function(a,b){var c=this.findPendingChange(a,b);-1!==
c.row&&(-1!==c.col&&this.pendingChanges[c.row].updatedFields.splice(c.col,1),0===this.pendingChanges[c.row].updatedFields.length&&this.pendingChanges.splice(c.row,1))},removePendingRowChange:function(a){a=this.findPendingChange(a,l);-1!==a.row&&this.pendingChanges.splice(a.row,1)},removePendingChanges:function(a){"undefined"===typeof a?(this.pendingChanges=[],this.triggerEditedCleared(),r(".mt-input-changed").removeClass("mt-input-changed")):(this.removePendingRowChange(a),this.hasPendingChanges()||
this.triggerEditedCleared(),r("#"+a+" .mt-input-changed").removeClass("mt-input-changed"));this.handleChangeEvent()},hasPendingChanges:function(){return 0<this.pendingChanges.length},getHandlerType:function(){return"EDIT_CHANGED"},getState:function(a){if("undefined"===typeof a)return this.pendingChanges;a=this.findPendingChange(a,l);return-1===a.row?[]:[this.pendingChanges[a.row]]},triggerEditedCleared:function(){var a={container:this.container};b.trigger("tabela:edited-cleared",a);b.trigger("tabela:edited-cleared:"+
this.container,a)},triggerCellsEdited:function(){var a={container:this.container};b.trigger("tabela:cells-edited",a);b.trigger("tabela:cells-edited:"+this.container,a)},allowRefresh:function(a){a=this.$container.find(".unsaved-changes-confirm-label").val();if(this.hasPendingChanges()&&!confirm(a))return!1;this.removePendingChanges();return!0}})});m.when("A","Class","tabela-base-handler").register("tabela-expander-handler",function(b,h,d){var c=b.$;return d.extend({dataSelector:"",watchedActions:{"fetch-rows":["click"]},
init:function(a,c){this._super(a,c,this.watchedActions);this.dataSelector=this.container+"-fetch-rows";var f=this;b.on("tabela:fetch-rows-done:"+this.container,function(a){"success"===a.status&&f.modifyIcon(a)})},handleEvent:function(a){var e=a.$currentTarget.data(this.dataSelector);c(".mt-variation-icon","#"+a.data.rowId,"#"+this.container).hasClass("mt-variation-expand")?e.fetchedRowIds?(b.each(e.fetchedRowIds,function(a){c("#"+a).show()}),this.modifyIcon(a)):n.TabelaManager.get(this.container).fetchRows(e.endpoint,
e.rowId,{position:"after"}):e.fetchedRowIds&&(b.each(e.fetchedRowIds,function(a){c("#"+a).hide()}),this.modifyIcon(a))},modifyIcon:function(a){if(a.data.rowId){var b=c(".mt-variation-icon","#"+a.data.rowId,"#"+this.container);b.hasClass("mt-variation-expand")?b.removeClass("mt-variation-expand").addClass("mt-variation-collapse"):b.removeClass("mt-variation-collapse").addClass("mt-variation-expand");if(a.fetchedRowIds){var f=b.parent().data(this.dataSelector);f.fetchedRowIds=a.fetchedRowIds;b.parent().data(this.container+
"-fetch-rows",f)}}},getHandlerType:function(){return"EXPANDER"},shouldTriggerRefresh:function(a){return!1}})});m.when("A","Class","tabela-base-handler","a-popover").register("tabela-filter-handler",function(b,h,d,c){function a(a){return-1!==a.action.indexOf("filter-changed")}function e(a,b){for(var c=0;c<b.length;c++)if(b[c].filterGroupId===a)return c;return-1}function f(a,b,c,f){var g=e(a,f);-1===g?f.push({filterGroupId:a,filterCriteria:[{value:c,filterId:b}]}):f[g].filterCriteria.push({value:c,
filterId:b})}function g(a,b){var c=e(a,b);-1!==c&&b.splice(c,1)}function k(a,b,c){var e;a.find(".a-declarative input").each(function(a,b){"checkbox"===r(b).attr("type")?r(b).removeAttr("checked"):"radio"===r(b).attr("type")&&("true"===r(b).parent().attr("data-is-default")?(r(b).prop("checked",!0),e=r(b).val()):r(b).prop("checked",!1))});g(b,c);e&&f(b,e,"true",c)}var r=b.$;return d.extend({selectedFilters:[],$container:l,watchedActions:{"filter-changed":["change"],"filtergroup-clear-clicked":["click"],
"filter-clear-clicked":["click"]},delay:0,delayEventId:null,init:function(a,e){var f=this;0!==r("#"+a).find(".mt-filter-container").length&&(f._super(a,e,f.watchedActions),f.setupInitialState(),b.on("tabela:table-refresh-done:"+f.container,function(a){r(".mt-filter > .a-declarative").each(function(a,b){var e=c.get(b);"undefined"!==typeof e&&null!==e&&e.isActive()&&e.updatePosition()});r(".myi-filter-clear-all").toggle(!!f.selectedFilters.length)}))},handleEvent:function(b){a(b)&&this.handleFilterClick(b);
-1!==b.action.indexOf("filtergroup-clear-clicked")&&this.handleFilterGroupClearClick(b);-1!==b.action.indexOf("filter-clear-clicked")&&this.handleFilterClearClick(b);"true"===this.$container.find(".mt-enable-floating-bar").val()&&r(".mt-filter > .a-declarative").each(function(a,b){var e=c.get(b);"undefined"!==typeof e&&null!==e&&e.hide()})},handleFilterClick:function(a){if("checkbox"===a.$target.attr("type"))if(a.$target.is(":checked"))f(a.data.filterGroupId,a.data.filterId,"true",this.selectedFilters);
else{var b=a.data.filterId,c=this.selectedFilters;a=e(a.data.filterGroupId,c);if(-1!==a){a:{for(var d=c[a].filterCriteria,k=0;k<d.length;k++)if(d[k].filterId===b){b=k;break a}b=-1}-1!==b&&c[a].filterCriteria.splice(b,1)}0===c[a].filterCriteria.length&&c.splice(a,1)}else"radio"===a.$target.attr("type")?(g(a.data.filterGroupId,this.selectedFilters),f(a.data.filterGroupId,a.$target.val(),"true",this.selectedFilters)):"hidden"===a.$target.attr("type")&&(g(a.data.filterGroupId,this.selectedFilters),f(a.data.filterGroupId,
a.data.filterId,"true",this.selectedFilters))},handleFilterGroupClearClick:function(a){k(a.$target.parents(".mt-filter-popup-container"),a.data.filterGroupId,this.selectedFilters)},handleFilterClearClick:function(a){r(".mt-filter-popup-container .a-declarative input").each(function(a,b){"checkbox"===r(b).attr("type")&&r(b).removeAttr("checked")});this.selectedFilters=[]},setupInitialState:function(){var a=this;this.$container.find('.mt-filter-group [data-action*="filter-changed"]').each(function(b,
c){var e=r(c),g=e.data(a.container+"-filter-changed"),e=e.find("input");("checkbox"===e.attr("type")||"radio"===e.attr("type"))&&e.is(":checked")&&f(g.filterGroupId,g.filterId,"true",a.selectedFilters)})},getState:function(){return this.selectedFilters},getHandlerType:function(){return"FILTER_CHANGED"},shouldTriggerRefresh:function(b){return!a(b)||0===this.delay},postHandleEvent:function(b){if(a(b)&&0<this.delay){var c=this;null!==this.delayEventId&&n.clearTimeout(this.delayEventId);this.delayEventId=
n.setTimeout(function(){c.doRefresh(b)},this.delay)}return!1},setDelay:function(a){this.delay=a}})});m.when("A","Class","tabela-base-handler").register("tabela-filter-button-handler",function(b,h,d){var c=b.$;return d.extend({selectedFilters:[],watchedActions:{"filter-button-clicked":["click"]},init:function(a,e){this._super(a,e,this.watchedActions);b.on("tabela:table-refresh-done:"+this.container,function(a){c(".mt-filter-num-select").text(c("#"+a.container).find(".mt-selected-filter").length)});
c(".mt-filter-num-select").text(c("#"+a).find(".mt-selected-filter").length)},handleEvent:function(a){a=this.$container.find(".mt-header-filter-button-container");var e=c("#mt-floating-bar").find(".mt-header-filter-button-container");a.add(e).toggleClass("expanded");a.hasClass("expanded")?(b.slideDown(this.$container.find(".mt-filter-container"),300),b.slideDown(c("#mt-floating-bar").find(".mt-filter-container"),300)):(b.slideUp(this.$container.find(".mt-filter-container"),300),b.slideUp(c("#mt-floating-bar").find(".mt-filter-container"),
300))},getState:function(){return[]},getHandlerType:function(){return"FILTER_BUTTON_CLICKED"},shouldTriggerRefresh:function(a){return!1},postHandleEvent:function(a){return!1}})});m.when("A","Class","tabela-base-handler").register("tabela-floating-bar-handler",function(b,h,d){var c=b.$;return d.extend({$container:l,createFloatingBar:!1,watchedActions:{},init:function(a,e){var f=this;f.$container=c("#"+a);"true"===f.$container.find(".mt-enable-floating-bar").val()&&(f._super(a,e,f.watchedActions),f.reload(),
b.on("tabela:data-changed",function(a){f.reload()}),b.on("tabela:ajax-request-done",function(a){f.setWidths()}),b.on.load(function(){f.setWidths()}),b.on.resize(function(){f.setWidths()}),c(n).scroll(f.updateTableHeaders))},reload:function(){c("#mt-floating-bar").remove();var a;a=c(".mt-header").clone();a.addClass("floatingHeaderBar");a.find("[id]").each(function(){this.id+="-floating"});a.find(".a-popover-preload").each(function(){this.parentNode.removeChild(this)});a.find(":input").each(function(){this.name+=
"-floating"});c("#a-page").after('<div id="mt-floating-bar" />');c("#mt-floating-bar").append(a);a=c("#head-row").clone();a.attr("id","floatingHeaderColumns");a.addClass("floatingHeaderColumns");a.find("[id]").each(function(){this.id+="-floating"});c("#mt-floating-bar").append('<table class="floatingHeaderTable mt-table a-bordered a-horizontal-stripes" />');c(".floatingHeaderTable").append(a);this.setWidths();b.trigger("floating-bar-reloaded")},setWidths:function(){var a=c("#floatingHeaderColumns");
c(".floatingHeaderBar");var b=c("#mt-floating-bar"),f=c("#head-row"),g=f.offset().left,d=f.outerWidth()+1;b.css({width:d,left:g});a.find("th").each(function(){var a=this.id.split("-")[0];c(this).css("width",c("#"+a).outerWidth())});a.width(f.width());this.updateTableHeaders()},updateTableHeaders:function(){var a=c(".mt-header").offset(),b=c(n).scrollTop(),f=-c(n).scrollLeft(),g=c("#mt-floating-bar"),d=72,r=c("#remote-nav-container");0<r.length&&(d+=r.offset().top+r.height());r=c(".mt-header-filters.leftSideFilters");
r.css("left",-c(n).scrollLeft()+18);b>a.top-18?(g.css({display:"inline",top:"0px",left:f+a.left}),"none"!==c(".mt-filter-button-selected").css("display")&&c(".mt-header-filter-button-container").first().find(".a-button-text").click()):g.css({display:"none"});f=c(".a-section.leftSideFilters .a-alert:visible");f=0<f.height()?f.height()+18:0;b>a.top-18-f?r.css("top",13):(a=c(".a-container.madagascar-navigation"),b=0,0<a.length&&(b=a.outerHeight()+parseInt(a.find(".a-section").css("margin-bottom"),10)),
r.css("top",d+b-c(n).scrollTop()))}})});m.when("A","Class","tabela-base-handler","sessionstorage-util").register("tabela-pagination-handler",function(b,h,d,c){var a=b.$;return d.extend({currentPage:1,pageToken:l,triggerRefresh:!0,sessionStorage:l,watchedActions:{"page-clicked":["click"],"page-changed":["click"]},init:function(a,f){this._super(a,f,this.watchedActions);this.updateCurrentPage();this.triggerRefresh=!0;this.sessionStorage=new c;var g=this;b.on("tabela:table-refresh-done:"+this.container,
function(a){g.updateCurrentPage();g.updateSessionStorage()});b.on.load(function(){g.updateSessionStorage()})},updateSessionStorage:function(b){this.sessionStorage.setItem(this.currentPage+1,a("#pageToken").val())},handleEvent:function(b){b.$event.preventDefault();this.triggerRefresh=!0;var c=a("#"+this.container+"-gotopage");this.getPaginationHandler(b).call(this,c,b)},getPaginationHandler:function(a){return-1!==a.action.indexOf("page-changed")?this.skipToPageHandler:this.pageClickedHandler},skipToPageHandler:function(c){var f=
parseInt(c.val(),10);parseInt(a(".mt-num-page").val(),10)>=f&&0<f?(b.trigger("tabela:skip-to-page:"+this.container,{oldPageNumber:this.currentPage,newPageNumber:f}),this.currentPage=f,c.removeClass("a-form-error")):(c.addClass("a-form-error"),this.triggerRefresh=!1)},pageClickedHandler:function(a,b){if("#next"===b.$target.attr("href"))this.currentPage++;else if("#prev"===b.$target.attr("href"))this.currentPage--;else{var c=b.$target.attr("href");this.currentPage=parseInt(c.substr(1),10)}this.pageToken=
this.sessionStorage.getItem(this.currentPage);1===a.length&&(a.removeClass("a-form-error"),a.val(this.currentPage))},getState:function(){return this.currentPage},getPageToken:function(){return this.pageToken},setState:function(a){this.currentPage=parseInt(a,10)},getHandlerType:function(){return"PAGE_CHANGED"},shouldTriggerRefresh:function(a){return this.triggerRefresh},hasPagination:function(){return 0<a(".mt-pagination","#"+this.container).length},updateCurrentPage:function(){this.hasPagination()?
this.currentPage=parseInt(a(".mt-pagination .mt-current-page","#"+this.container).val(),10):this.currentPage=1}})});m.when("A","Class","tabela-base-handler").register("tabela-records-per-page-handler",function(b,h,d){var c=b.$;return d.extend({recordsPerPage:0,triggerRefresh:!1,watchedActions:{"records-per-page-select-changed":["change"]},init:function(a,b){0<c(".mt-records-per-page","#"+a).length&&(this._super(a,b,this.watchedActions),this.container=a,this.recordsPerPage=parseInt(c(".mt-current-records-per-page",
"#"+this.container).val(),10))},handleEvent:function(a){a=c(a.$target.find("option:selected"));parseInt(a.val(),10)===this.recordsPerPage?this.triggerRefresh=!1:(this.recordsPerPage=parseInt(a.val(),10),this.triggerRefresh=!0)},getState:function(a){return this.enabled?this.recordsPerPage:l},getHandlerType:function(){return"RECORDS_PER_PAGE_CHANGED"},shouldTriggerRefresh:function(a){return this.triggerRefresh},serverRefreshCallback:function(a){this.recordsPerPage=parseInt(c(".mt-current-records-per-page",
"#"+this.container).val(),10)}})});m.when("A","Class","tabela-base-handler").register("tabela-save-all-handler",function(b,h,d){var c=b.$;return d.extend({watchedActions:{"saveall-clicked":["click"]},buttonEnabled:!0,init:function(a,c){this._super(a,c,this.watchedActions);var f=this;b.on("tabela:cells-edited:"+this.container,function(a){return f.enableButton.call(f,a)});b.on("tabela:edited-cleared:"+this.container,function(a){return f.disableButton.call(f,a)});this.disableButton()},handleEvent:function(a){var e=
this.container;this.buttonEnabled&&(a=c.extend(!0,{},a,{container:e,saveType:"save-all"}),b.trigger("tabela:save-all",a),b.trigger("tabela:save-all:"+e,a))},disableButton:function(a){c(".mt-button-saveall").addClass("a-button-disabled");this.buttonEnabled=!1},enableButton:function(a){c(".mt-button-saveall").removeClass("a-button-disabled");this.buttonEnabled=!0}})});m.when("A","Class","tabela-base-handler").register("tabela-savebutton-handler",function(b,h,d){var c=b.$;return d.extend({watchedActions:{"save-button":["click"]},
init:function(a,b){this._super(a,b,this.watchedActions)},handleEvent:function(a){if(a.$currentTarget.find("input").prop("disabled"))return a.stopPropagation&&a.stopPropagation(),n.event&&(n.event.cancelBubble=!0),!1;a=c.extend(!0,{},a,{action:"save-button",container:this.container,isSingleRow:!0,saveType:"save-row",$selected:a.$target});b.trigger("tabela:save-row",a);b.trigger("tabela:save-row:"+this.container,a)}})});m.when("A","Class","tabela-base-handler").register("tabela-search-handler",function(b,
h,d){var c=b.$;return d.extend({watchedActions:{"search-submit":["submit"],"search-text-changed":["keyup","change"],"search-cleared":["click"]},init:function(a,e){var f=this;0<c(".mt-search","#"+a).length&&this._super(a,e,this.watchedActions);b.on("tabela:table-refresh-done:"+a,function(){f.getState()||c(".mt-clear-search").hide()})},handleEvent:function(a){a.$event.preventDefault();-1!==a.action.indexOf("search-text-change")&&this.handleTextChangeEvent(a);-1!==a.action.indexOf("search-cleared")&&
this.handleTextClearedEvent(a);-1!==a.action.indexOf("search-submit")&&this.handleSubmitEvent()},handleTextChangeEvent:function(a){var b=a.$target.attr("id");-1!==b.indexOf("floating")?c("#"+b.substring(0,b.indexOf("-floating"))).val(a.$target.val()):c("#"+b+"-floating").val(a.$target.val())},handleTextClearedEvent:function(a){this.getState()&&(this.setState(""),a=c.Event("submit"),a.action="search-submit",c("#"+this.container+"-search-button").trigger(a),this.clearQueryParamsFromURL())},handleSubmitEvent:function(){c(".mt-clear-search").is(":hidden")&&
""!==this.getState()&&c(".mt-clear-search").show()},getState:function(){return this.enabled?c("#"+this.container+"-search").val():l},setState:function(a){c("#"+this.container+"-search").val(a)},getHandlerType:function(){return"SEARCH_CHANGED"},shouldTriggerRefresh:function(a){return-1!==a.action.indexOf("search-text-change")||-1!==a.action.indexOf("search-cleared")?!1:!0},clearQueryParamsFromURL:function(){if(this.containerState&&this.containerState.myState&&this.containerState.myState.clientState){var a=
this.containerState.myState.clientState.viewId;if("DRAFT"===a){var b=n.location.href.indexOf(n.location.pathname),a=n.location.href.lastIndexOf(a)+a.length,b=n.location.href.substring(b,a);n.history.pushState("","",b)}}}})});m.when("A","Class","tabela-base-handler").register("tabela-sort-handler",function(b,h,d){var c=b.$;return d.extend({currentColumn:l,sortingOrder:0,watchedActions:{"sort-clicked":["click"]},sortOrders:["DESCENDING","ASCENDING"],init:function(a,b){this._super(a,b,this.watchedActions);
var f=c('.mt-header-sort-icon[data-sorted="true"]');0<f.length&&(this.currentColumn=f.attr("data-column"),this.sortingOrder=c.inArray(f.attr("data-direction"),this.sortOrders))},handleEvent:function(a){a.data.heading===this.currentColumn?this.sortingOrder=(this.sortingOrder+1)%this.sortOrders.length:(this.currentColumn=a.data.heading,this.sortingOrder=0);this.modifySortIcon(a)},modifySortIcon:function(a){c(".mt-header-sort-icon, .mt-header-sort","#"+this.container).removeClass("mt-sort-up mt-sort-down");
c(".mt-header-sort-icon, .mt-header-sort","#mt-floating-bar").removeClass("mt-sort-up mt-sort-down");a="mt-sort-up";"DESCENDING"===this.sortOrders[this.sortingOrder]&&(a="mt-sort-down");var b=c("[data-column = "+this.currentColumn+"]");b.addClass(a);b.parents(".mt-header-sort").addClass(a)},getState:function(){return{column:this.currentColumn,order:this.sortOrders[this.sortingOrder]}},setState:function(a){this.currentColumn=a.sortedColumnId;this.sortingOrder="DESCENDING"===a.sortOrder?0:1;this.modifySortIcon(c("#"+
this.currentColumn).find("span.a-declarative"))},getHandlerType:function(){return"SORT_CHANGED"},shouldTriggerRefresh:function(a){return!0}})});m.when("A","Class","tabela-base-handler").register("tabela-bulk-action-handler",function(b,h,d){var c=b.$;return d.extend({$container:l,watchedActions:{"row-select-changed":["change"],"row-select-all-changed":["change"],"bulk-action-select-changed":["change"]},allowMultiPage:!1,selectedRows:{},init:function(a,e){var f=this;f.$container=c("#"+a);if(0<f.$container.find(".mt-header-bulk-action .a-button-dropdown").length){"true"===
f.$container.find(".mt-allow-multi-page-select").val()&&(f.allowMultiPage=!0);f._super(a,e,f.watchedActions);f.setDropdownString();f.setDropdownStatus();b.on("tabela:table-refresh-done:"+f.container,function(a){g()});b.on("tabela:fetch-rows-done:"+f.container,function(a){g()});var g=function(){f.clearSelectAllCheckbox();f.reselectCheckboxes();f.setDropdownString();f.setDropdownStatus()}}},handleEvent:function(a){-1!==a.action.indexOf("row-select-all-changed")&&(a.$target.is(":checked")?this.$container.find('.mt-row-select input[type="checkbox"]').attr("checked",
"checked"):this.$container.find('.mt-row-select input[type="checkbox"]').removeAttr("checked"),this.setFloatingBarSelection());-1!==a.action.indexOf("row-select-changed")&&(a.$target.is(":checked")||this.clearSelectAllCheckbox(),0===this.$container.find(".mt-row-select input:checkbox:not(:checked)").length&&this.checkSelectAllCheckbox());-1!==a.action.indexOf("bulk-action-select-changed")&&this.handleBulkActionChanged(a);this.setDropdownString();this.setDropdownStatus()},handleBulkActionChanged:function(a){var e=
a.$target,f=c(e.find("option:selected"));c(a.$currentTarget.find(".a-dropdown-prompt"));var g=this;e.val(0);setTimeout(function(){var a=f.attr("data-action-string");b.trigger(a,g.getSelectedRows())},0)},clearSelection:function(){this.selectedRows={};this.reselectCheckboxes();this.$container.find('.mt-row-select input[type="checkbox"]').removeAttr("checked")},clearSelectAllCheckbox:function(){this.$container.find("#mt-select-all").removeAttr("checked");c("#mt-floating-bar").find("#mt-select-all-floating").removeAttr("checked")},
checkSelectAllCheckbox:function(){this.$container.find("#mt-select-all").attr("checked","checked");c("#mt-floating-bar").find("#mt-select-all-floating").attr("checked","checked")},setFloatingBarSelection:function(){var a=c("#mt-select-all-floating");this.$container.find("#mt-select-all").attr("checked")?a.attr("checked","checked"):a.removeAttr("checked")},setDropdownString:function(){var a=this.$container.find(".mt-header-bulk-action .a-button-dropdown"),b=a.data("text"),a=a.data("replace"),f=this.$container.find(".mt-header-bulk-action .a-dropdown-prompt"),
g=c("#mt-floating-bar").find(".mt-header-bulk-action .a-button-dropdown");g.data("text");var g=g.data("replace"),d=c("#mt-floating-bar").find(".mt-header-bulk-action .a-dropdown-prompt");f.text(b.replace(a,this.getNumSelectedRows()));d.text(b.replace(g,this.getNumSelectedRows()))},setDropdownStatus:function(){var a=this.$container.find(".mt-header-bulk-action .a-button-dropdown"),b=this.$container.find(".mt-header-bulk-action .a-native-dropdown"),f=c("#mt-floating-bar").find(".mt-header-bulk-action .a-button-dropdown"),
g=c("#mt-floating-bar").find(".mt-header-bulk-action .a-native-dropdown");this.hasSelectedRows()?(a.add(f).removeClass("a-button-disabled"),b.add(g).removeAttr("disabled")):(a.add(f).addClass("a-button-disabled"),b.add(g).attr("disabled","disabled"))},getSelectedRows:function(){if(this.allowMultiPage){var a=[];this.syncSelectedRows();for(var b in this.selectedRows)this.selectedRows[b]!==l&&this.selectedRows.hasOwnProperty(b)&&a.push({recordId:b,data:this.selectedRows[b]})}else a=[],this.$container.find('.mt-row-select input[type="checkbox"]:checked').each(function(b,
e){a.push(c(e).val())});return a},hasSelectedRows:function(){return 0<this.getSelectedRows().length},getNumSelectedRows:function(){return this.getSelectedRows().length},getHandlerType:function(){return"ROW_SELECT_CHANGED"},getState:function(a){return"undefined"===typeof a?this.enabled?this.getSelectedRows():[]:this.enabled?this.$container.find('.mt-row-select input[value="'+a+'"]').is(":checked"):!1},syncSelectedRows:function(){var a=this;a.$container.find('.mt-row-select input[type="checkbox"]').each(function(b,
f){var g=c(f);if(g.is(":checked")){var d=c(g.parents(".a-declarative")).data(a.container+"-row-select-changed").data;a.selectedRows[g.val()]=d}else a.selectedRows[g.val()]!==l&&(a.selectedRows[g.val()]=l,delete a.selectedRows[g.val()])})},reselectCheckboxes:function(){var a=this;a.allowMultiPage&&(a.$container.find('.mt-row-select input[type="checkbox"]').each(function(b,f){var g=c(f);a.selectedRows[g.val()]!==l?g.attr("checked","checked"):g.removeAttr("checked")}),0===a.$container.find(".mt-row-select input:checkbox:not(:checked)").length&&
a.checkSelectAllCheckbox())},allowRefresh:function(a){if(this.allowMultiPage)return this.syncSelectedRows(),!0;a=this.$container.find(".selected-rows-confirm-label").val();return this.hasSelectedRows()&&!confirm(a)?!1:!0}})});m.when("A","Class","tabela-base-handler").register("tabela-delayed-records-handler",function(b,h,d){var c=b.$,a={},e={};return d.extend({delayedRecords:[],delayedS3keys:[],$container:l,init:function(f,g){this._super(f,g,{});this.$container=c("#"+this.container);this.maxRetries=
parseInt(this.$container.data("max-retries"),10)||10;var d=this;b.on.ready(function(){b.delay(function(){d.gatherAndSendDelayedRecords.call(d)},20)});b.on("tabela:data-changed:"+f,function(a){d.gatherAndSendDelayedRecords.call(d)});b.on("tabela:data-inserted:"+f,function(a){d.gatherAndSendDelayedRecords.call(d)});b.on("tabela:table-refresh-begin:"+f,function(b){a={};e={}});b.on("tabela:save-begin:"+f,function(b){a={};e={}})},getState:function(a){return this.delayedRecords},getS3Keys:function(){return this.delayedS3keys},
gatherAndSendDelayedRecords:function(){var f=this,g=0;f.clearDelayedRecords();f.$container.find(".mt-delay-loading").each(function(b,d){var t=c(d),k=t.parents(".mt-cell"),h=t.data("field-data"),k=k.attr("data-row"),t=t.parent().attr("data-column");e[k+":"+t]=1;!a[k+":"+t]||a[k+":"+t]<f.maxRetries?f.addDelayedField(k,t,h):e[k+":"+t]=0;1===e[k+":"+t]&&a[k+":"+t]>g&&(g=a[k+":"+t])});if(f.hasDelayedFields()){b.each(f.delayedRecords,function(a){var b=c.find("tr#"+a.recordId)[0],e=c(b).data("uuid");-1===
f.delayedS3keys.indexOf(e)&&f.delayedS3keys.push(e);if(b=c(b).data("delayed-dependency-data"))a.dependencyData=b});var d={container:f.container,action:"load-delayed",highestAttemptNumber:g};b.trigger("tabela:load-delayed-rows",d);b.trigger("tabela:load-delayed-rows:"+f.container,d)}},clearDelayedRecords:function(){this.delayedRecords=[];this.delayedS3keys=[]},findDelayedField:function(a,b){for(var c=0;c<this.delayedRecords.length;c++)if(this.delayedRecords[c].recordId===a){if(this.delayedRecords[c].delayedFields)for(var e=
0;e<this.delayedRecords[c].delayedFields.length;e++){if(this.delayedRecords[c].delayedFields[e].fieldId===b)return{row:c,col:e}}else for(e=0;e<this.delayedRecords[c].delayedFieldIds.length;e++)if(this.delayedRecords[c].delayedFieldIds[e]===b)return{row:c,col:e};return{row:c,col:-1}}return{row:-1,col:-1}},addDelayedField:function(b,c,e){var d=this.findDelayedField(b,c);"/inventory"===n.location.pathname.substr(0,10)&&"object"!==typeof e&&(e="Exception: the data-field-data attribute of "+b+":"+c+" was malformed and could not be converted into a JSON object");
a[b+":"+c]=++a[b+":"+c]||1;-1!==d.row?-1!==d.col?this.delayedRecords[d.row].delayedFields[d.col].fieldData=e:this.delayedRecords[d.row].delayedFieldIds.push(c):this.delayedRecords.push({recordId:b,delayedFieldIds:[c]})},hasDelayedFields:function(){return 0<this.delayedRecords.length}})});m.when("A","Class","tabela-base-handler","date-util").register("tabela-date-picker-handler",function(b,h,d,c){var a=b.$,e=this;e.dateUtil=new c;return d.extend({init:function(a,c,e){this._super(a,c,{});var d=this;
d.setupDatePickers();b.on("tabela:ajax-request-done",function(a){d.setupDatePickers()});b.on("setup-date-pickers",function(){d.setupDatePickers()})},setupDatePickers:function(){var c=a(".date-picker").toArray(),d=b.state("datePickerConfig");0!==c.length&&e.dateUtil.createDatePicker(c,d)}})});m.when("A","Class","tabela-base-handler").register("tabela-field-help-message-handler",function(b,h,d){var c,a;return d.extend({init:function(b,f,d,k){this._super(b,f,{});c=k.$;a=this;k.on("tabela:table-refresh-done:"+
a.container,function(b){a.repositionHelpLinksWithTimeout()});k.on("tabela:fetch-rows-done:"+a.container,function(b){"success"===b.status&&a.repositionHelpLinksWithTimeout()});c(n).resize(k.debounce(a.repositionHelpLinks,50));a.repositionHelpLinksWithTimeout()},repositionHelpLinksWithTimeout:function(b){a.repositionHelpLinks();setTimeout(function(){a.repositionHelpLinks()},300)},repositionHelpLinks:function(e){c(".a-expander-inline-container").each(function(e,d){if(c(d).attr("hasListener"))return!0;
b.on("a:expander:"+c(d).attr("data-a-expander-name")+":toggle",a.repositionHelpLinks);c(d).attr("hasListener",!0)});c(".myi-icon-field.icon.help_outline").each(function(a,b){var e=c(b),d=e.closest('[data-column^="questionmarkdefects"]'),h=d.prev(),t;0<h.has(".mt-box").length?t=h.find(".mt-box"):0<h.has(".mt-outer-textarea").length&&(t=h.find(".mt-outer-textarea"));if(t){var w=t.position().top+11,e=t.position().left+t.width()-e.width()-5;d.css({position:"absolute",left:e+"px",top:w+"px"});0<h.has(".chevron-down").length&&
h.find(".chevron-down").css({right:"30px"});0<h.has('[type="text"]').length&&h.find('[type="text"]').css({paddingRight:"30px"});0<h.has("textarea").length&&h.find("textarea").css({paddingRight:"25px"})}})}})});m.when("Class").register("tabela-base-controller",function(b){return b.extend({init:function(){}})});m.when("A","JSON","tabela-container-state","tabela-base-controller","tabela-pagination-handler","tabela-expander-handler","tabela-records-per-page-handler","tabela-sort-handler","tabela-search-handler",
"tabela-split-dropdown-handler","tabela-save-dropdown-handler","tabela-save-all-handler","tabela-savebutton-handler","tabela-edit-handler","tabela-bulk-action-handler","tabela-delayed-records-handler","tabela-filter-button-handler","tabela-filter-handler","tabela-floating-bar-handler","tabela-action-link-handler","tabela-date-picker-handler","tabela-field-help-message-handler","myi-s3").register("tabela-record-controller",function(b,h,d,c,a,e,f,g,k,r,m,t,w,n,F,G,z,u,H,A,x,E,y){var q=b.$;return c.extend({containerState:l,
refreshEndpoint:"",saveEndpoint:"",delayedEndpoint:"",loadingRequests:0,isSaving:!1,reftagEnabled:!0,ajaxRequestNumber:0,init:function(c,M,R){this.containerState=new d(c);this.container=c;this.$container=q("#"+c);var v=this.containerState;this.handlers={"floating-bar":new H(c),pagination:new a(c,v),"fetch-rows":new e(c,v),"records-per-page":new f(c,v),sort:new g(c,v),search:new k(c,v),"save-dropdown":new m(c,v),"save-button":new w(c,v),"split-dropdown":new r(c,v,M),"action-link":new A(c,v,M),"save-all":new t(c,
v),edit:new n(c,v),"bulk-action":new F(c,v),"delayed-records":new G(c,v),"filter-button":new z(c),filter:new u(c),"date-picker":new x(c),"field-help-message":new E(c,v,M,b)};this.utils=M;this.viewModels=R;this.tableViewModel=this.viewModels.table;this.refreshEndpoint=q(".refresh-endpoint","#"+c).val();this.saveEndpoint=q(".save-endpoint","#"+c).val();this.delayedEndpoint=q(".delayed-endpoint","#"+c).val();this.createListener(c)},createListener:function(a){var c=this;b.on("tabela:state-change:"+a,
function(a){for(var b in c.handlers)if(c.handlers.hasOwnProperty(b)&&!c.handlers[b].allowRefresh(a))return;return c.handleStateChange.call(c,a,a.refreshCallback)});b.on("tabela:save-all:"+a,function(a){return c.handleSave.call(c,a)});b.on("tabela:save-row:"+a,function(a){return c.handleSave.call(c,a)});b.on("tabela:load-delayed-rows:"+a,function(a){return c.handleDelayedLoad.call(c,a)})},scrollOnReload:function(){var a=q("#"+this.container).data("scroll-on-refresh");""!==a&&q(a).get(0).scrollIntoView()},
showLoading:function(){0<this.loadingRequests?this.loadingRequests++:q(".mt-loading-overlay","#"+this.container).show()},hideLoading:function(){this.loadingRequests--;0<this.loadingRequests||q(".mt-loading-overlay","#"+this.container).hide()},unselectAllRows:function(){this.handlers["bulk-action"].clearSelection()},isMarkerEnabled:function(){return"object"===typeof this.utils.markerFactory},getMarkerMachine:function(a){if(this.isMarkerEnabled())return this.utils.markerFactory.getInstance(a)},isReftagEnabled:function(){return this.reftagEnabled},
setReftagEnabled:function(a){this.reftagEnabled=a},setDelayBeforeFiltering:function(a){this.handlers.filter.setDelay(a)},getEndpoint:function(a,b){if(this.isReftagEnabled()){var c=this.utils.reftagUtil,e=c.getReftag(c.fromTag,b);a=c.combineReftagAndUrl(a,e)}return a},getContainerState:function(){var a=this.containerState.getState(),a=a.clientState&&"DRAFT"===a.clientState.viewId&&"SEARCH_CHANGED"===a.action,b=this.handlers.sort.getState();this.containerState.set({pageNumber:this.handlers.pagination.getState(),
pageToken:this.handlers.pagination.getPageToken(),recordsPerPage:this.handlers["records-per-page"].getState(),sortedColumnId:b.column,sortOrder:b.order,searchText:this.handlers.search.getState(),filters:a?l:this.handlers.filter.getState()});return this.containerState.getState()},setClientState:function(a,c){var e=this;"object"===typeof a?(b.each(a,function(a,b){e.handlers[b].setState?e.handlers[b].setState(a):e.containerState.setClientState(b,a)}),e.getContainerState()):e.containerState.setClientState(a,
c)},removeClientState:function(a){this.containerState.removeClientState(a)},insertRows:function(a,c,e){var f=this;if("before"!==e&&"after"!==e&&"end"!==e)throw Error('Position must be defined as either "before" or "after" or "end".');var d=f.tableViewModel.findRowIndexByRowId(a),g=[];"after"===e?d++:"end"===e&&(d=f.tableViewModel.rows.length);q("<table>"+c+"</table>").find("tr.mt-row").each(function(a,b){var c=f.tableViewModel.insertRow(d,b.outerHTML);g.push(c.getRowId());d++});a={container:f.container,
insertedRows:g};b.trigger("tabela:data-inserted",a);b.trigger("tabela:data-inserted:"+f.container,a);return g},removeRows:function(a){var b;q.isArray(a)||(a=[a]);for(var c=0;c<a.length;c++)b=this.tableViewModel.findRowIndexByRowId(a[c]),this.tableViewModel.removeRow(b);return!0},handleStateChange:function(a,c){var e=this,f,d;"undefined"!==typeof a.originalEvent&&"undefined"!==typeof a.originalEvent.action&&(d=a.originalEvent.action);d=e.getEndpoint(e.refreshEndpoint,d);this.containerState.set({action:a.changeType});
e.showLoading();if(this.isMarkerEnabled()){var g="ajax"+e.ajaxRequestNumber++;f=e.getMarkerMachine(g);f.beforeAjax()}g={container:e.container};b.trigger("tabela:table-refresh-begin",g);b.trigger("tabela:table-refresh-begin:"+e.container,g);q.ajax({type:"POST",url:d,contentType:"application/json",dataType:"html",data:h.stringify(e.getContainerState()),success:function(a,b,c){a=e.utils.responseParserFactory.getInstance(a);"undefined"!==typeof f&&f.responseReceived(a.getRequestId());a.isSuccessful()?
(e.dataRefresh(a),e.scrollOnReload()):e.showError.call(e,a.getMessage());"undefined"!==typeof f&&f.responseLoaded()},error:function(){e.showError.call(e,l,-1)},complete:function(f,d){0===f.status&&""===f.getAllResponseHeaders()&&location.reload();e.hideLoading();c(a);var g={container:e.container,status:d,readyState:f.readyState,jqXHRStatus:f.status},t=f.responseText;"success"!==d&&"error"!==d||!e.utils.responseParserFactory.isTabelaResponse(t)||(t=e.utils.responseParserFactory.getInstance(t),g.responseParser=
t);b.trigger("tabela:table-refresh-done",g);b.trigger("tabela:table-refresh-done:"+e.container,g);b.trigger("tabela:ajax-request-done",g);b.trigger("tabela:ajax-request-done:"+e.container,g)}})},handleSave:function(a,c){var e=this,f;if(!e.isSaving){e.isSaving=!0;var d,g=[],t=!1;if("save-row"===a.saveType&&(d=a.$selected.attr("data-action-string"),a.$target&&"function"===typeof a.$target.attr)){var k=a.$target.attr("data-field-to-save");"defect-group"===k?(t=!0,k=a.$target.closest("div[data-column='defect-group-combo']").find("div[data-column='defect-group'] div[data-column]"),
q.each(k,function(a,b){g.push(q(b).attr("data-column"))})):g.push(k)}var r=e.getCurrentEdits(d,g,t),t=e.getEndpoint(e.saveEndpoint,a.action);e.showLoading();this.isMarkerEnabled()&&(k="ajax"+e.ajaxRequestNumber++,f=e.getMarkerMachine(k),f.beforeAjax());k={container:e.container,saveType:a.saveType,updatedRecords:r.updatedRecords};b.trigger("tabela:save-begin",k);b.trigger("tabela:save-begin:"+e.container,k);q.ajax({type:"POST",url:t,contentType:"application/json",dataType:"html",data:h.stringify(r),
success:function(a,b,c){a=e.utils.responseParserFactory.getInstance(a);"undefined"!==typeof f&&f.responseReceived(a.getRequestId());a.isSuccessful()?("MANUAL"!==a.getRefreshMode()&&e.handlers.edit.removePendingChanges(d),e.dataRefresh(a)):e.showError(a.getMessage());"undefined"!==typeof f&&f.responseLoaded()},error:function(){e.showError.call(e,l,-1)},complete:function(c,f){e.hideLoading();e.isSaving=!1;var d={container:e.container,status:f,saveType:a.saveType,updatedRecords:r.updatedRecords},g=c.responseText;
"success"!==f&&"error"!==f||!e.utils.responseParserFactory.isTabelaResponse(g)||(g=e.utils.responseParserFactory.getInstance(g),d.responseParser=g);b.trigger("tabela:save-done",d);b.trigger("tabela:save-done:"+e.container,d);b.trigger("tabela:ajax-request-done",d);b.trigger("tabela:ajax-request-done:"+e.container,d)}})}},handleDelayedLoad:function(a){var c=this,e,f=c.delayedEndpoint,d=f.split("?"),f=d[1]?f+("&highestAttemptNumber="+a.highestAttemptNumber):d[0]+"?highestAttemptNumber="+a.highestAttemptNumber,
d=c.getCurrentDelayed(),g,t=c.getEndpoint(f+"",a.action);try{g=h.stringify(d)}catch(k){g="Exception: Unable to JSON.stringify() the delayed object"}this.isMarkerEnabled()&&(a="ajax"+c.ajaxRequestNumber++,e=c.getMarkerMachine(a),e.beforeAjax());a={container:c.container};b.trigger("tabela:delayed-load-begin",a);b.trigger("tabela:delayed-load-begin:"+c.container,a);if(b.state("s3DelayedConfig")&&-1===t.indexOf("confirmAction"))q.ajax({type:"POST",url:t,contentType:"application/json",dataType:"html",
cache:!1,data:h.stringify(c.getCurrentDelayedContext()),success:function(a,b,f){(a=c.utils.responseParserFactory.getInstance(a))&&!a.has("delayedFieldsFailure")&&("undefined"!==typeof e&&e.responseReceived(a.getRequestId()),a.isSuccessful()?c.dataRefresh(a,!1):0!==f.readyState&&0!==f.status&&c.showError(a.getMessage()),"undefined"!==typeof e&&e.responseLoaded())},error:function(a){0!==a.readyState&&0!==a.status&&c.showError.call(c,l,-1)},complete:function(a,f){var d={container:c.container,status:f,
readyState:a.readyState,jqXHRStatus:a.status},t,B=a.responseText;"success"!==f&&"error"!==f||!c.utils.responseParserFactory.isTabelaResponse(B)||(t=c.utils.responseParserFactory.getInstance(B),d.responseParser=t);t&&t.has("delayedFieldsFailure")&&t.has("delayedFieldsBackupEndpoint")?c.callDelayedEndpointWithDelayedLoad(t.get("delayedFieldsBackupEndpoint"),g,e):(b.trigger("tabela:delayed-load-done",d),b.trigger("tabela:delayed-load-done:"+c.container,d),b.trigger("tabela:ajax-request-done",d),b.trigger("tabela:ajax-request-done:"+
c.container,d))}});else if(b.state("aws-config")&&-1===t.indexOf("confirmAction"))var r=y.uploadFile(g,function(a,f){a?(console.log(a,a.stack),c.callDelayedEndpointWithDelayedLoad("/inventory/testDelayedLoad",g,e)):q.ajax({type:"POST",url:t,contentType:"application/json",dataType:"html",cache:!1,data:r.params.Key,success:function(a,b,f){(a=c.utils.responseParserFactory.getInstance(a))&&!a.has("delayedFieldsFailure")&&("undefined"!==typeof e&&e.responseReceived(a.getRequestId()),a.isSuccessful()?c.dataRefresh(a,
!1):0!==f.readyState&&0!==f.status&&c.showError(a.getMessage()),"undefined"!==typeof e&&e.responseLoaded())},error:function(a){0!==a.readyState&&0!==a.status&&c.showError.call(c,l,-1)},complete:function(a,f){var d={container:c.container,status:f,readyState:a.readyState,jqXHRStatus:a.status},t=a.responseText,B;"success"!==f&&"error"!==f||!c.utils.responseParserFactory.isTabelaResponse(t)||(B=c.utils.responseParserFactory.getInstance(t),d.responseParser=B);B&&B.has("delayedFieldsFailure")&&B.has("delayedFieldsBackupEndpoint")?
c.callDelayedEndpointWithDelayedLoad(B.get("delayedFieldsBackupEndpoint"),g,e):(b.trigger("tabela:delayed-load-done",d),b.trigger("tabela:delayed-load-done:"+c.container,d),b.trigger("tabela:ajax-request-done",d),b.trigger("tabela:ajax-request-done:"+c.container,d))}})});else c.callDelayedEndpointWithDelayedLoad(t,g,e)},callDelayedEndpointWithDelayedLoad:function(a,c,e){var f=this;q.ajax({type:"POST",url:a,contentType:"application/json",dataType:"html",cache:!1,data:c,success:function(a,b,c){a=f.utils.responseParserFactory.getInstance(a);
"undefined"!==typeof e&&e.responseReceived(a.getRequestId());a.isSuccessful()?f.dataRefresh(a,!1):0!==c.readyState&&0!==c.status&&f.showError(a.getMessage());"undefined"!==typeof e&&e.responseLoaded()},error:function(a){0!==a.readyState&&0!==a.status&&f.showError.call(f,l,-1)},complete:function(a,c){var e={container:f.container,status:c,readyState:a.readyState,jqXHRStatus:a.status},d=a.responseText;"success"!==c&&"error"!==c||!f.utils.responseParserFactory.isTabelaResponse(d)||(d=f.utils.responseParserFactory.getInstance(d),
e.responseParser=d);b.trigger("tabela:delayed-load-done",e);b.trigger("tabela:delayed-load-done:"+f.container,e);b.trigger("tabela:ajax-request-done",e);b.trigger("tabela:ajax-request-done:"+f.container,e)}})},getCurrentDelayedContext:function(){this.containerState.set("action","DELAYED_LOAD");return{tableId:this.container,viewContext:this.containerState.getState(),s3Keys:this.handlers["delayed-records"].getS3Keys()}},fetchRows:function(a,c,e){var f=this,d;e.showLoading&&f.showLoading();if(this.isMarkerEnabled()){var g=
"ajax"+f.ajaxRequestNumber++;d=f.getMarkerMachine(g);d.beforeAjax()}g={container:f.container};b.trigger("tabela:table-fetch-rows-begin",g);b.trigger("tabela:table-fetch-rows-begin:"+f.container,g);var t=[];return q.ajax({type:"POST",url:a,contentType:"application/json",dataType:"html",data:h.stringify(f.getContainerState()),success:function(a,b,g){a=f.utils.responseParserFactory.getInstance(a);"undefined"!==typeof d&&d.responseReceived(a.getRequestId());a.isSuccessful()?(f.$container.find(".mt-table-alerts").html(a.getTableAlerts()),
t=f.insertRows(c,a.getItemRecords(),e.position)):f.showError(a.getMessage());"undefined"!==typeof d&&d.responseLoaded()},error:function(){f.showError.call(f,l,-1)},complete:function(a,d){e.showLoading&&f.hideLoading();var g={container:f.container,status:d,fetchedRowIds:t,data:{rowId:c},readyState:a.readyState,jqXHRStatus:a.status},B=a.responseText;"success"!==d&&"error"!==d||!f.utils.responseParserFactory.isTabelaResponse(B)||(B=f.utils.responseParserFactory.getInstance(B),g.responseParser=B);b.trigger("tabela:fetch-rows-done",
g);b.trigger("tabela:fetch-rows-done:"+f.container,g);b.trigger("tabela:ajax-request-done",g);b.trigger("tabela:ajax-request-done:"+f.container,g)}})},dataRefresh:function(a,c){var e=a.getRefreshMode();"undefined"===typeof c&&(c=!0);c?this.$container.find(".mt-table-alerts").html(a.getTableAlerts()):""!==q.trim(a.getTableAlerts())&&this.$container.find(".mt-table-alerts").html(a.getTableAlerts());"TABLE"===e?this.refreshTable(a):"RECORD"===e?(e=q("<table>"+a.getItemRecords()+"</table>"),this.refreshRecord(e)):
"FIELD"===e&&(e=q("<table>"+a.getItemRecords()+"</table>"),this.refreshField(e));e={container:this.container};b.trigger("tabela:data-changed",e);b.trigger("tabela:data-changed:"+this.container,e)},refreshTable:function(a){this.tableViewModel.replaceHtml(a.getItemRecords());this.$container.find(".mt-filter-selected-container").html(a.getSelectedFilters());q("#mt-floating-bar").find(".mt-filter-selected-container").html(a.getSelectedFilters());var b=a.getFilters();if(b){var c=this.$container.find(".mt-filter-container").attr("style");
this.$container.find(".mt-header-filters").html(b);this.$container.find(".mt-filter-container").attr("style",c)}this.$container.find(".mt-foot-pagi").html(a.getPagination());this.handlers.pagination.enabled&&this.handlers.pagination.updateCurrentPage();this.handlers["records-per-page"].enabled&&a.hasRecordsPerPage()&&this.$container.find(".mt-current-records-per-page").val(a.getRecordsPerPage());b=a.getRecordCount();this.$container.find("#mt-header-count-value").text(b);q("#mt-header-count-value-floating").text(b);
0<q(".mt-header-count").find("#listingsCountHeaderWithPageSize").length&&a.hasListingsCountHeaderWithPageSize()&&q(".mt-header-count").find("#listingsCountHeaderWithPageSize").text(a.getListingsCountHeaderWithPageSize());c=this.$container.find(".mt-foot-skiptopage");1===c.length&&c.html(0<b?a.getSkipToPage():"")},refreshRecord:function(a){var b=this;a.find("tr.mt-row").each(function(a,c){var e=q(c).attr("id"),f=b.tableViewModel.getRowByRowId(e);f?f.replaceHtml(c.outerHTML):console.warn("Row with id "+
e+" is not present in the table ")})},refreshField:function(a){var b=this;a.find("tr.mt-row").each(function(a,c){var e=q(c),f=e.attr("id"),d=b.tableViewModel.getRowByRowId(f);d?(q.extend(d.$element.data().rowData,e.data().rowData),e.find("td.mt-cell").each(function(a,b){var c=q(b);d.getFieldByColumnId(c.attr("data-column")).replaceHtml(b.outerHTML)})):console.warn("Row with id "+f+" is not present in the table ")})},updateRowData:function(a,b){var c=this.tableViewModel.getRowByRowId(a).$element.data().rowData,
e=b.find("#"+a).data().rowData;q.extend(c,e)},showError:function(a,b){var c=this.$container.find(".default-error-message-label").val(),e=this;a&&(c=a);e.$container.find("#mt-default-error-text").text(c);e.$container.find(".mt-default-alert").removeClass("a-hidden");q("body").get(0).scrollIntoView();"undefined"===typeof b&&(b=1E4);-1!==b&&setTimeout(function(){e.$container.find(".mt-default-alert").addClass("a-hidden")},b)},getCurrentEdits:function(a,b,c){var e={};e.tableId=this.container;e.updatedRecords=
[];a=this.handlers.edit.getState(a);for(var f=0;f<a.length;f++){var d=[];if(c)d=a[f].updatedFields;else for(var g=a[f].updatedFields,t=0;t<g.length;t++){var k=g[t];b&&0!==b.length&&-1===b.indexOf(k.fieldId)||d.push(k)}g={recordId:a[f].recordId};e.updatedRecords.push(g);g.updatedFields=d}this.containerState.set("action","TABLE_SAVED");e.viewContext=this.getContainerState();return e},triggerTableRefresh:function(a){a={container:this.container,changeType:"CUSTOM_REFRESH",refreshCallback:a||function(){}};
b.trigger("tabela:state-change",a);b.trigger("tabela:state-change:"+this.container,a)},getCurrentDelayed:function(){this.containerState.set("action","DELAYED_LOAD");return{tableId:this.container,delayedRecords:this.handlers["delayed-records"].getState(),viewContext:this.containerState.getState()}}})});m.when("A","myi-tabela-metrics-reporter","Class").register("tabela-action-helper",function(b,h,d){var c=b.$,a=new h;return d.extend({handlerMap:{GET:function(a){var b=a.target;a=a.url;b===l||""===b||
"_top"===b?n.location=a:n.open(a,b)},POST:function(a){var b=c("<form>");b.attr("method","post");b.attr("action",a.url);b.submit()},EVENT:function(a){var c=a.url;b.trigger(c,{container:a.container,recordId:a.record,eventName:c})}},doAction:function(b,c,d,k,r){var h={};h.target=c;h.url=d;h.record=k;h.container=r;if(this.handlerMap[b])this.handlerMap[b](h);else a.logFatal("ActionHelper Exception",{logLevel:"ERROR",message:"Action Type "+b+" is not supported by Action Helper"})}})});m.when("A","Class").register("tabela-util-marker-factory",
function(b,h){var d=h.extend({enabled:!1,scope:"",init:function(b){n.ue&&b&&(this.enabled=!0,this.scope=b)},beforeAjax:function(){this.enabled&&n.uet("tc",this.scope)},responseReceived:function(c){""===c&&(this.enabled=!1);this.enabled&&(n.ues("id",this.scope,c),n.ues("t0",this.scope,b.now()),n.ues("ctb",this.scope,"1"))},responseLoaded:function(){this.enabled&&(n.uet("cf",this.scope),n.uet("be",this.scope),n.uex("ld",this.scope))}});return h.extend({getInstance:function(b){return new d(b)}})});m.when("A",
"ready").register("myi-tabela-metrics-reporter",function(b){return function(){this.logFatal=function(b,d){if(n.ueLogError)try{n.ueLogError(b||"UnknownException",d||"No message was logged for this exception")}catch(c){console.log("Could not log fatal:"+c)}}}});m.when("A","Class").register("tabela-reftag-util",function(b,h){var d=b.$;return h.extend({init:function(b){this.featureSetTag=d(".featureSetTag","#"+b).val()||"xx";this.fromTag=d(".fromTag","#"+b).val()||"xx";this.map={"inline-changed":"line",
"page-clicked":"pgnb","saveall-clicked":"save","search-submit":"srch","sort-clicked":"sort","save-dropdown":"edit"}},getReftag:function(b,a){var e="cont";if(a){var f=this.map,d;for(d in f)if(-1!==a.indexOf(d,a.length-d.length)){e=f[d];break}}return this.featureSetTag+"_"+b+"_"+e+"_"+this.fromTag},combineReftagAndUrl:function(c,a){var e=document.createElement("a");e.href=c;""===e.host&&(e.href=e.href);var f;f="";e.protocol&&e.hostname&&(f=e.protocol+"//"+e.hostname+(0<e.port.length&&"0"!==e.port?":"+
e.port:""));var d;d=("/"===e.pathname.substring(0,1)?"":"/")+e.pathname;f+=d;d=e.search;"undefined"!==typeof a&&(a=b.trim(a),d=(0<d.length?d+"&":"?")+"ref_="+a);return f+d+e.hash}})});m.when("A","Class").register("tabela-util-response-parser",function(b,h){function d(a,b){if(!a.isSuccessful())throw Error("Trying to access "+b+" from a failed response.");if("TABLE"!==a.getRefreshMode())throw Error("Trying to access "+b+" from a non-TABLE response");}function c(a){a=b.trim(a);"#"!==a.charAt(0)&&(a=
"#"+a);return a}function a(a){a=e("<div>"+a+"</div>");if(0===a.find("#mt-request-id").length)throw Error("Unable to find requestId for response");if(0===a.find("#mt-response-status").length)throw Error("Unable to find the response status");if(0===a.find("#mt-response-message").length)throw Error("Unable to find the response message");}var e=b.$,f=h.extend({$serverResponse:l,refreshMode:l,status:l,message:l,init:function(a){this.$serverResponse=e("<div>"+a+"</div>");this.status=this.get("mt-response-status");
this.message=this.get("mt-response-message");this.isSuccessful()&&(this.validateBasicResponse(),this.refreshMode=this.get("refreshMode"),this.validateTableResponse())},validateBasicResponse:function(){if(!this.has("itemRecords"))throw Error("Item Records was not found in response");if(!this.has("refreshMode"))throw Error("Refresh Mode was not found in response");},validateTableResponse:function(){if("TABLE"===this.refreshMode){if(!this.has("pagination"))throw Error("Pagination was not found in response");
if(!this.has("filter"))throw Error("Filter was not found in response");if(!this.has("recordCount"))throw Error("Record Count was not found in response");if(!this.has("currentPage"))throw Error("Current Page was not found in response");if(!this.has("tableName"))throw Error("Table Name was not found in response");}},isSuccessful:function(){return"SUCCESS"===this.status},getMessage:function(){return this.message},getRequestId:function(){return this.get("mt-request-id")},getRefreshMode:function(){return this.refreshMode},
getItemRecords:function(){if(!this.isSuccessful())throw Error("Trying to access itemRecords from a failed response.");return this.get("itemRecords")},getTableAlerts:function(){if(!this.isSuccessful())throw Error("Trying to access table alerts from a failed response.");return this.get("table-alerts")},getPagination:function(){d(this,"pagination");return this.get("pagination")},getSelectedFilters:function(){d(this,"selected filter");return b.trim(this.$serverResponse.find("#filter script").html())},
getFilters:function(){d(this,"filters");return b.trim(this.$serverResponse.find("#filters script").html())},getRecordsPerPage:function(){d(this,"recordsPerPage");return this.get("recordsPerPage")},hasRecordsPerPage:function(){return this.has("recordsPerPage")},getRecordCount:function(){d(this,"record count");return this.get("recordCount")},getCurrentPage:function(){d(this,"current page");return this.get("currentPage")},getTableName:function(){d(this,"table name");return this.get("tableName")},getSkipToPage:function(){return this.get("gotopage")},
getListingsCountHeaderWithPageSize:function(){return this.get("listingsCountHeaderWithPageSizeRefreshed")},hasListingsCountHeaderWithPageSize:function(){return this.has("listingsCountHeaderWithPageSizeRefreshed")},get:function(a){a=c(a);if(!this.has(a))throw Error("Unable to find "+a+" in this response.");a=this.$serverResponse.children(a);var e=a.children(":first");return e.is("script")?b.trim(e.html()):b.trim(a.text())},has:function(a){a=c(a);return 0<this.$serverResponse.children(a).length}});
return h.extend({getInstance:function(b){a(b);return new f(b)},isTabelaResponse:function(b){try{return a(b),!0}catch(c){return!1}},validateServerResponse:function(b){a(b)}})});m.when("A","ready").register("tabela-history-plugin",function(b){return function(h){var d=this,c=b.$;d.o=h;d._updateTableState=function(a){a=function(a,c){var g={};b.each(a,function(b,r){a[r]!==c[r]&&(g[d.change.handlerNames[r]]=b)});return g}(d._getParamValue(d.paramKey,a||n.location.search.substring(1)),d.table.getState());
b.objectIsEmpty(a)||(d.table.setClientState(a),d.table.refreshTable())};d._bindStateListeners=function(){d.events={popState:{event:"popstate",cb:function(a){d._updateTableState()}},stateChange:{event:"tabela:state-change:"+d.tableName,cb:function(a){-1!==b.indexOfArray(d.change.events,a.changeType)&&d._update()}},refresh:{event:"tabela:table-refresh-done:"+d.tableName,cb:function(a){d._update(!0)}}};b.each(d.events,function(a,e){if("popState"===e)c(n).bind(a.event,a.cb);else b.on(a.event,a.cb)})};
d.unbindEvents=function(){b.each(d.events,function(a,e){"popState"===e?c(n).unbind(a.event,a.cb):b.off(a.event,a.cb)})};d._update=function(a){var c="",f=d.table.getState();b.each(d.change.handlerNameList,function(a){var k;1<d.change.keys[a].length?(k={},b.each(d.change.keys[a],function(a){k[a]=f[a]})):k=f[d.change.keys[a][0]];c+=a+":"+encodeURIComponent(d.change.handlers[a](k))+";"});d._pushState(c,a);return c};d._buildHandlers=function(a){var c={handlers:{},handlerNames:{},handlerNameList:[],parsers:{},
keys:{},events:[]};b.each(a,function(a,b){c.handlers[a.handlerName]=a.handler;c.parsers[a.handlerName]=a.parser;c.handlerNames[a.handlerName]=a.handlerName;c.handlerNameList.push(a.handlerName);c.keys[a.handlerName]=a.keys;c.events.push(a.changeEvent)});return c};d._getParamValue=function(a,c){var f=c.split("&"),g=null;b.each(f,function(b,c){var e=f[c].split("="),d=e[1];e[0]===a&&(g=d)});if(g){var k=g.split(";"),r={};b.each(k,function(a,b){var c=k[b].split(":"),e=c[0],c=c[1];e&&(r[e]=d.change.parsers[e](decodeURIComponent(c)))});
return r}};d._pushState=function(a,b){if(d.hasPushState||d.o.refresh){var c=d._rebuildURL(n.location.search,n.location.hash,d.paramKey,a);!d.hasPushState&&d.o.refresh?n.location.href="https://"+n.location.host+n.location.pathname+c:b&&history.replaceState?history.replaceState(null,document.title,c):history.pushState(null,document.title,c)}};d._rebuildURL=function(a,c,f,d){d=f+"="+d;""===a?a="?"+d:b.contains(a,f)?(f=new RegExp("([?&])"+f+"=.*?(&|$)","i"),a=a.replace(f,"$1"+d+"$2")):a=a+"&"+d;return a+
c};d.o.refresh=function(a){return"string"===typeof a&&"true"===a.toLowerCase()||"string"===typeof a&&"1"===a||"boolean"===typeof a&&!0===a||"number"===typeof a&&1===a?!0:!1}(d.o.refresh);d.table=d.o.table;d.tableName=d.table.getInstanceName();d.paramKey="tbla_"+d.tableName;d.change=d._buildHandlers(d.o.handlers);d.hasPushState=!1;n.history&&history.pushState&&(d.hasPushState=!0);d._bindStateListeners();d.hasPushState&&d._update(!0)}});m.when("A","ready").register("tabela-history-handler-factory",
function(b){function h(a){this.changeEvent=a.changeEvent;this.handler=a.handler;this.parser=a.parser;this.handlerName=a.handlerName;this.keys=a.keys;return this}function d(a){function b(a){return a}function c(a){return JSON.stringify(a)}function d(a){return JSON.parse(a)}var k=1<a.keys.length?!0:!1;a.handler=a.handler||(k?c:b);a.parser=a.parser||(k?d:b);k=null;k=[];a.keys||k.push("keys");a.changeEvent||k.push("changeEvent");a.handlerName||k.push("handlerName");a.parser||k.push("parser function");
a.handler||k.push("handler function");return k=0===k.length?new h(a):"Error creating new HistoryHandler.  Missing key(s): "+k.join(", ")}function c(a){var c=[];b.each(a,function(a,b){c.push(b)});return c}return{create:function(a){return d(a)},handlers:{pagination:d({handlerName:"pagination",keys:["pageNumber"],changeEvent:"PAGE_CHANGED"}),search:d({handlerName:"search",keys:["searchText"],changeEvent:"SEARCH_CHANGED"}),sort:d({handlerName:"sort",keys:["sortOrder","sortedColumnId"],changeEvent:"SORT_CHANGED"}),
getAllDefaults:function(){var a=this,e=c(this),f=[];e.pop();b.each(e,function(b){f.push(a[b])});return f}},isHistoryHandler:function(a){return a instanceof h}}});m.when("A","moment-timezone-js","jQueryUI-datepicker").register("date-util",function(b,h){var d=b.$;return function(){var b=this;this.isDateValid=function(a){var b=a.val();try{var c=a.datepicker("option","dateFormat");d.datepicker.parseDate(c,b);return!0}catch(g){return!1}};this.getDateinISOFormat=function(a,e){var f=a.datepicker("getDate"),
d="",k="DATE_RANGE_END_VAR"===a.attr("id"),r="DATE_RANGE_START_VAR"===a.attr("id"),l=k?23:0,t=k?59:0;b.isDateValid(a)&&f&&(f={year:f.getFullYear(),month:f.getMonth(),day:f.getDate(),hour:l,minute:t,second:t},f=h.tz(f,e),d=k||r?f.format("YYYY-MM-DDTHH:mm:ssZZ"):f.utc().toISOString());return d};this.createDatePicker=function(a,e){d.datepicker.setDefaults(d.datepicker.regional[""]);a.forEach(function(a){d(a).removeClass("hasDatepicker");d(a).datepicker(d.datepicker.regional[e.datepickerLanguage]);if(d(a).val()){var g=
b.getDateinISOFormat(d(a),e.timeZone);if(g){var k=e.timeZone,r=h.utc(g).tz(k),g=r.format("YYYY"),k=r.format("MM"),r=r.format("DD");--k;g=new Date(g,k,r);d(a).datepicker("setDate",g)}}})};this.showDatepicker=function(a){a.datepicker("show")}}});m.when("ready").register("uuid-util",function(){return{createUuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var h=Math.floor(16*Math.random());return("x"===b?h:h&3|8).toString(16)})}}});m.when("Class","A","tabela-reftag-util",
"tabela-util-marker-factory","tabela-util-response-parser","tabela-record-controller","tabela-table-view-model","tabela-history-plugin","tabela-action-helper").register("Tabela",function(b,h,d,c,a,e,f,g,k){function r(a,b,c){a=c._viewModels.table.getRowByRowId(a);if(a!==l){if(b===l)return a.getPublicViewModel();b=a.getFieldByColumnId(b);if(b!==l)return b.getPublicViewModel()}}var m=h.$;return b.extend({_controllers:l,_viewModels:l,_utils:l,init:function(b){this._container=b;this._utils={reftagUtil:new d(b),
markerFactory:new c,responseParserFactory:new a,actionHelper:new k};this._viewModels={table:new f(b)};this._controllers={};this._controllers.record=new e(b,this._utils,this._viewModels)},setHistoryHandlers:function(a,b){this._tabelaHistory&&(this._tabelaHistory.unbindEvents(),this._tabelaHistory=null);var c=m.extend({table:this,handlers:a},b);this._tabelaHistory=new g(c)},getHistoryUtil:function(){return this._tabelaHistory},getInstanceName:function(){return this._container},getState:function(){return this._controllers.record.getContainerState()},
setClientState:function(a,b){this._controllers.record.setClientState(a,b)},removeClientState:function(a){this._controllers.record.removeClientState(a)},showError:function(a,b){this._controllers.record.showError(a,b)},insertRows:function(a,b,c){return this._controllers.record.insertRows(a,b,c)},removeRows:function(a){return this._controllers.record.removeRows(a)},getResponseParser:function(a){return this._utils.responseParserFactory.getInstance(a)},refreshDataFromResponse:function(a,b){a.isSuccessful()&&
this._controllers.record.dataRefresh(a,b)},showLoading:function(){this._controllers.record.showLoading()},hideLoading:function(){this._controllers.record.hideLoading()},refreshTable:function(a){return this._controllers.record.triggerTableRefresh(a)},unselectAllRows:function(){this._controllers.record.unselectAllRows()},getViewModel:function(a,b){return r(a,b,this)},extractRowDataFromRecord:function(a){return r(a,l,this).getRowData()},fetchRows:function(a,b,c){c=m.extend({},{position:"after",showLoading:!0},
c);return this._controllers.record.fetchRows(a,b,c)},setConfig:function(a){a=m.extend({},{reftagEnabled:"object"===typeof this._utils.reftagUtil,filterDelay:0},a);this._controllers.record.setReftagEnabled(a.reftagEnabled);this._controllers.record.setDelayBeforeFiltering(a.filterDelay)}})});m.when("Class","Tabela").register("tabela-manager",function(b,h){if("undefined"!==typeof n.TabelaManager)return n.TabelaManager;var d={},c=b.extend({get:function(a){if("undefined"!==typeof d[a])return d[a];throw Error("Unable to get non-existent Tabela instance ("+
a+") from TabelaManager");},create:function(a){if("undefined"===typeof d[a])return d[a]=new h(a),d[a];throw Error("Unable to create Tabela instance and add to TabelaManager: table with same name ("+a+") already exists");}});n.TabelaManager=new c;return n.TabelaManager});m.when("A","AWS","uuid-util","ready").register("myi-s3",function(b,h,d){var c=b.state("aws-config"),a;c&&(a=new h.S3({params:{Bucket:c.s3Bucket}}));return{uploadFile:function(b,f){var g={Key:c.s3KeyPrefix+d.createUuid(),
Body:b,ContentType:"application/json"};return a.putObject(g,f)}}});m.when("A","jQuery","ready").execute("load-aws",function(b,h){h.getScript("https://sdk.amazonaws.com/js/aws-sdk-2.2.1.min.js",function(){m.register("AWS",function(){var d=n.AWS,c=b.state("aws-config");c&&(d.config.region=c.region,d.config.credentials=new d.Credentials(c.credentials));return d})})})});