(function(p){var r=window.AmazonUIPageJS||window.P,w=r._namespace||r.attributeErrors,a=w?w("MadagascarAssets"):r;a.guardFatal?a.guardFatal(p)(a,window):a.execute(function(){p(a,window)})})(function(p,r,w){p.when("A","tabela-manager","tabela-table-myitable","interstitial-page-data","bulk-actions-util","points-util","mlp-metrics-util","mongoose-client-strings").execute(function(a,g,l,m,b,f,h,k){var e=new f,d=new h;l=g.get("myitable");var t="",c=a.$,q=function(){var c=[];a.each(m.rowIds,function(a){var b=
{};b.recordId=a;t&&(b.shipping=t);c.push(b)});return c},A=function(){var c=!1;a.each(m.rowIds,function(a){if("AFN"===g.get("myitable").getViewModel(a).getRowData().fulfillment_channel)return c=!0,!1});return c},u=[];a.on("ready",function(){if("b2bclose"===m.actionId){var b=a.$("div#interStitialPageMessage").html(),d=k.get("mongoose_b2b_close_warning"),e=!0;A()&&(d+=" "+k.get("mongoose_b2b_close_warning_afn_listings"));a.$("div#interStitialPageMessage").html(b+"<br />"+d);a.each(m.rowIds,function(a){a=
g.get("myitable").getViewModel(a).getRowData();if(!a.businessPrice||"AFN"!==a.fulfillment_channel)return e=!1});e&&(a.$("#interstitialPageContinue").css("display","none"),a.$("#interstitialPageContinueDisabled").css("display","inline-block"))}else if("bulkfixdefects"===m.actionId)a.on("tabela:delayed-load-done",function(a){var b=c("#optionalData").data("content").changedValueDisplayText;c('[data-column="defects"]').each(function(){c(this).text(b)})})});a.$("#interstitialPageContinue").click(function(){switch(m.actionId){case "matchlowprice":p();
break;case "setbusinesspricediscount":a.$("#interstitialPageWarningAlert").css("display","none");break;case "reactivate":C();break;case "advertiselisting":break;default:a.$("#interstitialPageWarningAlert").css("display","none")}a.trigger("confirm"+m.actionId,q())});a.$("#interstitialPageSaveAll").click(function(){a.$("#interstitialPageWarningAlert").css("display","none");try{for(var c=u.length,e=g.get("myitable").getState().clientState.viewId,k=d.getMerchantId(),f=0;f<c;f++){var h=u[f].recordId;if(d.isMlpFlagSet(h)){var q=
"",m=l.getViewModel(h,"price");if(m&&m.$element&&m.$element.find){var t=m.$element.find("[data-column='price']");t&&t.text&&(q=t.text())}d.logMlpUsageForRecord("MLP",e,k,h,q)}}}catch(K){console.log("Error encountered during MLP usage logging: "+K)}r.saveData(u,"/inventory/confirmActionSave",(new b).confirmActionSuccessCallback,(new b).confirmActionErrorCallback)});a.on("a:dropdown:select",function(b){t=b.value;b=c(c.find("#interStitialPageMessage"));var d=b.text(),d=d.replace("%s",t);b.html(d);a.$("#interstitialPageWarningAlert").css("display",
"inline-block");a.$("#shippingTemplateListId").css("display","none")});var C=function(){a.each(m.rowIds,function(a,c){var b=g.get("myitable").getViewModel(a).getRowData().priceErrorType,d=e.getCurrentNetPrice(g.get("myitable"),a);"highPriceError"===b?u.push({recordId:a,updatedFields:[{fieldId:"maximumPrice",changedValue:d}]}):"lowPriceError"===b&&u.push({recordId:a,updatedFields:[{fieldId:"minimumPrice",changedValue:d}]})});D(u)},D=function(c){0===c.length?a.$("span#interstitialPageSaveAllDisabled").css("display",
"inline-block"):a.$("span#interstitialPageSaveAll").css("display","inline-block");a.$("span#interstitialPageContinue").css("display","none")},p=function(){a.each(m.rowIds,function(a,c){var b,e,k=d.getLowPriceDataByRowId(a);k&&(b=JSON.parse(k).lowPriceSuggestion,e=JSON.parse(k).lowPointsSuggestion);var k=g.get("myitable").getViewModel(a).getRowData().price,f=g.get("myitable").getViewModel(a).getRowData().points;(b&&k!==b||e&&f!==e)&&d.setMlpFlag(a);e?u.push({recordId:a,updatedFields:[{fieldId:"price",
changedValue:b,beforeValue:k},{fieldId:"points",changedValue:e,beforeValue:f}]}):b&&k!==b&&u.push({recordId:a,updatedFields:[{fieldId:"price",changedValue:b,beforeValue:k}]})});D(u)}});p.when("A","tabela-manager","JSON","tabela-table-myitable","mongoose-client-strings","bulk-actions-util","points-util","mlp-metrics-util","a-modal","a-dropdown","bulk-fix-tool","reftagHandler","metrics-reporter","MadagascarAjax","bulk-fix-modal","delete-handler","generate-template-handler","bulk-actions-common","resubmit-draft-handler").execute(function(a,
g,l,m,b,f,h,k,e,d,t,c,q,A,u,C,D,p,G){var v=a.$;m=g.get("myitable");var z=new h,B=new k,y=new c,F=new q,I=new A(m,F),J="true"===v("#useNewFYI").attr("value"),K=new t,n=new p(a,b,g,m);new C(a,l,b,n,m,y,I,e,f);new D(a,l,n,y,I,f);var x=new u(a,v,d,m,b,n.extractRowIdsFromData,F,J),E=function(n,c){var b=v("<form />").attr({action:c,method:"post"}).append(v("<input />").attr({type:"hidden",name:"cancelURL",value:"/inventory"}));a.each(n,function(a,n){var c=v("<input>");c.attr({type:"hidden",name:n,value:a});
b.append(c)});v("body").append(b);b.submit()},O=function(c,b,d){a.each(c,function(a,c){var b=n.extractRowDataFromRecord(a);b&&b.sku&&(d["mSku."+c]=b.sku,b.quantity&&(d["quantity."+c]=b.quantity))});E(d,b)},M=function(c,b,d){a.each(c,function(a,c){var b=n.extractRowDataFromRecord(a);b&&b.sku&&(d["mSku."+c]=b.sku,d["asin."+c]=b.asin,d["fnSku."+c]=b.fnsku)});E(d,b)},H=function(c,b,d,e){var k=n.extractRowIdsFromData(c),f=1===k.length&&!m.getViewModel(k[0]);1<k.length||f?n.postConfirmAction(b,d,k,e):(e&&
(c.optionalData=e),a.trigger("confirm"+b,c))};a.on("setreplenishmentalerts",function(a){H(a,"setreplenishmentalerts",b.get("mongoose_setReplenishmentAlerts"))});a.on("confirmsetreplenishmentalerts",function(c){c=n.extractRowIdsFromData(c);var b=y.addReftagToPath("/gp/ssof/alerts/set-replenishment-alerts.html","fbarpal",c.length),d={};a.each(c,function(a,c){var b=n.extractRowDataFromRecord(a);b&&(b.sku&&(d["mSku."+c]=b.sku),b.asin&&(d["asin."+c]=b.asin),b.fnsku&&(d["fnSku."+c]=b.fnsku))});E(d,b)});
a.on("sendinventory",function(a){H(a,"sendinventory",b.get("mongoose_SendInventory"))});a.on("confirmsendinventory",function(a){a=n.extractRowIdsFromData(a);var c=y.addReftagToPath("/gp/ssof/workflow/sendinventory.html","fbainventy",a.length);M(a,c,{action:"send",fulfillmentChannel:"AMAZON"})});a.on("changetofba",function(a){H(a,"changetofba",b.get("mongoose_changetofba"))});a.on("unblockwithfba",function(a){H(a,"changetofba",b.get("mongoose_changetofba"))});a.on("confirmchangetofba",function(a){a=
n.extractRowIdsFromData(a);var c=y.addReftagToPath("/gp/ssof/transfer-fn-confirm.html","fbachfba",a.length);O(a,c,{})});a.on("changetomfn",function(a){H(a,"changetomfn",b.get("mongoose_actions_toMerch"))});a.on("confirmchangetomfn",function(a){a=n.extractRowIdsFromData(a);var c=y.addReftagToPath("/gp/ssof/transfer-fn-confirm.html","fbachmfn",a.length);O(a,c,{fulfillmentChannel:"DEFAULT"})});a.on("createremovalorder",function(a){H(a,"createremovalorder",b.get("mongoose_actions_removal"))});a.on("confirmcreateremovalorder",
function(a){a=n.extractRowIdsFromData(a);var c=y.addReftagToPath("/gp/basic-fulfillment/v2/start-removal.html","fbastrm",a.length);M(a,c,{})});a.on("createfulfillmentorder",function(a){H(a,"createfulfillmentorder",b.get("mongoose_actions_fulfill"))});a.on("confirmcreatefulfillmentorder",function(a){a=n.extractRowIdsFromData(a);var c=y.addReftagToPath("/gp/basic-fulfillment/v2/start-order.html","fbastod",a.length);M(a,c,{})});a.on("printitemlabels",function(a){H(a,"printitemlabels",b.get("mongoose_actions_print"))});
a.on("confirmprintitemlabels",function(a){a=n.extractRowIdsFromData(a);var c=y.addReftagToPath("/gp/ssof/print-item-labels.html","fbaprntlab",a.length);M(a,c,{})});a.on("close",function(a){var c=n.extractRowIdsFromData(a);1<c.length?n.postConfirmAction("close",b.get("mongoose_close"),c):P(a,"/inventory/save")});a.on("b2bclose",function(a){a=n.extractRowIdsFromData(a);n.postConfirmAction("b2bclose",b.get("mongoose_close"),a)});a.declarative("bulkFixModalSaveButton","click",function(a){var c=x.getModalData(),
n=[],b=[],e=[],k=[];c.supportedDefectAttributesToFix.forEach(function(a,f){var x=c.inputElements[f],h;x.isDropDown?(h=x.element.find("option:selected").text(),x=d.getSelect(x.element.find('span [id^="bulkFixDropdownNativeSelect"]')).val()):(h=x.element.val(),x=x.element.val());""!==x.trim()&&(e.push(a),n.push(h),b.push(x),k.push(c.feedsNames[f]))});a={fieldIds:e,changedValues:b,changedValuesDisplayTexts:n,productType:c.recordIdToProductTypeMap,feedsNames:k,asin:c.recordIdToAsinMap};if(J){var f=c.recordIds;
f.optionalData=a;x.showHideBulkFixModalConfirmAction(!0,f)}else H(c.recordIds,"bulkfixdefects","bulk fix defects",a)});a.declarative("bulkFixModalConfirmButton","click",function(){var c=v("#bulkFixConfirm");try{var n=l.parse(c.attr("record_data"));if(n){var b=l.parse(c.attr("optional_data"));b&&(n.optionalData=b,a.trigger("confirmbulkfixdefects",n))}}catch(d){F.logFatal("Parsing of bulkFixModalConfirmButton failed with exception",d.message)}});a.declarative("bulkFixModalBackButton","click",function(){x.showHideBulkFixModalConfirmAction(!1,
"")});a.on("confirmbulkfixdefects",function(c){var n=e.get("bulkFixModal");n&&n.hide();var b;b=c.optionalData?c.optionalData:v("#optionalData").data("content");for(var d=[],n=0;n<b.fieldIds.length;n++){var k=b.fieldIds[n];d.push({fieldId:"defects-"+k,changedValue:b.changedValues[n],metadata:{attribute:k,feedsName:b.feedsNames[n]}})}var x=[];a.each(c,function(c){var n=b.productType[c.recordId],e=b.asin[c.recordId],k=v.extend(!0,[],d);a.each(k,function(a){a.metadata.productType=n;a.metadata.asin=e});
x.push({recordId:c.recordId,updatedFields:k})});c=new f;r.saveData(x,y.addReftagToPath("/inventory/confirmActionSave","myiblkfxcnf"),K.bulkFixSuccessCallback,c.confirmActionErrorCallback)});a.on("bulkfixdefects",function(a){x.handleBulkFix(a)});h=g.get("myitable").getState().clientState.viewId;0<a.$("#defects").length&&("DEFECT"===h||"SUPPRESSED"===h||J)&&(new t).init();a.on("resubmit",function(c){G(a,m,c,n.extractRowIdsFromData,n.extractRowDataFromRecord,r.saveData)});var P=function(c,b,d,e){c=n.extractRowIdsFromData(c);
if(0<c.length){var k=[];a.each(c,function(a,c){k.push({recordId:a,updatedFields:[{fieldId:"status",changedValue:"Inactive (Closed)",beforeValue:"Active"}]})});b=y.addReftagToPath(b,"myiclose",c.length);r.saveData(k,b,d,e)}},N=function(c,b,d,e){c=n.extractRowIdsFromData(c);if(0<c.length){var k=[];a.each(c,function(a,c){var b=n.extractRowDataFromRecord(a);b.businessPrice&&"AFN"!==b.fulfillment_channel?k.push({recordId:a,updatedFields:[{fieldId:"quantity",changedValue:0,beforeValue:0}]}):b.businessPrice||
k.push({recordId:a,updatedFields:[{fieldId:"status",changedValue:"Inactive (Closed)",beforeValue:"Active"}]})});b=y.addReftagToPath(b,"myib2bc",c.length);r.saveData(k,b,d,e)}};a.on("confirmclose",function(a){P(a,"/inventory/confirmActionSave",(new f).confirmActionSuccessCallback,(new f).confirmActionErrorCallback)});a.on("confirmb2bclose",function(a){N(a,"/inventory/confirmActionSave",(new f).confirmActionSuccessCallback,(new f).confirmActionErrorCallback)});r.saveData=function(a,c,n,b,d){var e=g.get("myitable").getState();
e.action="TABLE_SAVED";I.makeAjaxCall("POST",c,{tableId:"myiTable",updatedRecords:a,viewContext:e},n,b,d)};a.on("tabela:save-begin",function(a){try{var c=a.updatedRecords,n=c.length,b=g.get("myitable").getState().clientState.viewId,d=B.getMerchantId();for(a=0;a<n;a++){var e=c[a].recordId;if(B.isMlpFlagSet(e)){var k="",x=m.getViewModel(e,"price");if(x&&x.$element&&x.$element.find){var f=x.$element.find("[data-column='price']");if(f&&f.find){var h=f.find(".mt-input-text");h&&h.val&&(k=h.val())}}B.logMlpUsageForRecord("MLP",
b,d,e,k)}}}catch(q){console.log("Error encountered during MLP usage logging: "+q)}});a.declarative("match-low-price","click",function(a){var c=a.data,n=null;(a=a.$currentTarget.closest(".mt-row"))&&1===a.length&&(n=a.attr("id"));if(n){if(a=m.getViewModel(n,"price")){a=a.subFields.price;var b=m.getViewModel(n,"points");a&&("TEXT_FIELD"===a.getFieldType()?a.replaceText(c.currencySymbol+" "+c.lowPriceSuggestion):"EDITABLE_FIELD"===a.getFieldType()&&a.setVal(c.lowPriceSuggestion));c.lowPriceSuggestion&&
b&&("TEXT_FIELD"===b.getFieldType?Q(b,c):w(b,c))}setTimeout(function(){B.setMlpFlag(n)},0)}else F.logFatal("MatchLowPriceError",{logLevel:"ERROR",attribution:"match-low-price",message:"invalid record Id."})});var w=function(a,c){Q(a,c);var d=v(v.find("#"+c.recordId+"_points_accordion")),e=d.find("input.input_points");d.find("input.decimalSeparator");e.val(S(c.lowPriceSuggestion,c.lowPointsSuggestion));d.find("span.currentItemPrice").html(c.lowPriceSuggestion);e=d.find("span.pointsInNumber");d.find("input.isMLP").val("true");
e.empty().append(c.lowPointsSuggestion+b.get("mongoose_points_units"));d.find("input.pointsValueCurrent").val(c.lowPointsSuggestion);d=d.find("input.mt-input-text");e=n.extractRowDataFromRecord(c.recordId);e.points===c.lowPointsSuggestion||e.price===c.lowPriceSuggestion?d.val(c.lowPointsSuggestion+"-"+c.lowPriceSuggestion):d.val(c.lowPointsSuggestion);d.change()},Q=function(a,c){var n=a.$element,d=n.find("span.mt-text-content"),e=S(c.lowPriceSuggestion,c.lowPointsSuggestion),e=c.lowPointsSuggestion+
" "+b.get("mongoose_points_units")+" ("+e+"%)";d.html()?d.html(e):n.html('<div class="mt-text mt-wrap-bw"><span class="mt-text-content"><font><font>'+e+"</font></font></span></div>")},S=function(a,c,n){a=a.replace(/decimalSeparator/g,".");a=a.replace(/[^\d.-]/g,"");return(c/a*100).toFixed(2)};a.on("confirmmatchlowprice",function(c){c=n.extractRowIdsFromData(c);0<c.length&&a.each(c,function(a,c){var n=g.get("myitable").getViewModel(a,"lowPrice");n&&n.hasSubFields()&&(n=n.subFields["lowPrice-match-link"].$element.children(":first"),
n.focus(),n.click())})});a.on("matchlowprice",function(a){H(a,"matchlowprice",b.get("mongoose_match_lowprice"))});a.on("bulksbr",function(a){var c=b.get("mongoose_bulksbr");a:{a=n.extractRowIdsFromData(a);var d=n.getMaxRecordsOnPage();if(a.length>d)if(r.confirm(n.getMaxRecordsOnPageWarning(d)))a=a.slice(0,d);else break a;d={actionId:"bulksbr"};d.actionDisplayText=c;d.recordIds=a;c=g.get("myitable").getState();d.viewId=c.clientState.viewId;c=v("<form />").attr({action:"/inventory/sbrConfirmAction",
method:"POST"}).append(v("<input />").attr({type:"hidden",name:"confirmActionData",value:l.stringify(d)}));v("body").append(c);c.submit()}});a.on("confirmbulksbr",function(a){T(a,"/inventory/confirmActionSave",(new f).confirmActionSuccessCallback,(new f).confirmActionErrorCallback)});var T=function(c,b,d,e){var k=n.extractRowIdsFromData(c),x;x=c&&c.shipping?[c.shipping]:c?c[0].shipping:void 0;if(0<k.length){var f=[];a.each(k,function(a,c){f.push({recordId:a,updatedFields:[{fieldId:"shipping",changedValue:x,
beforeValue:x}]})});c=y.addReftagToPath(b,"myisbcf",k.length);r.saveData(f,c,d,e)}};a.on("confirmsetbusinesspricediscount",function(c){c=n.extractRowIdsFromData(c);a.$("#businessPricePopoverTrigger").click();var d=a.$("div#bulk_action_business_price_accordion"),e;(e=d.parents("div.a-popover-preload"))&&0!==e.length||(e=d.parents("div.a-popover"));d=l.parse(e.find("span[data-action='set-business-price']").attr("data-set-business-price"));d.recordIds=c;e.find("span[data-action='set-business-price']").attr("data-set-business-price",
l.stringify(d));e.find("span[data-action='no-business-price-click']").attr("data-no-business-price-click",l.stringify(d));e.find("span.myiPopoverTitle").html(b.get("mongoose_business_price_header_bulk").replace(/\$\{numberOfProducts\}/g,c.length))});a.on("fix",function(a){a=n.extractRowIdsFromData(a)[0];a=n.extractRowDataFromRecord(a);var c=encodeURIComponent(a.sku);r.open(a.fyiUrl+"&sku="+c,"_blank")});a.on("confirmadvertiselisting",function(c){var b="/hz/cm/sku/advertise?",d="";c=n.extractRowIdsFromData(c);
a.each(c,function(a,c){var b=n.extractRowDataFromRecord(a);d+="skuList="+encodeURIComponent(b.sku)+"&"});b+=d;(c=e.get("adListingsModal"))?c.update({url:b}).show():(a.$("#adListingsModalDeclarative").attr("data-a-modal",l.stringify({url:b,name:"adListingsModal"})),a.$("#adListingsModalTrigger").click())});a.on("advertiselisting",function(a){H(a,"advertiselisting",b.get("mongoose_advertiselisting"))});r.dismissAdvertiseListingFrame=function(){-1!==g.get("myitable").getState().clientState.viewId.indexOf("CONFIRMACTION_INTERSTITIAL")?
r.location="/inventory":v(".a-popover.a-popover-modal .a-button-close.a-declarative").click()};a.on("setbusinesspricediscount",function(a){H(a,"setbusinesspricediscount",b.get("mongoose_set_businessprice_discount"))});a.on("confirmsetpoints",function(c){c=n.extractRowIdsFromData(c);a.$("#pointsPopoverTrigger").click();var d=a.$("div#bulk_action_points_accordion"),e;(e=d.parents("div.a-popover-preload"))&&0!==e.length||(e=d.parents("div.a-popover"));d=l.parse(e.find("span[data-action='points-text-input-declarative-id-percent-bulk']").attr("data-points-text-input-declarative-id-percent-bulk"));
d.recordIds=c;e.find("span[data-action='points-text-input-declarative-id-percent-bulk']").attr("data-points-text-input-declarative-id-percent-bulk",l.stringify(d));e.find("span[data-action='set-points-button-declarative-id-percent-bulk']").attr("data-set-points-button-declarative-id-percent-bulk",l.stringify(d));e.find("span[data-action='no-points-click']").attr("data-no-points-click",l.stringify(d));e.find("span.myiPopoverTitle").html(b.get("mongoose_points_set").replace(/\$\{numberOfProducts\}/g,
c.length))});a.on("setpoints",function(a){H(a,"setpoints",b.get("mongoose_points_set"))});a.declarative("remove-all-unfulfillable","click",function(a){E({},"/gp/basic-fulfillment/v2/start-removal-all-unf.html")});a.declarative("create-removal-order","click",function(a){M([a.data.recordId],"/gp/basic-fulfillment/v2/start-removal.html",{})});a.on("reactivate",function(a){H(a,"reactivate",b.get("mongoose_reactivate"))});a.on("confirmreactivate",function(c){g.get("myitable");var b=g.get("myitable").getState().clientState.viewId;
c=n.extractRowIdsFromData(c);a.each(c,function(a,c){var d=n.extractRowDataFromRecord(a),e=d.priceErrorType;if(e){var k=z.getCurrentNetPrice(m,a);"highPriceError"===e?(e=g.get("myitable").getViewModel(a,"maximumPrice").subFields.maximumPrice,-1!==b.indexOf("CONFIRMACTION_INTERSTITIAL")?e.replaceText(d.currencySymbol+" "+k):e.setVal(k)):"lowPriceError"===e&&(e=g.get("myitable").getViewModel(a,"minimumPrice").subFields.minimumPrice,-1!==b.indexOf("CONFIRMACTION_INTERSTITIAL")?e.replaceText(d.currencySymbol+
" "+k):e.setVal(k))}})});a.declarative("batchid-search","click",function(a){a=a.data.batchId;v("#myitable-search").val(a);v("#myitable-search-form").submit(function(a){a.preventDefault()});v("#myitable-search-form").submit()})});p.when("A","tabela-manager").register("bulk-actions-util",function(a,g){return function(){var l=this,m="/inventory";a.state("myiPricingMetadata")!==w&&(m=a.state("myiPricingMetadata").redirectUrl);var b={},f=g.get("myitable").getState().clientState.viewId;f&&(-1!==f.indexOf("CONFIRMACTION_INTERSTITIAL_")?
b.viewId=f.substring(27):b.viewId=f);this.redirect=function(a){r.location.href=a};this.confirmActionSuccessCallback=function(){b.updateSuccessful=1;l.redirect(m+"?"+a.$.param(b))};this.confirmActionErrorCallback=function(){b.updateSuccessful=0;l.redirect(m+"?"+a.$.param(b))}}});p.register("bulk-fix-modal",function(){return function(a,g,l,m,b,f,h,k){var e,d=[],t=[],c=[],q=[],A=[],u={},C={},D={},p={},r=g("#bulkFixDropDownContainer"),v=g("#bulkFixTextInput"),z=g("#bulkFixModalWrapper"),B=this,y=function(a,
c){for(var n=!1,b=!1,d=0;d<a.length;d++){var e=0<g("#"+a[d]+' [data-column="defects-'+c+'"] select').length,k=0<g("#"+a[d]+' [data-column="defects-'+c+'"] input[type="text"]').length,n=n||e,b=b||k;if(n&&b)return!1}return!0},F=function(a){var c=g("#bulkFixGo"),n=c.find("input");a?(c.removeClass.bind(c)("a-button-disabled"),n.removeAttr.bind(n)("disabled","true")):(c.addClass.bind(c)("a-button-disabled"),n.attr.bind(n)("disabled","true"))},I=function(a){var c=g("#bulkFixGo"),n=g("#bulkFixCancel");a?
(c.removeClass("hidden"),n.removeClass("hidden")):(c.addClass("hidden"),n.addClass("hidden"))},J=function(a){var c=g("#bulkFixBack"),n=g("#bulkFixConfirm");a?(c.removeClass("hidden"),n.removeClass("hidden")):(c.addClass("hidden"),n.addClass("hidden"))},K=function(a){var c=[];a.find(".a-native-dropdown option").each(function(){var a=g(this),n=a.attr("value");""!==n&&c.push({text:a.text().trim(),value:n})});return c},n=function(n){A=[];c=[];u={};a.each(n,function(n){var b=n.find("span").data("myitable-inline-changed"),
d="",e="";b&&(d=b.metadata.translatedDefectName,e=b.metadata.feedsName,u[e]=d);c.push(e);b=g("#bulkFixModalAttributeName").clone().prop("id","bulkFixModalAttributeName"+e);b.text(d);b.removeClass("hidden");z.append(b);b=K(n);if(0<b.length){n=r.clone().attr("id","bulkFixDropDownContainer"+e);n.removeClass("hidden");var k=n.find("#bulkFixDropdown");k.attr("id","bulkFixDropdown"+e);e="bulkFixDropdownNativeSelect"+e;l.getSelect(n.find("#bulkFixDropdownNativeSelect").attr("id",e)).addOptions(b);b=k.find(".a-dropdown-prompt");
b.text(b.text().replace("{attribute}",d));z.append(n);A.push({element:n,isDropDown:!0});a.on("a:dropdown:"+e+":select",function(a){F(!0)})}else{var x=v.clone().prop("id","bulkFixTextInput"+e);x.removeClass("hidden");z.append(x);A.push({element:x,isDropDown:!1});x.bind("change paste keyup",function(){""!==x.val()?F(!0):F(!1)});n.find("input").hasClass("date-picker")&&x.addClass("date-picker")}});a.trigger("setup-date-pickers")},x=function(c,n){a.each(n,function(a){a.getAttribute("id")!==c?a.remove():
a.setAttribute("class","hidden")})},E=function(c,d,f){e=d;d=d.length;I(!1);J(!1);R(!1,"");B.prepareModalButtons(d,f);B.toggleModalContent(f);k||(f=g("#bulkFixModalNumberOfListings"),d=1===d?b.get("mongoose_bulkFix_affects_one_listing"):b.get("mongoose_bulkFix_affects_n_listings").replace("{number}",d),f.text(d));g("#productTitleTextArea").val(q);f=g("span [id^='bulkFixModalAttributeName']");d=g("span [id^='bulkFixDropDownContainer']");var h=g("span [id^='bulkFixTextInput']");x("bulkFixModalAttributeName",
f);x("bulkFixDropDownContainer",d);x("bulkFixTextInput",h);a.$("#bulkFixTriggerElement").click();F(!1);0<c.length&&n(c)},O=function(a){var c=g("#bulkFixModalHeader"),n=/{number}|[0-9]+/;if(0===c.length){var b=g('[data-a-modal*="bulkFixModalHeader"]').data("a-modal"),d=g("<div>"+b.header+"</div>"),c=d.find("#bulkFixModalHeader");c.text(c.text().trim().replace(n,a));b.header=d.html()}else c.text(c.text().trim().replace(n,a))},M=function(c){p={};D={};C={};var n=[];q="";a.each(c,function(b,d){var e,x,
f;if(k){e=g("#"+b).data("row-data");try{if(e&&e.defects){var l=JSON.parse(e.defects);x=l.ProductType;f=l.Asin;n=l.Issues}q+=d+1+". "+e.title;d!==c.length-1&&(q+="\n")}catch(t){h.logFatal("Parsing the row data failed with exception ",t.message)}}else(e=g("#"+b).data("delayed-row-data"))?(x=e["MYIService.ProductType"],f=e["MYIService.Asin"]):(e=g("#"+b).data("delayed-dependency-data"),x=e.MYIService.ProductType,f=e.MYIService.Asin),e=m.extractRowDataFromRecord(b),n=JSON.parse(e.defects);D[b]=x;C[b]=
f;var E={};a.each(n,function(a){a=a.attribute;p[a]!==w?E[a]||(p[a]+=1):p[a]=1;E[a]=!0})})},H=function(c){var n=[];a.each(p,function(a,b){if(a>=c.length)if(k)0>n.indexOf(b)&&y(c,b)&&n.push(b);else if(1!==n.length&&y(c,b))n.push(b);else return!1});return n},P=function(a,c){var n;a.some(function(a){n=jQuery("#"+a+' [data-column="defects-'+c+'"]');return 0<n.length});return n};B.getModalData=function(){return{inputElements:A,supportedDefectAttributesToFix:t,recordIdToProductTypeMap:D,feedsNames:c,recordIds:e,
recordIdToAsinMap:C}};B.handleBulkFix=function(c){var n=c.filter(function(a){return m.getViewModel(a.recordId)!==w}),b=f(n);k&&O(b.length);M(b);d=H(b);t=[];var e=[];a.each(d,function(a){var c=P(b,a);0<c.length&&(t.push(a),e.push(c))});0<d.length?0<e.length?E(e,c):E(e,c,".defects_bulk_action_unfixable"):E(e,c,".defects_bulk_action_error")};B.toggleModalContent=function(a){var c=g("#bulkFixErrorMessage");a?(z.addClass("hidden"),c.empty(),c.append(g(a).clone().removeClass("hidden"))):(z.removeClass("hidden"),
c.empty())};B.prepareModalButtons=function(a,c){var n=c?"#bulkFixDismiss":"#bulkFixGo,#bulkFixCancel",d=c?"#bulkFixGo,#bulkFixCancel":"#bulkFixDismiss",e;e=k?b.get("mongoose_fyi_bulk_modal_edit_button"):b.get(1===a?"mongoose_update_listing":"mongoose_update_listings").replace("{number}",a);var x=g('[data-a-modal*="bulkFixGo"]').data("a-modal"),f=g("<div>"+x.footer+"</div>");0===f.find("#bulkFixGo .a-button-text").text().length?(f.find(d).addClass("hidden"),f.find(n).removeClass("hidden"),f.find("#bulkFixGo .a-button-text").text(e),
x.footer=f.html()):(g(d).addClass("hidden"),g(n).removeClass("hidden"),g("#bulkFixGo .a-button-text").text(e))};var N=function(c,n,b){a.each(b,function(a){a.getAttribute("id")!==n&&(c?a.removeAttribute("class","hidden"):a.setAttribute("class","hidden"))})},R=function(a,c){var n=c.optionalData,b=g("#bulkFixModalConfirmActionBox .a-box-inner"),d=g("#bulkFixModalConfirmActionContainer"),e=g("#bulkFixConfirm");if(a){var k=document.createElement("ul");k.setAttribute("id","bulkFixModalChangesList");n.feedsNames.forEach(function(a,
c){a=n.feedsNames[c];var b=document.createTextNode(u[a]+": "),d=document.createElement("b"),e=document.createTextNode(n.changedValuesDisplayTexts[c]);d.appendChild(e);e=document.createElement("li");e.appendChild(b);e.appendChild(d);k.appendChild(e)});b.append(k);d.removeClass("hidden");e.attr("record_data",JSON.stringify(c));e.attr("optional_data",JSON.stringify(c.optionalData))}else b.empty(),d.addClass("hidden"),e.removeAttr("record_data"),e.removeAttr("optional_data")};B.showHideBulkFixModalConfirmAction=
function(a,c){I(!a);J(a);var n=!a,b=g('span [id^="bulkFixModalAttributeName"]'),d=g('span [id^="bulkFixDropDownContainer"]'),e=g('span [id^="bulkFixTextInput"]');N(n,"bulkFixModalAttributeName",b);N(n,"bulkFixDropDownContainer",d);N(n,"bulkFixTextInput",e);R(a,c)}}});p.when("A","tabela-manager","localstorage-util","bulk-actions-util","listing-defect-util","mongoose-client-strings").register("bulk-fix-tool",function(a,g,l,m,b,f){return function(){var h=a.$,k=this;k.TabelaBulkActionHandlerInstance=
g.get("myitable")._controllers.record.handlers["bulk-action"];k.TabelaFloatingBarHandlerInstance=g.get("myitable")._controllers.record.handlers["floating-bar"];k.localStorageUtil=new l;k.bulkActionsUtil=new m;k.bulkFixUtil=new b;var e="true"===h("#useNewFYI").attr("value"),d="true"===h("#useRosieSeven").attr("value"),t=!1;k.init=function(){var b=this;a.on("tabela:delayed-load-done",function(a){t=!0;A()});b.TabelaBulkActionHandlerInstance.setDropdownString=function(){var a=h("#myitable .mt-header-bulk-action .a-dropdown-prompt"),
e=h("#myitable-bulkfixdefects"),k=h("#mt-floating-bar .mt-header-bulk-action .a-dropdown-prompt"),q=h("#myitable-bulkfixdefects-floating"),l=b.TabelaBulkActionHandlerInstance.allowMultiPage;b.TabelaBulkActionHandlerInstance.allowMultiPage=!1;var m=b.TabelaBulkActionHandlerInstance.getNumSelectedRows();b.TabelaBulkActionHandlerInstance.setDropdownStatus();b.TabelaBulkActionHandlerInstance.allowMultiPage=l;var t,l=g.get("myitable").getState().clientState.viewId;t=/{number}|[0-9]+/;t=1===m?"DEFECT"===
l?f.get("mongoose_enhance_listings_bulk_singular"):"DRAFT"===l?f.get("mongoose_fyi_action_bulk_on_n").replace(t,m):f.get("mongoose_fix_listings_bulk_singular"):"DEFECT"===l?f.get("mongoose_enhance_listings_bulk").replace(t,m):"DRAFT"===l?f.get("mongoose_fyi_action_bulk_on_n").replace(t,m):f.get("mongoose_fixDefects_bulk").replace(t,m);a.text(t);k.text(t);e.text(t);q.text(t);h(".mt-header-bulk-action .a-button-inner").unbind("click.bulkFix");0<m?("DRAFT"===l&&d?h("#myitable-bulkfixdefects").remove():
h(".mt-header-bulk-action .a-button-inner").bind("click.bulkFix",c),h(".mt-header-bulk-action .a-button-dropdown").addClass("a-button-primary")):("DRAFT"===l&&d||h(".mt-header-bulk-action .a-button-inner").bind("click.bulkFix",function(){return!1}),h(".mt-header-bulk-action .a-button-dropdown").removeClass("a-button-primary"))};a.on("ready",function(){b.TabelaBulkActionHandlerInstance.setDropdownString();"DRAFT"===g.get("myitable").getState().clientState.viewId&&d||q()});var k=b.TabelaFloatingBarHandlerInstance.reload.bind(b.TabelaFloatingBarHandlerInstance);
b.TabelaFloatingBarHandlerInstance.reload=function(){k();h("#mt-floating-bar .mt-header-bulk-action .a-button-inner").click(c);"DRAFT"===g.get("myitable").getState().clientState.viewId&&d||q()};a.on("tabela:save-done",function(a){e||"success"!==a.status||b.bulkFixSuccessCallback(a.updatedRecords,!1)});a.on("entermissinginfo",function(a){c()})};k.bulkFixSuccessCallback=function(a,c){a&&(a.forEach(function(a){var c=Math.round(Date.now());a.updatedFields.forEach(function(b){k.localStorageUtil.setItem(a.recordId+
"-"+b.metadata.attribute,c+"-"+b.changedValue)})}),("undefined"===typeof c||c)&&k.bulkActionsUtil.confirmActionSuccessCallback())};var c=function(){var c=k.TabelaBulkActionHandlerInstance.getSelectedRows();if(e||t)a.trigger("bulkfixdefects",c);else a.on("tabela:delayed-load-done",function(b){a.trigger("bulkfixdefects",c)});return!1},q=function(){h(".mt-header-bulk-action .a-icon-dropdown").remove();var a=h(".mt-header-bulk-action .a-button-text");a.css("padding-right",a.css("padding-left"))},A=function(){h("tr.mt-row").each(function(){var a=
h(this),c=a.attr("data-delayed-row-data");c||(c=a.attr("data-delayed-dependency-data"));var c=k.bulkFixUtil.getDefectsFromRowData(c),b=a.attr("id");0!==c.length&&c.forEach(function(a){k.bulkFixUtil.grayOutDefect(a,b)})})}}});p.when("A","tabela-manager","tabela-table-myitable","bulk-actions-util","mongoose-client-strings").execute(function(a,g,l,m,b){var f=new m;a.declarative("set-business-price","click",function(a){var d=a.data;a=a.$target;if(!a.siblings("input[type='submit']").attr("disabled")){var f=
a.parents("div.myiAccordionRow");a=f.find("input.input_business_price");var f=f.find("div.businessPriceError"),c=a.val(),q=!c;"businessPriceDiscountPercent"===d.fieldToSave&&(q=!(0<c&&100>c&&-1===c.indexOf(".")));q?f.find("div.a-alert-content").html(b.get(d.errorMessageId)):(h(f),k(d.recordIds,d.fieldToSave,d.bulkActionPopover,a.val()))}});a.declarative("no-business-price-click","click",function(a){var b=a.data;h(a.$target);k(b.recordIds,b.fieldToSave,b.bulkActionPopover,"")});var h=function(a){a.parents("div.a-popover").find("button.a-button-close").click()},
k=function(b,d,k,c){var h,l;k&&(h=f.confirmActionSuccessCallback,l=f.confirmActionErrorCallback);var m=[];a.each(b,function(a,b){m.push({recordId:a,updatedFields:[{fieldId:d,changedValue:c,beforeValue:""}]})});r.saveData(m,h,l)};a.declarative("business-price-text-input","keyup",function(a){var b=a.data.defaultValue,k=a.$target;a=k.parents("div.myiAccordionRow").find("span.set_business_price");var k=k.val(),c=a.find("input[type='submit']");k&&k!==b?(a.removeClass("a-button-disabled"),c.removeAttr("disabled")):
(a.addClass("a-button-disabled"),c.attr("disabled","disabled"))});a.on("a:popover:beforeShow",function(a){if(a=a.popover.$popover){var b=a.find(".businessPriceAccordion");b&&(a.not(".a-tooltip").find("div.a-arrow-border").css("display","none"),b.find("input[id$='fixed_input_business_price']").val(b.find("input.fixedBusinessPriceHiddenInput").val()),b.find("input[id$='percent_input_business_price']").val(b.find("input.percentBusinessPriceHiddenInput").val()),b.find("div.a-alert-content").html(""),
a=b.find("span[id$='set_business_price']"),a.addClass("a-button-disabled"),a.find("input[type='submit']").attr("disabled","disabled"))}})});p.when("A","initialize-globalize").register("currency-translator",function(a,g){return function(){var a=this;a.globalize=g;var m=/[\x20]/g;this.formatCurrency=function(b){return a.globalize.currencyFormatter(b).replace(/[^\d.,\s-]/g,"").trim()};this.parseCurrency=function(b){return b&&+a.globalize.instance.numberParser()(b.toString().replace(m," ")).toFixed(g.currencyPrecision)};
this.validateInteger=function(a){var f=!1;a&&(a=g.instance.numberParser()(a.toString().replace(m," ")),f=!isNaN(a)&&0===a%1);return f};this.parseNumber=function(b){return b&&a.globalize.instance.numberParser()(b.toString().replace(m," "))}}});p.when("A","date-util","metrics-reporter","Class").register("date-filter-handler",function(a,g,l){return function(){var m=a.$,b=this;b.dateUtil=new g;b.metricsReporter=new l;var f=["#DATE_RANGE_START_VAR","#DATE_RANGE_END_VAR"],h=["#DATE_RANGE_START_VAR-floating",
"#DATE_RANGE_END_VAR-floating"],k=function(a){a=m("#"+a+"_SECTION").find("[data-action='myitable-datefilter-changed']").attr("data-myitable-datefilter-changed");var d;a:{try{if(a){d=JSON.parse(a);break a}}catch(e){b.metricsReporter.logFatal("An error occurred while parsing the column data for defects",e.message)}d={}}return d},e=function(a){var d=k("DATE_RANGE_START");b.dateUtil.createDatePicker(a,d)},d=function(a){var b=a.$target.attr("id");-1!==b.indexOf("floating")?m("#"+b.substring(0,b.indexOf("-floating"))).val(a.$target.val()):
m("#"+b+"-floating").val(a.$target.val())},t=function(){a.declarative("myitable-calendarIcon-clicked","click",function(a){a=a.$target.parents(".mt-filter-datepicker").find("input");b.dateUtil.showDatepicker(a)});a.declarative("myitable-datefilter-changed","change",function(a){d(a);b.dateUtil.isDateValid(m("#"+a.data.filterGroupId+"_VAR"))?(m("#"+a.data.filterGroupId+"_VAR_SUBMIT").change(),m("#"+a.data.filterGroupId+"_VAR").removeClass("a-form-error")):m("#"+a.data.filterGroupId+"_VAR").addClass("a-form-error")});
a.declarative("myitable-datefilter-changed","keypress keyup keydown",function(a){d(a)});a.on("tabela:table-refresh-done",function(){e(f)});a.on("floating-bar-reloaded",function(){e(h)})};this.initializeFilterDatePicker=function(){e(f.concat(h));t()};this.getFilterDateinISOFormat=function(a){var d=k(a);a=m("#"+a+"_VAR");return b.dateUtil.getDateinISOFormat(a,d.timeZone).replace(".","+").replace("Z","0")}}});p.when("A","JSON","jQuery","tabela-table-myitable","OlympusDebugConsole").execute(function(a,
g,l,m,b){a.on("tabela:ajax-request-done",function(a){if(a.responseParser&&a.responseParser.has("myiDebugData")){a=l(a.responseParser.get("myiDebugData"));var h=a.find("#requestData"),k=a.find("#ajaxType").html();h.find(".debug-request").each(function(){try{var a=g.parse(l(this).html());a.type=k;b.addRequest(a)}catch(d){}})}})});p.when("A","tabela-manager","JSON","tabela-table-myitable","mongoose-client-strings").execute(function(a,g,l,m,b){var f=a.$;m=g.get("myitable");a.declarative("myitable-inline-changed",
"keyup",function(a){h(a.data)});a.declarative("myitable-inline-changed","change",function(a){h(a.data)});var h=function(a){if("price"===a.col){var b=a.row,d=m.getViewModel(b,"price");a=a.original;var d=d.$element,h=d.find(".mt-input-text").val(),c;c=0===d.find("#"+b+"-price-noneditablepoints").find(".mt-text-content").length?!1:!0;c&&(0===f("#"+b+"-price").find(".cloned_warning").length&&a!==h?(b=f(".downgrade_warning").clone().removeClass("downgrade_warning").addClass("cloned_warning"),f(d).append(b),
f(d).find(".cloned_warning").removeClass("hidden")):a===h&&f(d).find(".cloned_warning").remove())}}});p.when("A","tabela-manager","JSON","tabela-table-myitable","mongoose-client-strings","a-dropdown").register("dynamic-actions-util",function(a,g,l,m,b,f){var h=a.$;return function(){var b=this,e=[],d=[],l=[],c=[];f.getSelect(h(".floatingHeaderBar [data-action=myitable-bulk-action-select-changed] .a-native-dropdown"));var q=f.getSelect(h(".mt-header:not(.floatingHeaderBar) [data-action=myitable-bulk-action-select-changed] .a-native-dropdown")),
m=!0,u={};a.declarative("myitable-row-select-changed","change",function(a){var c=a.data.row;a.$target.is(":checked")?l.push(c):(a=l.indexOf(c),l.splice(a,1));C()});a.declarative("myitable-row-select-all-changed","change",function(c){l=[];c.$target.is(":checked")&&(a.each(h(".mt-row"),function(a){l.push(a.id)}),C())});a.on("tabela:fetch-rows-done",function(a){b.removeRowOptions()});a.on("tabela:ajax-request-done",function(a){b.removeRowOptions();a&&a.responseParser&&"TABLE"===a.responseParser.refreshMode&&
!m&&(b.removeBulkOptions(),m=!0)});a.on("tabela:delayed-load-done",function(d){l=[];c=[];a.each(h("#myitable .mt-table-container input:checked"),function(a){l.push(a.value)});0<l.length&&C();b.showRowOptions()});var C=function(){var a=p(l),d=c.filter(function(c){return-1===a.indexOf(c)});c=a;0<c.length?(0<d.length&&b.removeBulkOptions(d),b.showBulkOptions(c),m=!1):m||(b.removeBulkOptions(),m=!0)},p=function(c){if(1===c.length)return r(c[0]);var b=[],d={};a.each(c,function(a){r(a).forEach(function(a){d[a]=
"undefined"===typeof d[a]?1:d[a]+1})});h.each(d,function(a,d){d===c.length&&b.push(a)});return b},r=function(a){return v().filter(function(c){return w(c,a)})},w=function(a,c){if(a&&c){var b=h("#dynamicActions").data("content")[a];if(b){var n=b.split(",")[1],b=b.split(",")[0],d=h("#"+c);if(d.length&&b)return n?d.data("row-data")[b]===n:"undefined"!==typeof d.data("row-data")[b]}}return!1},v=function(){var a=h("#dynamicActions").data("content"),c=[];h.each(a,function(a){c.push(a)});return c},z=function(c){var b=
[];if(c){c=c.getOptions().options.elements;var d=v();a.each(c,function(a){var c=a.attr("id").split("-")[1];c&&0<=d.indexOf(c)&&b.push(a)})}return b},B=function(c,b){a.each(b,function(a){var b=a.attr("id");c.addOption({text:a.text(),value:a.attr("value"),native_id:b});F(a,b)})};this.removeBulkOptions=function(a){var c=f.getSelect(h(".floatingHeaderBar [data-action=myitable-bulk-action-select-changed] .a-native-dropdown"));0===d.length&&(e=z(c),d=z(q));var b=z(c),n=z(q);a?(c.removeOptions(y(b,a)),q.removeOptions(y(n,
a))):(c&&c.removeOptions(b),q&&q.removeOptions(n))};this.removeRowOptions=function(){a.each(h("[data-column=action] .a-native-splitdropdown:not(.predisabled)"),function(a){var c=f.getSelect(a),b=z(c),n=h(a).closest("[data-column=action]").data("row");u[n]=b;c.removeOptions(b);h(a).addClass("predisabled")})};this.showBulkOptions=function(a){var c=f.getSelect(h(".floatingHeaderBar [data-action=myitable-bulk-action-select-changed] .a-native-dropdown")),b=[],n=[];a&&(b=y(e,a),n=y(d,a));c&&B(c,b);q&&B(q,
n)};this.showRowOptions=function(){a.each(h("[data-column=action] .a-native-splitdropdown:not(.reenabled)"),function(c){var b=h(c).closest("[data-column=action]").data("row");if(h("#"+b).data("row-data")){c=f.getSelect(c);var d=[];a.each(u[b],function(a){var c=a.attr("id").split("-")[1];w(c,b)&&d.push(a)});0<d.length&&B(c,d);h(c).addClass("reenabled")}})};this.uncheckAllCheckBoxes=function(){a.$("input:checkbox").attr("checked",!1);l=[];C();var c=g.get("myitable")._controllers.record.handlers["bulk-action"];
c.setDropdownString();c.setDropdownStatus()};var y=function(a,c){return a.filter(function(a){return(a=a.attr("id").split("-")[1])&&-1!==c.indexOf(a)})},F=function(a,c){"view-context record-refresh record action-type action-target action-string".split(" ").forEach(function(b){h("#"+c).attr("data-"+b,a.attr("data-"+b))})}}});p.when("A","tabela-table-myitable","a-dropdown","a-popover","date-filter-handler").execute(function(a,g,l,m,b,f,h,k){function e(c){if(null!==c){var b=c.val();c.setValue("");a.$("#"+
b+"_SECTION").toggleClass("myi-filter-group-hidden",!1);a.$("#"+b+"_SECTION-floating").toggleClass("myi-filter-group-hidden",!1)}}a.$("#myitable").find(".mt-header-filter-button .a-button-text").click();var d=a.$,t=new b;t.initializeFilterDatePicker();a.on("a:dropdown:additionalFilterId:select",function(a){e(l.getSelect("additionalFilterId"))});a.on("a:dropdown:additionalFilterId-floating:select",function(a){e(l.getSelect("additionalFilterId-floating"))});a.declarative("filter-clear-clicked","click",
function(c){"undefined"!==typeof c.data.buttonAction&&(a.$("#"+c.data.filterGroupId+"_SECTION").toggleClass("myi-filter-group-hidden",!0),a.$("#"+c.data.filterGroupId+"_SECTION-floating").toggleClass("myi-filter-group-hidden",!0),""!==d("#"+c.data.filterGroupId+"_VAR").val()&&(d("#"+c.data.filterGroupId+"_VAR").removeAttr("value"),d("#"+c.data.filterGroupId+"_VAR").change(),d("#"+c.data.filterGroupId+"_VAR").removeClass("a-form-error")))});a.declarative("myitable-filter-changed","change",function(a){"undefined"!==
typeof a.data.buttonAction&&"radio"!==a.$target.attr("type")&&(a.data.filterId=t.getFilterDateinISOFormat(a.data.filterGroupId))})});p.when("A","globalize","cldr-data-bower:supplemental:likely-subtags","cldr-data-bower:supplemental:numbering-systems","cldr-data-bower:supplemental:currency-data","cldr-data-bower:main:numbers","cldr-data-bower:main:currencies","ready").register("initialize-globalize",function(a,g,l,m,b,f,h){var k=a.state("globalize-config"),e="en";a="USD";g.load(f,h,m,
l,b);k&&k.locale&&k.currencyCode&&(e=k.locale,a=k.currencyCode);g=g(e);l=g.currencyFormatter(a);m=0;b=l(0).toString().replace(/[^\d.,]/g,"").split(/[,.]/);1<b.length&&(m=b[1].length);return{instance:g,currencyFormatter:l,currencyPrecision:m}});p.when("A","localstorage-util","a-dropdown","multi-valued-attribute-handler").register("listing-defect-util",function(a,g,l,m){var b=a.$;return function(){var a=new g,h=new m;this.grayOutDefect=function(c,k){var h=c.attribute,m=a.getItem(k+"-"+h),g;g=k+"-defects-defects-"+
h;g=b("#"+k).find('[id*="'+g+'"]');var p;p=(p=g.find("span").data("myitable-inline-changed"))?p.metadata.translatedDefectName:"";if(m){var m=m.split("-"),r=m[0],w;if(w=2===m.length)w=9E5<(new Date).getTime()-r?!1:!0;w?(h=0===g.length||1<g.length?"":1===g.find("select").length?"dropdown":1===g.find("input").length?"input":2===g.find("textarea").length?"textarea":"unsupported",e(g,h,m[1],p),d(k,g,!0),l(!0)):(a.removeItem(k+"-"+h),d(k,g,!1),l(!1))}};this.getDefectsFromRowData=function(a){try{var b=JSON.parse(a);
return b["MYIService.Defects"]?JSON.parse(b["MYIService.Defects"]):JSON.parse(k(b.MYIService.Defects))}catch(d){return console.error("An error occurred while parsing the row data for defects:"+d),[]}};var k=function(a){var b=document.createElement("div");b.innerHTML=a;return b.innerHTML},e=function(a,d,e,k){switch(d){case "dropdown":a.find(".a-dropdown-prompt").text(a.find('option[value="'+e+'"]').text().trim());a.find("#mt-dropdown-label")[0].innerHTML=k;break;case "input":a.find("input").val(e);
a.find("#mt-text-label")[0].innerHTML=k;break;case "textarea":a.find("textarea").each(function(){b(this).val(e);b(this).is(":visible")&&h.addBulletPointsToEachRow(b(this))}),a.find("#mt-text-label")[0].innerHTML=k}},d=function(a,d,e){var k=b("#"+a);e?(a=k.find("#"+a+"-defects").find(".mt-message-text"),e=d.find(".paddedAlert"),a=0<a.length||0<e.length,1!==d.length||a||(a=b("#updateSubmitted").val(),e=b("#propagation-delay-message").clone().removeAttr("id"),e.removeClass("propagationAlert").removeClass("hidden").addClass("paddedAlert"),
b(".a-alert-content",e).text(a),e.appendTo(d),d.append('<hr class="a-spacing-small a-spacing-top-micro a-divider-normal">'))):(a=d.find(".paddedAlert"),1===a.length&&(a.remove(),d.find(".a-divider-normal").remove()))},l=function(a){var d=b("#propagation-delay-message");b(".alert-banner").is(":visible")||!a&&!d.hasClass("hidden")?d.addClass("hidden"):a&&d.hasClass("hidden")&&d.removeClass("hidden");a?(a=b("#floating-propagation-delay-message"),0<a.length?a.removeClass("hidden"):(a=b("#propagation-delay-message").clone().attr("id",
"floating-propagation-delay-message"),a.appendTo(".floatingHeaderBar"))):(a=b("#floating-propagation-delay-message"),0<a.length&&a.addClass("hidden"))}}});p.when("A","dynamic-actions-util","metrics-reporter","myi-product-tour","myi-preferences","myi-popover-util","madagascar-tax-filter","vat-exclusive-price-popover").execute(function(a,g,l,m,b,f,h,k){new f;new h;var e=new g;new k;var d=new l,t=new m;a.on("ready",function(){e.removeBulkOptions();e.removeRowOptions();try{t.initializeTour(),t.handleTourPopoverDisplay()}catch(a){d.logFatal("PageLoadException",
{logLevel:"ERROR",message:"Error happened while initializing tour on page load : "+a})}});a.on("tabela:table-refresh-done",function(){try{t.initializeTour()}catch(a){d.logFatal("TableRefreshException",{logLevel:"ERROR",message:"Error happened while initializing tour on teble refresh : "+a})}});["fetch-rows","delayed-load","table-refresh"].forEach(function(c){a.on("tabela:"+c+"-done:myitable",function(a){a.status&&"error"===a.status&&0!==a.readyState&&0!==a.jqXHRStatus&&d.logFatal("TabelaException",
{logLevel:"ERROR",attribution:c})})});r.onbeforeunload=e.uncheckAllCheckBoxes()});p.when("A","JSON").register("MadagascarAjax",function(a,g){return function(l,m){var b=this;this.myiTable=l;this.metricsReporter=m;this.successCallbackWrapper=function(a,h,k,e){e=b.myiTable.getResponseParser(e);e.isSuccessful()?h?h(a):b.myiTable.refreshDataFromResponse(e):k?k():b.myiTable.showError(e.getMessage(),-1)};this.errorCallbackWrapper=function(a,h,k,e){a&&a();b.myiTable.showError(w,-1);b.metricsReporter.logFatal("AjaxException",
{logLevel:"ERROR",attribution:h,message:h+" threw an error with status code "+e})};this.completeCallback=function(f,h,k){b.myiTable.hideLoading();var e={container:"myitable",status:k};h=h.responseText;if("success"===k||"error"===k)k=b.myiTable.getResponseParser(h),e.responseParser=k;a.trigger("tabela:ajax-request-done",e);f&&f()};this.generateSuccessCallbackWrapper=function(f){b.myiTable.hideLoading();f=g.parse(f);f="/inventory/download?docId="+f.docId+"&templateName="+f.templateName;a.$("<iframe>").hide().prop("src",
f).appendTo("body")};this.makeAjaxCall=function(f,h,k,e,d,l){b.myiTable.showLoading();var c=k.updatedRecords;a.$.ajax({type:f,url:h,contentType:"application/json",dataType:"html",data:g.stringify(k),success:b.successCallbackWrapper.bind(this,c,e,d),error:b.errorCallbackWrapper.bind(this,d,h),complete:b.completeCallback.bind(this,l)})};this.makeGenerateSkuCall=function(f,h,k){b.myiTable.showLoading();a.$.ajax({type:f,url:h,success:b.generateSuccessCallbackWrapper.bind(this),error:b.errorCallbackWrapper.bind(this,
k,h)})}}});p.when("A","tabela-manager").register("mlp-metrics-util",function(a,g){var l=a.$;return function(){var a=g.get("myitable");this.extractRowDataFromRecord=function(b){return a.getViewModel(b).getRowData()};this.getMerchantId=function(){var a,f=l.find("#merchantId");f&&0!==f.length&&f[0].value&&(a=f[0].value);return a};this.isMlpFlagSet=function(b){b=a.getViewModel(b,"lowPrice").$element.children("#"+b+"-lowPrice-mlpUsed");return 0!==b.length&&!0===b[0].value?!0:!1};this.getNumericValueFromCurrency=
function(a,f){if(!a||!f)return"";var h="\\"+f;a=a.replace(new RegExp("[^\\d"+h+"]","g"),"");h=a.replace(new RegExp(h,"g"),".");return parseFloat(h)};this.getNumericValueFromPointsString=function(a){var f;a&&a.match&&(a=a.match(/\d+/))&&0!==a.length&&(f=a[0]);return f};this.getLowPriceDataByRowId=function(a){if((a=g.get("myitable").getViewModel(a,"lowPrice"))&&a.hasSubFields()&&(a=a.subFields["lowPrice-match-link"])&&a.$declarative)return a.$declarative.attr("data-match-low-price")};this.setMlpFlag=
function(b){var f=a.getViewModel(b,"lowPrice");if(f.$element&&f.$element.children){var f=f.$element,h=f.children("#"+b+"-lowPrice-mlpUsed");h&&0!==h.length?l(h[0]).attr("value",!0):l("<div>").attr({id:b+"-lowPrice-mlpUsed",value:!0}).appendTo(f)}};this.getNewPoints=function(b){var f,h=a.getViewModel(b,"points");h&&h.$element&&h.$element.find&&(b=a.getViewModel(b,"points").$element.find("[data-column='points'] [class='mt-popover']"))&&b.text&&(f=b.text());return this.getNumericValueFromPointsString(f)};
this.logMlpUsageForRecord=function(a,f,h,k,e){var d=this.extractRowDataFromRecord(k),l=d.decimalSeperator,c={};c.tool=a;c.viewId=f;c.merchantId=h;c.asin=d.asin;c.sku=d.escapedSku;var m,g,u,p;if(a=this.getLowPriceDataByRowId(k))m=JSON.parse(a).lowPrice,g=JSON.parse(a).lowShipping,u=JSON.parse(a).lowPoints,p=JSON.parse(a).ourShipping;c.oldItemPrice=this.getNumericValueFromCurrency(d.price,l);c.newItemPrice=this.getNumericValueFromCurrency(e,l);c.lowItemPrice=this.getNumericValueFromCurrency(m,l);c.oldShippingPrice=
this.getNumericValueFromCurrency(p,l);c.newShippingPrice=c.oldShippingPrice;c.lowShippingPrice=this.getNumericValueFromCurrency(g,l);c.oldPoints=parseInt(d.points,10);c.newPoints=parseInt(this.getNewPoints(k),10);c.lowPoints=parseInt(u,10);r.ue&&r.ue.log&&r.ue.log(c,"myi-metrics",{})}}});p.when("A","ready").register("metrics-reporter",function(a){return function(){this.logFatal=function(a,l){if(r.ueLogError)try{r.ueLogError(a||"UnknownException",l||"No message was logged for this exception")}catch(m){console.log("Could not log fatal:"+
m)}};this.incrementCount=function(a,l,m){var b="MYI."+a;m&&(b="MYI."+m+"."+a);(a=r.ue)&&a.count&&a.count(b,(a.count(b)||0)+l)}}});p.when("A").register("multi-valued-attribute-handler",function(a){var g=a.$,l=/•/g,m=function(a){""===a.val()&&(a.val("• "),a.is(":focus")&&a.focus().setCursorPosition(a.val().length))},b=function(a){a.height("auto");a.height(Math.min(a.prop("scrollHeight"),300)+"px")},f=function(a){var b=!1;a.forEach(function(d,f){0!==d.indexOf("•")&&(a[f]="• "+d.trim(),b=!0)});return b?
a.join("\n"):""},h=function(a,b,d){var f=!1,c=!1,h=[],m=a.length,g={value:""};m>b&&(a.splice(b,m-b),f=!0);a.forEach(function(b,e){0!==b.indexOf("•")&&(""===b?h.push(e):a[e]="• "+b.replace(l,"").trim(),f=!0);var m=a[e];if(0<d){var g=m.replace(l,"").trim();g.length>d&&(a[e]=m.substring(0,d+(m.length-g.length)),f=c=!0)}});f&&(h.forEach(function(c){a.splice(c,1)}),g.value=a.join("\n"));g.isMaxCharacterReached=c;return g};a.declarative("myitable-textarea-inline-changed","keypress keyup keydown",function(a){var e=
a.$target,d=e.val(),f=d.split("\n"),c=parseInt(a.data.metadata.maximumOccurrence,10),g=parseInt(a.data.metadata.maxCharacterLength,10),A=e.prop("selectionStart"),u=a.$event.keyCode?a.$event.keyCode:a.$event.which;switch(u){case 38:case 40:case 37:case 39:case 9:return!1;case 13:return a.$event.preventDefault(),!1;case 46:case 8:"\n"===d.charAt(8===u?A-1:A)&&"keypress"!==a.type&&a.$event.preventDefault();break;default:d=d.charAt(A-1),0!==A&&"\n"!==d||a.$event.preventDefault()}u=h(f,c,g);""!==u.value&&
(g=A,d=u.value,e.val(d),u.isMaxCharacterReached&&"\n"===d.charAt(A-1)&&(g=A-1),f=d.split("\n"),e.focus().setCursorPosition(g));A=f.length;0<A&&(d=f,f=e.val(),d=d[A-1],d=-1!==d.indexOf("•")?""===d.replace(l,"").trim():!1,""!==f&&A<c&&!d&&(c=e.prop("selectionStart"),e.val(f+"\n• "),e.focus().setCursorPosition(c)));b(e);m(a.$target);a=a.data.col;c=e.val().replace(l,"").trim();e.closest("[data-column='"+a+"']").find("#"+a+"_SUBMIT").val(c).change()});a.declarative("myitable-textarea-inline-changed","click",
function(a){m(a.$target)});a.declarative("myitable-textarea-inline-changed","change mouseleave",function(a){a=a.$target;""===a.val().replace(l,"").trim()&&a.val("")});(function(){g.fn.selectRange=function(a,b){return this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(a,b);else if(this.createTextRange){var d=this.createTextRange();d.collapse(!0);d.moveEnd("character",b);d.moveStart("character",a);d.select()}})};g.fn.setCursorPosition=function(a){return this.selectRange(a,
a)}})();return function(){this.addBulletPointsToEachRow=function(a){var e=a.val().split("\n"),e=f(e);""!==e&&a.val(e);b(a)}}});p.when("A","tabela-manager").register("myi-popover-util",function(a,g){return function(){var l=a.$;this.onWindowScroll=function(){var a=l("#mt-floating-bar");if(a&&a.offset()&&a.is(":visible")){var a=a.offset().top+a.outerHeight(),b=l(".closeOnFloatingBarOverlap").parents(".a-popover").filter(":visible");b&&b.offset()&&b.offset().top<a&&l("body").click()}};l(r).scroll(this.onWindowScroll)}});
p.when("A").register("myi-preferences",function(a){var g=a.$;return new function(){this.onPreferencesChange=function(){var a=g("#saveAction");a&&a.hasClass("a-button-disabled")&&(a.removeClass("a-button-disabled"),a=a.find("input"),1===a.size()&&a[0].removeAttribute("disabled"))};g("#preferencesForm").change(this.onPreferencesChange)}});p.when("A").register("placeholder-util",function(a){this.handler=function(g){var l=a.$;l('[data-column="defects"] [placeholder]').bind("focus",function(){var a=l(this);
a.val()===a.attr("placeholder")&&(a.val(""),a.removeClass("placeholder"))}).bind("blur",function(){var a=l(this);if(""===a.val()||a.val()===a.attr("placeholder"))a.addClass("placeholder"),a.val(a.attr("placeholder"))}).blur()};a.on("tabela:delayed-load-done",this.handler)});p.when("A","tabela-manager","tabela-table-myitable","bulk-actions-util","mongoose-client-strings").execute(function(a,g,l,m,b){var f=new m,h=a.$;l=g.get("myitable");var k=[];a.declarative("set-points-button-declarative-id-percent-bulk",
"click",function(a){var c=a.data;a=a.$target;if(!d(a)){var b=a.parents("div.myiAccordionRow"),e=b.find("input.input_points").val();q(e,c.recordIds)?(y(c.recordIds,c.fieldToSave,c.bulkActionPopover,e),B(a)):v(b.find("div.mongoose_points_error"),c.errorMessageId)}});a.declarative("set-points-button-declarative-id-percent","click",function(a){var b=a.data;a=a.$target;if(!d(a)){var f=a.parents("div.myiAccordionRow"),k=f.find("input.input_points").val(),l=e(b.recordIds[0]);c(k,b.pointsConversionRatio,
l,b.decimal_separator)?(f.find("input.mt-input-text").change(),l=u(k,l,b.decimal_separator),b=b.recordIds[0],I(b,l,k),f.find("input.isPercentageConfirmed").val("true"),K(b,h("#"+b+"-points")),B(a)):v(f.find("div.mongoose_points_error"),b.errorMessageId)}});var e=function(a){if(a=l.getViewModel(a,"price"))return a.$element.find(".mt-input-text").val()},d=function(a){return"disabled"===a.siblings("input[type='submit']").attr("disabled")},t=function(a){a=parseFloat(a);return!isNaN(a)&&0<a},c=function(a,
c,b,d){var e=t(a);a=u(a,b,d);b=p(b);return e&&a*c<b&&0<a};a.declarative("points-text-input-declarative-id-percent","keyup",function(a){var d=b.get("mongoose_points"),f=a.$target,h=f.parents("div.myiAccordionRow"),k=h.find("span.set_points"),l=h.find("span.pointsInNumber"),g=a.data,m=e(g.recordId);h.find("span.currentItemPrice").html(m);var q=f.val();c(q,g.pointsConversionRatio,m,h.find("input.decimalSeparator").val())?(g=u(q,m),l.empty().append(g+" "+d),h.find("input.mt-input-text").val(g+"-"+m),
z(h.find("div.mongoose_points_error")),w(k,f.val(),a.data.defaultValue,f)):(l.empty().append("0 "+d),D(k),v(h.find("div.mongoose_points_error"),g.errorMessageId))});a.declarative("points-text-input-declarative-id-percent-bulk","keyup",function(a){var c=b.get("mongoose_points"),d=a.data,e=a.$target,f=e.parents("div.myiAccordionRow"),h=f.find("span.set_points"),k=f.find("span.pointsInNumber"),l=e.val();q(l,d.recordIds)?(k.empty().append(A(d.recordIds,l)+" "+c),z(f.find("div.mongoose_points_error")),
w(h,e.val(),a.data.defaultValue,e)):(k.empty().append("0 "+c),D(h),v(f.find("div.mongoose_points_error"),d.errorMessageId))});var q=function(b,d){var e=t(b);a.each(d,function(a,d){var f=l.getViewModel(a).getRowData();e=e&&c(b,f.pointsConversionRatio,f.price,f.decimalSeparator)});return e},A=function(c,b){var d,e;a.each(c,function(a,c){var n=F(a,b).points;if(n>d||"undefined"===typeof d)d=n;if(n<e||"undefined"===typeof e)e=n});return d===e?d:e+"-"+d},u=function(a,c,b){c=p(c);return Math.round(a*c/100)},
p=function(a,c){a=a.replace(/decimalSeparator/g,".");return a.replace(/[^\d.-]/g,"")},D=function(a){var c=a.find("input[type='submit']");a.addClass("a-button-disabled");c.attr("disabled","disabled")},w=function(a,c,b,d){var e=a.find("input[type='submit']");c&&c!==b?(a.removeClass("a-button-disabled"),e.removeAttr("disabled"),G(e,d)):(a.addClass("a-button-disabled"),e.attr("disabled","disabled"))},G=function(a,c){c.keypress(function(c){13===c.keyCode&&a.click()})},v=function(a,c){a.find("div.a-alert-content").html(b.get(c))},
z=function(a){a.find("div.a-alert-content").html("")},B=function(a){a.parents("div.a-popover").find("button.a-button-close").click()},y=function(c,b,d,e){var h,k,l;l=-1!==g.get("myitable").getState().clientState.viewId.indexOf("CONFIRMACTION_INTERSTITIAL_")?"/inventory/confirmActionSave":"/inventory/save";d&&(h=f.confirmActionSuccessCallback,k=f.confirmActionErrorCallback);var m=[];a.each(c,function(a,c){var d=F(a,e);m.push({recordId:a,updatedFields:[{fieldId:b,changedValue:d.points,beforeValue:""},
{fieldId:"price",changedValue:d.price,beforeValue:""}]})});r.saveData(m,l,h,k)},F=function(a,c){var b=l.getViewModel(a).getRowData(),d=b.price;return{points:u(c,d,b.decimalSeparator),price:d}};a.declarative("no-points-click","click",function(a){var c=a.data;B(a.$target);if(c.bulkActionPopover)y(c.recordIds,c.fieldToSave,c.bulkActionPopover,"0");else{c=c.recordIds[0];a=a.$target.parents("div#"+c+"_points_accordion");var b=a.find("input.input_points");b.val("0");var d=e(c),f=a.find("input.mt-input-text");
f.val("0-"+d);f.change();a.find("input.isPercentageConfirmed").val("true");I(c,0,0);b.keyup()}});var I=function(a,c,d){d=parseFloat(d);l.getViewModel(a,"points").$element.find("span.mt-text-content").html(c+" "+b.get("mongoose_points_units")+" ("+d.toFixed(2)+"%)")};a.on("a:popover:afterShow",function(a){if(a=a.popover.$popover)if(a=a.find('[id$="points_accordion"]')){var c=a.find('div[class*="accordion-active"]').find("input.input_points");setTimeout(function(){c.focus()},100)}});a.declarative("myitable-inline-changed",
"keyup",function(a){a=a.data;"price"===a.col&&J(a)});a.declarative("myitable-inline-changed","change",function(a){a=a.data;"price"===a.col&&(J(a),a=a.row,a=l.getViewModel(a,"lowPrice").$element.children("#"+a+"-lowPrice-mlpUsed"),0!==a.length&&h(a[0]).attr("value",!1))});var J=function(a){var c=a.row,d=l.getViewModel(c,"points");if(d){var e=l.getViewModel(c).getRowData(),f=e.points,g=a.original,d=d.$element;a=h(h.find("#"+c+"_points_accordion"));var m=a.find("input.isMLP").val(),q="true"===a.find("input.isPercentageConfirmed").val();
"true"===m||"0"===f&&!q||(q?(f=a.find("input.input_points").val(),f=parseFloat(f).toFixed(2)):(g=p(g,void 0),f=(f/g*100).toFixed(2)),g=l.getViewModel(c,"price").$element,g.change(),e=p(g.find(".mt-input-text").val(),e.decimalSeparator),g=Math.round(f*e/100),m=a.find("input.input_points"),m.val(f),a=a.find("input.mt-input-text"),a.val(g),d.find("span.mt-text-content").html(g+" "+b.get("mongoose_points_units")+" ("+f+"%)"),m.keyup(),a.change(),0===h("#"+c+"-points").find(".cloned_error").length&&g>=
e?(a=h(".points_price_error").clone().removeClass("points_price_error").addClass("cloned_error"),h(d).append(a),h(d).find(".cloned_error").removeClass("hidden"),h("#"+c+"-action").find(".mt-save-button-dropdown-save").addClass("a-button-disabled"),k.push(c),h(".mt-button-saveall").find(".a-button-inner").addClass("a-button-disabled")):g<e&&K(c,d))}},K=function(a,c){h(c).find(".cloned_error").remove();h("#"+a+"-action").find(".mt-save-button-dropdown-save").removeClass("a-button-disabled");var b=h.inArray(a,
k);-1!==b&&k.splice(b,1);0===k.length&&h(".mt-button-saveall").find(".a-button-inner").removeClass("a-button-disabled")}});p.when("A","Class").register("points-util",function(a){var g=a.$;return function(){this.getCurrentNetPrice=function(a,m){var b=a.getViewModel(m).getRowData(),f=b.decimalSeperator,h=b.pointsConversionRatio,k=this.isPointsEnabled(b),e=a.getViewModel(m,"price"),d=0;-1!==a.getState().clientState.viewId.indexOf("CONFIRMACTION_INTERSTITIAL")?(e=this.getNumberValueFromCurrency(b.price,
f),k&&(d=h*this.getNumberValueFromCurrency(b.points,f))):(e=e.$element.find("input.a-input-text.main-entry").val(),e=this.getNumberValueFromCurrency(e,f),k&&(k=g("#"+m+"_points_accordion").children("div.myiAccordionRow").find("input.input_points").val(),b=k!==w?this.getPoints(k,e,f):this.getNumberValueFromCurrency(b.points,f),d=h*b));return e-d};this.isPointsEnabled=function(a){var g=a.points;return g!==w&&0<this.getNumberValueFromCurrency(g,a.decimalSeperator)};this.getPoints=function(a,g,b){g=this.getNumberValueFromCurrency(g,
b);return Math.round(a*g/100)};this.getNumberValueFromCurrency=function(a,g){var b="\\"+g;a=a.replace(new RegExp("[^\\d"+g+"\\-]","g"),"");return a.replace(new RegExp(b,"g"),".")}}});p.when("A","JSON").register("popover-ajax-handler",function(a,g){return function(l){var m=this;this.metricsReporter=l;this.popoverSuccessCallbackWrapper=function(a,f,h,k){k?f(a,k):h(a)};this.popoverErrorCallbackWrapper=function(a,f,h,k,e){h(a);m.metricsReporter.logFatal("AjaxException",{logLevel:"ERROR",attribution:f,
message:f+" threw an error with status code "+e})};this.makePopoverAjaxCall=function(b,f,h,k,e,d){a.$.ajax({type:b,url:f,contentType:"application/json",dataType:"html",data:g.stringify(h),success:m.popoverSuccessCallbackWrapper.bind(this,k,e,d),error:m.popoverErrorCallbackWrapper.bind(this,k,f,d)})}}});p.when("A","tabela-manager","mongoose-client-strings","metrics-reporter","localstorage-util","3p-bs-tour").register("myi-product-tour",function(a,g,l,m,b){var f=a.$;return function(){var h=new m,k=
new b,e=this,d=new f.Tour({backdrop:!0,storage:!1,debug:!1,stepStringPre:"",stepStringMid:" / ",template:f("#tourPopoverTemplate").html()}),l=function(){var c=[],b=a.$('input[name="myiTourDataObject"]').data("tour");b&&(b=b.tourSteps)&&a.each(b,function(b,d){if(b&&b.elements){var e=!0;a.each(b.elements,function(d){d=a.$(d);if(!d||0===d.length||d.is(":hidden")){e=!1;d="";var f={};b.fallbackStepContentInfo&&(d=b.fallbackStepContentInfo);b.fallbackStepContentImageUrl&&(d+='<img class="tourStepFallbackImage" src="'+
b.fallbackStepContentImageUrl+'" />');d&&(f.content=d,f.orphan=!0,f.title=b.title,c.push(f))}});e&&c.push(b)}});return c};this.initializeTour=function(){var a=l();d&&d._options&&a&&0<a.length?(d._options.steps=a,f("#tourTrigger").removeClass("disabledTourLink"),d.init()):f("#tourTrigger").addClass("disabledTourLink")};this.getTour=function(){return d};this.handleTourPopoverDisplay=function(){var c=f("#tourTrigger");if(c&&0<c.length&&!c.hasClass("disabledTourLink")){var c=f("span#tourTriggerNewTag"),
b=k.getItem("tourPopoverDisplayedCount");if(!b||isNaN(b))b=0;5>b?(k.setItem("tourPopoverDisplayedCount",Number(b)+1),c.show()):c.hide();a.delay(function(){f("body").click()},5E3)}};this.doTourAction=function(a,b){if(d&&d[a]){var e=d.getCurrentStep();d[a]();if(b){var f=g.get("myitable").getState().clientState.viewId,k=b;if(e||0===e)k=k+"OnTourSlide"+(e+1);h.incrementCount(k,1,f)}}};this.endTour=function(){f("div.tour-tour").css("display","none");e.doTourAction("end","EndTour");d._current=null};a.$(".tour-backdrop").on("click",
function(){e.endTour()});a.on("tabela:table-refresh-begin",function(a){f("#tourTrigger").addClass("disabledTourLink");e.endTour()});f("#tourTrigger").click(function(a){f(this).hasClass("disabledTourLink")||e.doTourAction("restart","TakeTour");a.preventDefault()});a.$(".tour-tour .btn-next").on("click",function(){e.doTourAction("next","Next")});a.$(".tour-tour .btn-prev").on("click",function(){e.doTourAction("prev","Previous")});a.$(".tour-tour .btn-end").on("click",function(){e.endTour()})}});p.when("A",
"tabela-manager","mongoose-client-strings","localstorage-util","currency-translator","reftagHandler","popover-ajax-handler","metrics-reporter").execute(function(a,g,l,m,b,f,h,k){var e=new m,d=new b,t=new f;g=new k;var c=new h(g),q=function(c){var b=c.find(".businessPriceAccordion").attr("id"),b=b?b.replace("_quantity_pricing_accordion",""):"";L(b)&&c.find(".a-alert-inline-warning").remove();if(c=c.find("[id$='quantity_pricing_accordion']"))b=c.find("div.myiAccordionRow"),a.each(b,function(c){var b=
a.$(c);b.find("input.quantityThresholdInactive").parents("tr.quantityDiscountRow").addClass("quantityDiscountRowInactive").removeClass("quantityDiscountRowActive");b.find("input[id^='quantity_threshold_0']").parents("tr.quantityDiscountRow").removeClass("quantityDiscountRowInactive").addClass("quantityDiscountRowActive");b.find("input.quantityThresholdActive").parents("tr.quantityDiscountRow").removeClass("quantityDiscountRowInactive").addClass("quantityDiscountRowActive");b=a.$(c).find("tr.quantityDiscountRowInactive");
J(a.$(c).find("tr.quantityDiscountRow"),b);0===b.length&&a.$(c).find("a.addMoreThresholds").addClass("addMoreThresholdsInactive")}),b=c.find("input[id^='percentageOff_']"),a.each(b,function(c){y(a.$(c),"percentageoff")}),b=c.find("input[id^='fixedPrices_']"),a.each(b,function(c){y(a.$(c),"fixedprices")}),c.find("div.quantityDiscountAlert").addClass("quantityDiscountAlertInactive")},p=function(a){a=a.find(".a-popover-content");a.removeClass("mt-loading");if(!a.children().length){var c=l.get("mongoose_quantity_discounts_ajax_error_loading");
a.append("<div id='a-alert-content'>"+c+"</div>")}},u=function(a,c){var b=a.find(".a-popover-content");b.removeClass("mt-loading");b.empty();b.append(c);q(a)};a.on("a:popover:beforeShow",function(b){var d="true"===a.$("#useAjaxQuantityDiscounts").attr("value"),e=b.popover.name,f=b.popover.$popover;if(f&&e&&-1!==e.indexOf("quantityDiscounts"))if(a.$(".a-popover:visible").addClass("quantityDiscountsPopover"),d){e=f.find(".a-popover-content");d={};e.remove("div.a-alert-content");e.children().length||
e.addClass("mt-loading");b.popover.attrs("position","triggerBottom");b=b.popover.$trigger.attr("data-a-popover");var h;try{h=JSON.parse(b)}catch(k){console.error("An error occurred while parsing the quantity discount data"+k),h=[]}d.dataMap=h;d.recordId=h.recordId;e="";h&&(e=t.addReftagToPath(h.endpoint+"?viewId="+h.viewId,"myipopvr",b.length));c.makePopoverAjaxCall("POST",e,d,f,u,p)}else q(f)});a.declarative("percentageoff-text-input","keyup",function(a){a=a.$target;y(a,"percentageoff");C(a.parents("div.myiAccordionRow"))});
a.declarative("fixedprices-text-input","keyup",function(a){a=a.$target;y(a,"fixedprices");C(a.parents("div.myiAccordionRow"))});a.declarative("quantity-thresholds-text-input","keyup",function(a){C(a.$target.parents("div.myiAccordionRow"))});var C=function(a){var c=a.find("span.setQuantityDiscountsEnabled"),b=a.find("span.setQuantityDiscountsDisabled");w(a)?(c.css("display","inline-block"),b.css("display","none")):(c.css("display","none"),b.css("display","inline-block"))},w=function(c){var b=c.find("tr.quantityDiscountRowActive").find("input.a-input-text"),
d=!1;a.each(b,function(c){if(a.$(c).val()!==a.$(c).attr("data-original-value"))return d=!0,!1});return d||c.hasClass("quantityDiscountRowDeleted")};a.declarative("no-quantity-discounts","click",function(c){c.$target.parents(".a-popover").find('button[data-action="a-popover-close"]').click();(c=a.$("a.businessPriceAthenaTrigger"))&&c[0]&&c[0].click()});a.declarative("percentageoff-set-quantity-discounts-enabled","click",function(a){var c=a.$target.parents("div.myiAccordionRow");v("percent","percentageOff_",
c,a.data)&&G(a.data,c,"PERCENT","percentageOff_")});a.declarative("fixedprices-set-quantity-discounts-enabled","click",function(a){var c=a.$target.parents("div.myiAccordionRow");v("fixed","fixedPrices_",c,a.data)&&G(a.data,c,"FIXED","fixedPrices_")});var L=function(a){if(a=e.getItem(a+"-businessPrice"))if(a=a.split("-"),9E5>Date.now()-parseInt(a[0],10))return a[1]},G=function(c,b,e,f,h){var k=[],g=c.businessPrice,l=c.recordId,m=L(l);m&&(g=d.formatCurrency(m));var v={};v.quantity_price_type=e;v.business_price=
g;if(h)for(c=c.maxQuantityDiscountsThresholds,e=1;e<=c;e++)v["quantity_lower_bound"+e]="",v["quantity_price"+e]="";else c=b.find("tr.quantityDiscountRow"),a.each(c,function(c,b){var d=a.$(c).find("input[id^='quantity_threshold_']"),e=a.$(c).find("input[id^='"+f+"']");v["quantity_lower_bound"+(b+1)]=d.val();v["quantity_price"+(b+1)]=e.val()});k.push({recordId:l,updatedFields:[{fieldId:"quantityDiscounts",changedValue:JSON.stringify(v)},{fieldId:"businessPrice",changedValue:g}]});b.parents("div.a-popover").find("button[data-action='a-popover-close']").find("i.a-icon-close").click();
r.saveData(k,"/inventory/save")},v=function(c,b,e,f){var h=e.find("tr.quantityDiscountRowActive"),k="",g="",m={};a.each(h,function(e,h){var v=a.$(e).find("input[id^='"+b+"']"),q=v.val(),t=a.$(e).find("input[id^='quantity_threshold_']"),K=t.val(),p=!1,z=!1,A=!1,u=L(f.recordId),u=u?u:f.businessPriceValue;d.validateInteger(K)?k&&d.parseNumber(K)<=d.parseNumber(k)&&(p=!0,m[l.get("mongoose_threshold_higher_than_previous_error")]=!0):(p=!0,m[l.get("mongoose_quantity_discount_missing_quantity_error")]=!0);
var E=d.parseNumber(q);if("fixed"===c){var r=d.parseNumber(q);q&&!isNaN(r)&&0<r?g&&E>=d.parseNumber(g)&&(z=!0,m[l.get("mongoose_quantity_price_lower_than_previous_error")]=!0):(A=z=!0,m[l.get("mongoose_invalid_discount_price_error")]=!0)}else I(E)?g&&E<=d.parseNumber(g)&&(z=!0,m[l.get("mongoose_percent_discount_higher_than_previous_error")]=!0):(A=z=!0,m[l.get("mongoose_invalid_discount_percentage_error")]=!0),E=F(E,u);1>=Number(E)&&!A&&(z=!0,m[l.get("mongoose_minimum_price_after_discount_save_error")]=
!0);E&&f&&(f.minimumPriceValue&&Number(E)<Number(f.minimumPriceValue)&&(z=!0,m[l.get("mongoose_quantity_discounts_min_price").replace(/\$\{minPrice\}/g,f.currencySymbol+f.minimumPrice)]=!0),u&&Number(E)>=Number(u)&&(z=!0,m[l.get("mongoose_quantity_discount_greater_than_business_price")]=!0));B(t,p);B(v,z);k=K;g=q});z(m,e);return 0===Object.keys(m).length},z=function(c,b){var d=b.find("div.quantityDiscountAlert");d.addClass("quantityDiscountAlertInactive");d.find("div.a-alert-content").html("");a.each(Object.keys(c),
function(c,b){var e=a.$(d.get(b));e.find("div.a-alert-content").html(c);e.removeClass("quantityDiscountAlertInactive")})},B=function(a,c){c?a.addClass("quantityDiscountErrorInput"):a.removeClass("quantityDiscountErrorInput")},y=function(a,c){var b;b=JSON.parse(a.parent("span.a-declarative").attr("data-"+c+"-text-input"));var e=b.taxRate,f="--",f=d.parseNumber(a.val());if("percentageoff"===c){var h=a.parent().data(c+"-text-input").recordId,h=L(h),h=(f=F(f,h?h:b.businessPriceValue))?d.formatCurrency(Number(f)):
"";a.parents("tr.quantityDiscountRow").find("td.calculatedBusinessPrice").text(b.currencySymbol+(h?h:"--"))}if(e){var h="",k;if(k=f&&!isNaN(f))k=e&&!isNaN(e)&&0<=e&&1>=e;k&&(h=Math.floor(f/(1+Number(e))*1E3)/1E3,h=(0===100*h%.5?Math.floor(100*h):Math.round(100*h))/100,h=(h+(f-Math.round(h*(1+Number(e))*100)/100)).toFixed(2));f=(f=h)?d.formatCurrency(Number(f)):"";a.parents("tr.quantityDiscountRow").find("td.calculatedVATExclusiveBusinessPrice").text(b.currencySymbol+(f?f:"--"))}},F=function(a,c){var b=
a*c/100,d="";!isNaN(b)&&I(a)&&(d=Number(c-b).toFixed(2));return d},I=function(a){var c=Number(a);return a&&!isNaN(c)&&0<c&&100>c},J=function(c,b){b.length===c.length-1&&a.$(c[0]).find("button.quantityDiscountDeleteButton").css("display","none")};a.declarative("delete-quantity-discount","click",function(a){a=a.$target.parents("tr.quantityDiscountRow");J(a.siblings("tr.quantityDiscountRow"),a.siblings("tr.quantityDiscountRowInactive"));a.addClass("quantityDiscountRowInactive").removeClass("quantityDiscountRowActive");
var c=a.parents("div.myiAccordionRow"),b=c.find("a.addMoreThresholds"),d=c.find("span.setQuantityDiscountsEnabled"),e=c.find("span.setQuantityDiscountsDisabled");b.removeClass("addMoreThresholdsInactive");b=a.find("input[id^='quantity_threshold_']");b.attr("data-original-value")?(c.addClass("quantityDiscountRowDeleted"),d.css("display","inline-block"),e.css("display","none")):w(c)||(d.css("display","none"),e.css("display","inline-block"));K(b);b.addClass("quantityThresholdInactive").removeClass("quantityThresholdActive");
c=a.find("input[id^='percentageOff_']");0!==c.length?c.addClass("percentageOffInactive").removeClass("percentageOffActive"):(c=a.find("input[id^='fixedPrices']"),c.addClass("fixedPricesInactive").removeClass("fixedPricesActive"));K(c);a.find("td.calculatedBusinessPrice").text("");a.parents("table.quantityDiscountsTable").find("tbody").append(a)});var K=function(a){a.attr("value","");a.attr("data-original-value","");a.val("");a.removeClass("quantityDiscountErrorInput")};a.declarative("add-more-thresholds",
"click",function(c){c=c.$target;var b=c.parents("div.myiAccordionRow"),d=b.find("tr.quantityDiscountRow");a.$(d.get(0)).find("button.quantityDiscountDeleteButton").css("display","");d=b.find("tr.quantityDiscountRowInactive");d=a.$(d.get(0));d.find("input.fixedPricesInactive").addClass("fixedPricesActive").removeClass("fixedPricesInactive");d.find("input.percentageOffInactive").addClass("percentageOffActive").removeClass("percentageOffInactive");d.find("input.quantityThresholdInactive").addClass("quantityThresholdActive").removeClass("quantityThresholdInactive");
d.addClass("quantityDiscountRowActive").removeClass("quantityDiscountRowInactive");0===b.find("tr.quantityDiscountRowInactive").length&&c.addClass("addMoreThresholdsInactive");return!1})});p.when("A","tabela-manager","JSON","tabela-table-myitable","mongoose-client-strings").register("records-below-the-fold-handler",function(a,g,l,m,b){var f=function(){var b=g.get("myitable").getState(),f;f="true"===a.$("#shouldBatchBelowTheFold").val()?b&&b.clientState.recordsAboveTheFold&&b.recordsPerPage&&0<b.recordsPerPage-
b.clientState.currentNumberOfRecords&&0<b.clientState.totalNumberOfRecords-b.clientState.currentNumberOfRecords&&!b.clientState.searchText&&(!r.belowTheFoldRequest||r.belowTheFoldRequest&&4===r.belowTheFoldRequest.readyState):b&&b.clientState.recordsAboveTheFold&&b.recordsPerPage&&0<b.recordsPerPage-b.clientState.recordsAboveTheFold&&!b.clientState.searchText;f&&(g.get("myitable").setClientState("customActionType","belowTheFold"),g.get("myitable").getState().action="CUSTOM_REFRESH",b="?viewId="+b.clientState.viewId,
r.belowTheFoldRequest=r.TabelaManager.get("myitable").fetchRows("/inventory/belowTheFold"+b,"",{position:"end",showLoading:!1}),g.get("myitable").setClientState("customActionType",""))};p.when("tabela-manager","tabela-table-myitable").execute(function(a){f()});a.on("tabela:table-refresh-done",function(a){var b=g.get("myitable");0===b.getState().searchText.trim().length&&(a.responseParser&&a.responseParser.has("totalRecordCount")&&b.setClientState("totalNumberOfRecords",a.responseParser.get("totalRecordCount")),
f())});a.on("tabela:table-refresh-begin",function(){r.belowTheFoldRequest&&4!==r.belowTheFoldRequest.readyState&&(r.belowTheFoldRequest.abort(),"true"===a.$("#shouldBatchBelowTheFold").val()&&delete r.belowTheFoldRequest,a.$("div.mt-default-alert").addClass("a-hidden"));var b=g.get("myitable").getState().action;if("true"===a.$("#shouldBatchBelowTheFold").val()&&("RECORDS_PER_PAGE_CHANGED"===b||"PAGE_CHANGED"===b||"FILTER_CHANGED"===b)){var b=g.get("myitable"),f=b.getState().clientState.recordsAboveTheFold;
b.setClientState("currentNumberOfRecords",f)}});a.on("tabela:fetch-rows-done",function(b){b=g.get("myitable");b.removeRows("spinnerId");"true"===a.$("#shouldBatchBelowTheFold").val()&&r.belowTheFoldRequest&&(b.setClientState("currentNumberOfRecords",a.$("tr.mt-row:not(#spinnerId)").length.toString()),f())})});p.when("A","tabela-manager").register("reftagHandler",function(a,g){var l=a.$,m={FBA:"myifba",PRICING:"myipcng",DEFECT:"myidfct",ERROR:"myierr",DRAFT:"myidrfts",FBAKNIGHTS:"myifbkt",PRICEINCENTIVES:"myiprin",
PRICEALERTS:"myipral",PRIME_NOW:"myiprnw",STRANDED:"myistrn",SUPPRESSED:"myisprd",UNFULFILLABLE:"myiuflf",WINE:"myiwine"};return function(){var b=this;b.addReftagToPath=function(a,b,d){a+=-1===a.indexOf("?")?"?":"&";var e;e="";var f="myimain",h=g.get("myitable").getState();h&&h.clientState&&(e=h.clientState.viewId!==w?h.clientState.viewId:"");""!==e&&m[e]!==w&&(f=m[e]);e=f;return d&&1<d&&(d=k(d),"invalid"!==d)?a+"ref=xx_myiblka"+d+"_cont_"+e:a+"ref=xx_"+b+"_cont_"+e};var f=function(a){var b="/inventory/reftag";
a&&(b+="?viewId="+a);return b};a.on("tabela:save-row",function(a){a=g.get("myitable");if(a._controllers.record.handlers.edit.hasPendingChanges()){var e="",e="",k=h(a._controllers.record.handlers.edit.pendingChanges[0].updatedFields),e=k.priceUpdate!==w,l=k.quantityUpdate!==w,k=k.defectUpdate!==w,e=e&&l?"myisvpq":e&&!l?"myisvpri":!e&&l?"myisvqnt":k?"myibfxsingle":"myiothers";a=a.getState().clientState.viewId;e=b.addReftagToPath(f(a),e);""!==e&&d(e)}});a.on("tabela:save-all",function(a){a=g.get("myitable");
var e="",e=k(a._controllers.record.handlers.edit.pendingChanges.length);"invalid"!==e&&(a=a.getState().clientState.viewId,e=-1<a.indexOf("DEFECT")||-1<a.indexOf("SUPPRESSED")?b.addReftagToPath(f(a),"myibfxmulti"+e):b.addReftagToPath(f(a),"myisvab"+e),d(e))});a.on("tabela:skip-to-page:myitable",function(a){var h=g.get("myitable"),k=e(a.newPageNumber);"invalid"!==k&&(h=h.getState().clientState.viewId,k=b.addReftagToPath(f(h),"myisktp"+k),d(k),a.newPageNumber&&a.oldPageNumber&&(a=Math.abs(a.newPageNumber-
a.oldPageNumber),a=e(a),h=b.addReftagToPath(f(h),"myisktpd"+a),d(h)))});var h=function(a){var b={};a!==w&&0<a.length&&l.each(a,function(a,c){if("price"===c.fieldId)l.extend(b,{priceUpdate:!0});else if("quantity"===c.fieldId)l.extend(b,{quantityUpdate:!0});else if(-1<c.fieldId.indexOf("defect"))return l.extend(b,{defectUpdate:!0}),b});return b},k=function(a){return 0<a&&5>=a?"1":5<a&&20>=a?"2":20<a&&50>=a?"3":50<a&&100>=a?"4":100<a?"5":"invalid"},e=function(a){return 0<a&&5>=a?"1":5<a&&10>=a?"2":10<
a&&20>=a?"3":20<a&&100>=a?"4":100<a?"5":"invalid"},d=function(a){t("POST",a,{tableId:"myiTable"})},t=function(a,b,d,e){l.ajax({type:a,url:b,async:e,contentType:"application/json",dataType:"html",data:JSON.stringify(d),success:function(a,b,c){},error:function(a,b,c){},complete:function(a,b){}})}}});p.when("A","localstorage-util","currency-translator").execute(function(a,g,l){var m=a.$,b=new g,f=new l,h=function(a){(""===a||0===parseFloat(a,10))&&(a=m("a.businessPriceAthenaTrigger"))&&a[0]&&a[0].click()},
k=function(e){a.each(e,function(d){var e=d.updatedFields;e&&a.each(e,function(a){if(a&&a.fieldId)switch(a.fieldId){case "businessPrice":var e=f.parseNumber(a.changedValue);if(!isNaN(e)){var k=a.fieldId,g=d.recordId+"-"+k,e=Date.now()+"-"+e;b.setItem(g,e);for(g=localStorage.length-1;0<=g;--g)if(e=localStorage.key(g),-1!==e.indexOf("-"+k)){var l=b.getItem(e).split("-")[0];9E5<=Date.now()-parseInt(l,10)&&b.removeItem(e)}h(a.changedValue)}break;case "price":h(a.changedValue)}})})};a.on("VATExclusivePriceSaveDone",
function(a){k(a.updatedRecords)});a.on("tabela:save-done",function(a){k(a.updatedRecords)})});p.register("manual-save-refresh-util",function(){return function(a,g){var l=this,m=a.$,b=g.get("myitable")._controllers.record.handlers.edit;l.disableAndHideSaveButton=function(a){a.removeClass("a-button-focus").addClass("a-button-disabled").addClass("hidden").find("input").attr("disabled",!0)};l.appendSuccessOverlay=function(a,b){var k=m('<div class="successOverlayContainer"></div>');k.append(b.clone());
a.append(k)};l.clearExistingErrorMessages=function(a){a.find(".a-alert-inline-error").remove()};l.handleError=function(a,b){a.append(b.clone())};l.handleSuccess=function(a,h,k,e){for(var d=a.updatedFields.slice(),g=0;g<d.length;g++){var c=d[g].fieldId,q=h.find('div[data-column="'+c+'-combo"],div[data-column="defect-group-combo"'),p=q.find('div[data-column="'+c+'-save"],div[data-column="defect-group-save"]'),q=q.find('[data-column="'+c+'"] .mt-box'),p=p.find(".a-button");e&&(q=m('<div class="resubmitSuccessWrapper"/>').appendTo(h.empty()),
g=d.length);l.disableAndHideSaveButton(p);l.appendSuccessOverlay(q,k);b.removePendingChange(a.recordId,c)}};l.draftViewIndividualSaveRefreshHandler=function(a){var h,k=!1;a.responseParser.getItemRecords?h=m("<table>"+a.responseParser.getItemRecords()+"</table>"):(h=m("<div/>"),k=!0);for(var e=0;e<a.updatedRecords.length;e++){var d=a.updatedRecords[e],g=d.recordId,c=m("#"+g+' td[data-column="defects"]'),q=h.find("#"+g+' td[data-column="defects"] .a-alert-inline'),g=q.filter(".a-alert-inline-success"),
q=q.filter(".a-alert-inline-error");l.clearExistingErrorMessages(c);0<q.length?l.handleError(c,q):0<g.length?l.handleSuccess(d,c,g):(g=m(k?".draft_result_resubmitted":".draft_result_saved").clone(),g.removeClass("hidden"),l.handleSuccess(d,c,g,k))}b.handleChangeEvent()};l.init=function(){a.on("tabela:save-done",function(a){"MANUAL"===a.responseParser.refreshMode&&l.draftViewIndividualSaveRefreshHandler(a)})}}});p.when("A","tabela-manager","manual-save-refresh-util","tabela-table-myitable").execute(function(a,
g,l){(new l(a,g)).init()});p.when("A","tabela-manager","ready").register("madagascar-tax-filter",function(a,g){var l=a.$;return function(){a.$("#taxExclusiveFilterLink").click(function(a){h(a,"exclusive")});a.$("#taxInclusiveFilterLink").click(function(a){h(a,"inclusive")});a.on("tabela:fetch-rows-done",function(a){"exclusive"===f()&&m("exclusive")});a.on("tabela:table-refresh-done",function(a){"exclusive"===f()&&m("exclusive")});a.on("VATExclusivePriceSaveDone",function(a){"exclusive"===f()&&m("exclusive")});
var m=function(f){a.each(l("tr.mt-row"),function(a){a=l(a);b(a,"price","previewTaxesTaxExclusivePrice",f);b(a,"businessPrice","previewTaxesTaxExclusiveBusinessPrice",f)})},b=function(a,b,d,f){var c=a.attr("id"),h=g.get("myitable");if(a=h.getViewModel(c,b))a=a.subFields[b],(c=h.getViewModel(c).getRowData())&&a&&(d=c[d],b=c[b],f=(f="inclusive"===f?b:d)?f:"",a.$element.find(".mt-input-text").val(f))},f=function(){var a,b=g.get("myitable").getState();b&&b.clientState&&(a=b.clientState.selectedTaxFilterType);
return a},h=function(a,b){a.preventDefault();g.get("myitable").setClientState("selectedTaxFilterType",b);m(b);l("#taxInclusiveFilterText").toggleClass("myiHidden");l("#taxExclusiveFilterText").toggleClass("myiHidden");l("#taxExclusiveFilterLink").toggleClass("myiHidden");l("#taxInclusiveFilterLink").toggleClass("myiHidden")}}});p.register("bulk-actions-common",function(){return function(a,g,l,m){var b=a.$;this.extractRowIdsFromData=function(b){if(b&&b.recordId)return[b.recordId];var h=[];a.each(b,
function(a){h.push(a.recordId.replace("_child_",""))});return h};this.extractRowDataFromRecord=function(a){return m.getViewModel(a).getRowData()};this.getMaxRecordsOnPageWarning=function(a){return g.get("mongoose_max_records_on_page_warning").replace(/\$\{maxRecordsOnPage\}/g,a)};this.getMaxRecordsOnPage=function(){var a="250",b=l.get("myitable").getState();b&&b.clientState.confirmActionPageMaxRecords&&(a=b.clientState.confirmActionPageMaxRecords);return a};this.postConfirmAction=function(f,h,g,e){var d=
this.getMaxRecordsOnPage();if(g.length>d)if(r.confirm(this.getMaxRecordsOnPageWarning(d)))g=g.slice(0,d);else return;var d={},m="/inventory/confirmAction",c=null;a.state("myiPricingMetadata")!==w&&(m=a.state("myiPricingMetadata").postUrl,c=a.state("myiPricingMetadata").refererUrl);d.actionId=f;d.actionDisplayText=h;d.recordIds=g;f=l.get("myitable").getState();d.viewId=f.clientState.viewId;e&&(d.optionalData=e);e=b("<form />").attr({action:m,method:"POST"}).append(b("<input />").attr({type:"hidden",
name:"confirmActionData",value:JSON.stringify(d)})).append(b("<input />").attr({type:"hidden",name:"refererUrl",value:c}));b("body").append(e);e.submit()}}});p.register("delete-handler",function(){return function(a,g,l,m,b,f,h,k,e){var d=a.$;a.on("delete",function(a){if(r.confirm(l.get("mongoose_warning_delete_listings"))){var b=m.extractRowIdsFromData(a);1<b.length?m.postConfirmAction("delete",l.get("mongoose_delete"),b):t(a)}});var t=function(a,d,e){var g=b.getState().clientState.viewId;a=m.extractRowIdsFromData(a);
0<a.length&&(g=f.addReftagToPath("/inventory/delete?viewId="+g,"myidel",a.length),h.makeAjaxCall("POST",g,{recordIds:a},d,e))};a.on("confirmdelete",function(a){t(a,(new e).confirmActionSuccessCallback,(new e).confirmActionErrorCallback)});a.on("fyidelete",function(a){var b=m.extractRowIdsFromData(a);if(1<b.length){var e="";b.forEach(function(a,c){var f=d("#"+a).data("row-data").title;e+=c+1+". "+f;c!==b.length-1&&(e+="\n")});d("#deleteListingsTitles").val(e);d("#deleteData").val(g.stringify(a));d("#deleteModalTriggerElement").click()}else t(a)});
a.declarative("deleteModalConfirmButton","click",function(){k.get("deleteModal").hide();var a=g.parse(d("#deleteData").val());t(a)})}});p.register("generate-template-handler",function(){return function(a,g,l,m,b,f){var h=function(b){b=l.extractRowIdsFromData(b);var e=[];a.each(b,function(a){a=l.extractRowDataFromRecord(a);e.push(a.sku)});return e};a.on("generatetemplate",function(a){a=h(a);if(0<a.length){var e=m.addReftagToPath("/inventory/generate?","fyigen",a.length),e=e+("&skus="+g.stringify(a));
b.makeGenerateSkuCall("GET",e,(new f).confirmActionErrorCallback)}})}});p.when("A","currency-translator","ready").register("vat-exclusive-price-popover",function(a,g){return function(){var l=new g,m=this,b;a.on("a:popover:beforeShow",function(a){if(a=a.popover.$popover)if(a=a.find(".VATExclusivepopover"),a.length){a.parents("div.a-popover").addClass("VATExclusivePopoverCustomPosition");var b=a.find("input.VATPriceInputField"),c=b?h(b.parent("span.a-declarative").attr("data-vatexclusive-price-text-input")).price:
"";b.val(c);k(b);f(a)}});a.on("a:popover:afterShow",function(a){if(a=a.popover.$popover)if(a=a.find(".VATExclusivepopover"),a.length){var e=a.find("input.VATPriceInputField");b=r.setInterval(function(){m.setFocus(e,b)},20)}});this.setFocus=function(a,b){a.focus();var c=a.val();a.val("");a.val(c);a.is(":focus")&&r.clearInterval(b)};var f=function(a){var b=a.find("span.VATExclusiveSavePriceEnabled"),c=a.find("span.VATExclusiveSavePriceDisabled"),e=a.find("input.VATPriceInputField");a=e?h(e.parent("span.a-declarative").attr("data-vatexclusive-price-text-input")).price:
"";e=l.parseNumber(e.val());l.parseNumber(a)!==e?(b.css("display","inline-block"),c.css("display","none")):(b.css("display","none"),c.css("display","inline-block"))},h=function(a){try{return a?JSON.parse(a):""}catch(b){console.log("Error occured while parsing JSON for VATExclusive Popover"+b)}};a.declarative("vatExclusive-price-text-input","keyup",function(a){a=a.$target;k(a);f(a.parents(".VATExclusivepopover"))});var k=function(a){var b=a?h(a.parent("span.a-declarative").attr("data-vatexclusive-price-text-input")):
"",c;c=b.taxRate;var e=l.parseNumber(a.val()),f="",g;if(g=e&&!isNaN(e))g=c&&!isNaN(c)&&0<=c<=1;g&&(f=Math.floor(e/(1+Number(c))*1E3)/1E3,f=(0===100*f%.5?Math.floor(100*f):Math.round(100*f))/100,f=(f+(e-Math.round(f*(1+Number(c))*100)/100)).toFixed(2));c=(c=f)?l.formatCurrency(Number(c)):"";a.parents(".VATExclusivepopover").find("span.VATExclusivePriceTextField").text(b.currencySymbol+" "+(c?c:"--"))};a.declarative("VATExclusive-price-save-button-enabled","click",function(a){a=a.$target;var b=h(a.parents("span.a-declarative").attr("data-vatexclusive-price-save-button-enabled")),
c=a.parents("div.a-popover");e(c,b,a.parents(".VATExclusivepopover").find("input.VATPriceInputField").val())});var e=function(b,e,c){var f=[];f.push({recordId:e.recordId,updatedFields:[{fieldId:e.fieldId,changedValue:c}]});b.find("button[data-action='a-popover-close']").find("i.a-icon-close").click();r.saveData(f,"/inventory/save",w,w,function(){a.trigger("VATExclusivePriceSaveDone",{updatedRecords:f})})}}});p.when("A","a-carousel-framework","mlp-metrics-util","localstorage-util","listing-defect-util",
"duplicate-modal-ajax","a-modal","tabela-manager","mongoose-client-strings").execute(function(a,g,l,m,b,f,h,k,e){function d(b){a.$("#"+b).find(".mt-table tr").each(function(b){b=a.$(this).attr("id");"head-row"!==b&&"true"===u.getItem("SellerMadeDecision_"+b)&&p(b)})}function p(b){if("DUPLICATE"===y){var c=e.get("mongoose_myi_duplicate_decided_message")||"";a.$("#myi-popover-trigger-none-"+b+" .mt-text-content").text(c);a.$("#"+b+"-action .a-button").addClass("a-button-disabled")}}function c(a){a=
JSON.parse(a.defects);for(var b=0;b<a.length;b++)if("N-420.Q.L"===a[b].defectKey||"N-42.Q.L"===a[b].defectKey)return null!==a[b].metadata?a[b].metadata.split(","):[];return[]}function q(b,c){for(var e={subtree:!0,childList:!0,attributes:!1,characterData:!1},d=b.length-1;0<=d;d--)B[d]=new r.MutationObserver(function(b){b.forEach(function(b){if("childList"===b.type){c.updatePosition();b=a.$(".duplicate-modal:visible .a-popover-inner").outerHeight();var e=a.$(".duplicate-modal:visible .duplicates-alert").outerHeight(),
d=a.$(".duplicate-modal:visible .myi-dp").outerHeight();b<e+d&&a.$(".myi-scroll-indicator .myi-scroll-arrow").css("animation-name","bouncePopOut")}})}),B[d].observe(b[d],e)}function A(b,e,d,f,g){a.$.ajax("/hz/inventory/duplicateModal/saveResponse",{type:"POST",accepts:"application/json",cache:!1,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({merchantId:b,decisionIndex:e,decision:d,asin:f.asin,candidateAsins:c(f)}),error:function(a,b,c){console.error(b);console.error(a)},
success:function(a,b){g.hide()}})}var u=new m,C,D,L=[],G=0,v=new l;new b;var z={},B=[],y=k.get("myitable").getState().clientState.viewId;a.on("tabela:delayed-load-done",function(a){if(y){if("DUPLICATE"===y||"SUPPRESSED"===y)f.loadAll(),g.createAll();"DUPLICATE"===y&&d(a.container)}});a.on("a:popover:beforeShow",function(b){b.popover.name&&-1!==b.popover.name.indexOf("duplicateRemediationPopupContent")&&(a.$(".a-popover-modal:visible").addClass("duplicate-modal"),q(document.getElementsByClassName("myi-dp"),
b.popover))});a.on("a:popover:afterShow",function(b){var c=b.popover.name;if(c&&-1!==c.indexOf("duplicateRemediationPopupContent")){var e=c.split("-")[0],d;C=b.popover;b=C.$container;d=b.find(".duplicate-index");b=b.find(".duplicate-length");D=g.getCarouselByName("carousel-duplicate-candidates-"+e);G=0;b.html(D.getAttr("set_size"));d.html("1");a.on("a:carousel:"+D.getAttr("name")+":change:pageNumber",function(a){d.html(a.newValue)});-1===L.indexOf(c)?(L.push(c),D.init()):D.gotoPage(1);u.getItem("SellerMadeDecision_"+
e)||u.setItem("SellerMadeDecision_"+e,"false")}});a.on("a:popover:afterHide",function(){for(var a=B.length-1;0<=a;a--)B[a].disconnect()});a.on("reviewDuplicates",function(b){b=b.recordId;if(z[b]!==w)b=z[b];else{var c=a.$("#myi-popover-trigger-none-"+b).get(0);c!==w?(z[b]=JSON.parse(c.getAttribute("data-myi-popover-trigger-none")),z[b].header="Possible Duplicate",z[b]["max-height"]="90%",b=z[b]):b=w}(c=h.get(b.name))||(c=h.create(a.$("#a-popover-"+b.name),b));c.show()});a.declarative("duplicate-modal-no-action",
"click",function(a){a=C.name.split("-")[0];D.gotoNextPage();G++;G===parseInt(D.getAttr("set_size"),10)&&(u.setItem("SellerMadeDecision_"+a,"true"),A(v.getMerchantId(),G,!1,v.extractRowDataFromRecord(a),C),p(a),C.hide())});a.declarative("duplicate-modal-yes-action","click",function(a){a=C.name.split("-")[0];u.setItem("SellerMadeDecision_"+a,"true");p(a);A(v.getMerchantId(),G+1,!0,v.extractRowDataFromRecord(a),C)})});p.when("A").register("duplicate-modal-ajax",function(a){function g(g){g.each(function(g,
b){var f=JSON.parse(b.getAttribute("data-ajax-component")),h=b.parentNode;++g;try{a.ajax(f.url,{global:!0,method:"get",cache:!0,params:f.parameters,success:function(a){a.trim()&&(h.innerHTML=a)},error:function(){}})}catch(k){console.log("error occurred in internalLoadAjaxComponent. "+k.message)}})}return{callCount:0,loadForClass:function(l){g(a.$(".myi-ajax-component").find(l))},loadOnDOMObject:function(l){g(a.$(l).find(".myi-ajax-component"))},loadAll:function(){var l=a.$(".myi-ajax-component");
l.removeClass("myi-ajax-component");g(l)}}});p.register("resubmit-draft-handler",function(){return function(a,g,l,m,b,f){var h=[],k=m(l);0<k.length&&a.each(k,function(a){var d=b(a),f=JSON.parse(d.defects);"true"===f.Resubmittable&&h.push({recordId:a,updatedFields:[{fieldId:"defects-item_sku",changedValue:d.sku,beforeValue:d.sku,metadata:{feedsName:"item_sku",attribute:"item_sku",productType:f.ProductType}}]})});g=g.getState().clientState.viewId;f(h,"/inventory/save?viewId="+g,function(b){k.length!==
b.length&&a.$(".draft_result_incomplete_resubmit").removeClass("hidden");a.trigger("tabela:save-done",{updatedRecords:b,responseParser:{refreshMode:"MANUAL"}})},function(){a.$(".draft_result_failed_resubmit").removeClass("hidden")})}})});